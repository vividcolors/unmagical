{"version":3,"sources":["../../node_modules/string-template/index.js","../../src/core/utils.ts","../../node_modules/ramda/src/internal/_isPlaceholder.js","../../node_modules/ramda/src/internal/_curry1.js","../../node_modules/ramda/src/internal/_curry2.js","../../node_modules/ramda/src/internal/_has.js","../../node_modules/ramda/src/isNil.js","../../node_modules/ramda/src/hasPath.js","../../node_modules/ramda/src/internal/_isArray.js","../../node_modules/ramda/src/internal/_checkForMethod.js","../../node_modules/ramda/src/internal/_curry3.js","../../node_modules/ramda/src/slice.js","../../node_modules/ramda/src/init.js","../../node_modules/ramda/src/internal/_isInteger.js","../../node_modules/ramda/src/internal/_isString.js","../../node_modules/ramda/src/nth.js","../../node_modules/ramda/src/paths.js","../../node_modules/ramda/src/path.js","../../node_modules/ramda/src/assoc.js","../../node_modules/ramda/src/assocPath.js","../../node_modules/ramda/src/insert.js","../../node_modules/ramda/src/last.js","../../node_modules/ramda/src/dissoc.js","../../node_modules/ramda/src/remove.js","../../node_modules/ramda/src/internal/_concat.js","../../node_modules/ramda/src/adjust.js","../../node_modules/ramda/src/always.js","../../node_modules/ramda/src/update.js","../../src/core/env.ts","../../src/core/rules.ts","../../src/core/schema.ts","../../src/core/errors.ts","../../node_modules/hyperapp/src/index.js","../../src/core/framework.ts","../../src/core/components.ts","../../src/bindings/bulma.tsx","../../src/core/rest.ts","../../src/core/updates.ts","src.tsx"],"names":["h","name","attributes","length","rest","children","arguments","push","node","pop","nodeName","key","app","state","actions","view","container","map","skipRender","rootElement","oldNode","recycleElement","element","toLowerCase","call","childNodes","nodeType","nodeValue","lifecycle","isRecycling","globalState","clone","wiredActions","wireStateToActions","path","action","data","result","getPartialState","then","scheduleRender","setPartialState","concat","resolveNode","render","patch","parent","isSvg","newElement","createElement","document","createTextNode","createElementNS","oncreate","i","appendChild","updateAttribute","insertBefore","removeElement","updateElement","oldAttributes","cb","onupdate","oldKeyed","newKeyed","oldElements","oldChildren","oldKey","getKey","k","newKey","keyedNode","setTimeout","target","source","out","value","slice","eventListener","event","currentTarget","events","type","oldValue","style","cssText","setProperty","addEventListener","removeEventListener","setAttribute","removeAttribute","done","removeChild","removeChildren","ondestroy","onremove"],"mappings":"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","file":"index.js","sourceRoot":"","sourcesContent":["var nargs = /\\{([0-9a-zA-Z_]+)\\}/g\n\nmodule.exports = template\n\nfunction template(string) {\n    var args\n\n    if (arguments.length === 2 && typeof arguments[1] === \"object\") {\n        args = arguments[1]\n    } else {\n        args = new Array(arguments.length - 1)\n        for (var i = 1; i < arguments.length; ++i) {\n            args[i - 1] = arguments[i]\n        }\n    }\n\n    if (!args || !args.hasOwnProperty) {\n        args = {}\n    }\n\n    return string.replace(nargs, function replaceArg(match, i, index) {\n        var result\n\n        if (string[index - 1] === \"{\" &&\n            string[index + match.length] === \"}\") {\n            return i\n        } else {\n            result = args.hasOwnProperty(i) ? args[i] : null\n            if (result === null || result === undefined) {\n                return \"\"\n            }\n\n            return result\n        }\n    })\n}\n","\r\n/**\r\n * Some utility functions.\r\n * \r\n * @module core/utils \r\n */\r\n\r\n/**\r\n * JSON path's index portion.  \r\n * We handle JSON path of `\"/abc/1/def\"` as an index array of `[\"abc\", 1, \"def\"]`.\r\n * \r\n * @category Types\r\n */\r\nexport type Index = string|number\r\n\r\n/**\r\n * Returns true if x is an string representation of an integer value.\r\n * \r\n * @example\r\n * ```js\r\n * isIntStr(\"abc\");  // => false\r\n * isIntStr(\"123\");  // => true\r\n * isIntStr(\"1a\");   // => false\r\n * ```\r\n * @category Entries\r\n */\r\nexport const isIntStr = (x:string):boolean => {\r\n  const n = +x\r\n  return (n % 1 === 0 && x === \"\" + n)\r\n}\r\n\r\n/**\r\n * Returns the array-index independent normalized path.\r\n * \r\n * @example\r\n * ```\r\n * normalizePath(\"/abc/1/def\");  // => \"/abc/\" + \"*\" + \"/def\"\r\n * ```\r\n * @category Entries\r\n */\r\nexport const normalizePath = (path:string):string => {\r\n  const frags = path.split('/')\r\n  for (let i = 1; i < frags.length; i++) {\r\n    if (isIntStr(frags[i])) {\r\n      frags[i] = '*'\r\n    }\r\n  }\r\n  return frags.join('/')\r\n}\r\n\r\n/**\r\n * Concatenates two paths, `path' can be a relative one.\r\n * It roughly follows the Relative JSON path standard.\r\n * \r\n * @example\r\n * ```\r\n * appendPath(\"/abc/def\", \"1/zzz\");  // => \"/abc/zzz\"\r\n * appendPath(\"/abc/def\", \"0/zzz\");  // => \"/abc/def/zzz\"\r\n * appendPath(\"/abc/def\", \"/zzz\");   // => \"/zzz\"\r\n * ```\r\n * @category Entries\r\n */\r\nexport const appendPath = (base:string, path:string):string => {\r\n  if (path.charAt(0) == '' || path.charAt(0) == '/') return path  // absolute path\r\n  if (path === '0') return base  // easy frequent case\r\n  \r\n  const base1 = pathToArray(base)\r\n  let frag0 = path.split('/')\r\n  let frag = []\r\n  let unused = null\r\n\r\n  let upcount = +frag0[0]\r\n  frag = base1\r\n  if (upcount > frag.length) {\r\n    upcount = frag.length\r\n  }\r\n  frag.splice(frag.length - upcount, upcount)\r\n\r\n  frag0.shift()\r\n\r\n  if (frag0.length == 0 && frag.length == 0) return ''\r\n  return '/' + frag.concat(frag0).join('/')\r\n}\r\n\r\n/**\r\n * Normalizes not a string path but an array path, then returns a normalized string path.\r\n * \r\n * @category Entries\r\n */\r\nexport const normalizePathArray = (path:Index[]):string => {\r\n  let rv = ''\r\n  for (let i = 0; i < path.length; i++) {\r\n    if (typeof path[i] == 'number' || isIntStr(\"\" + path[i])) {\r\n      rv += '/*'\r\n    } else {\r\n      rv += '/' + path[i]\r\n    }\r\n  }\r\n  return rv\r\n}\r\n\r\n/**\r\n * Separates a path described by a string into an Index array.\r\n * \r\n * @category Entries\r\n */\r\nexport const pathToArray = (path:string):Index[] => {\r\n  const frags = path.split('/')\r\n  const rv = []\r\n  for (let i = 1; i < frags.length; i++) {\r\n    rv.push(isIntStr(frags[i]) ? +frags[i] : frags[i])\r\n  }\r\n  return rv\r\n}\r\n\r\n/**\r\n * A variant of `typeof', which handles null and Array appropreately.\r\n * \r\n * @example\r\n * ```\r\n * typeOf([]);    // => 'array'\r\n * typeOf(null);  // => 'null'\r\n * ```\r\n * @category Entries\r\n */\r\nexport const typeOf = (x:any):string => x === null ? 'null' : Array.isArray(x) ? 'array' : typeof x\r\n\r\n/**\r\n * Returns true if `x' is a json value. This is just a shallow test.\r\n * \r\n * @category Entries\r\n */\r\nexport const isJsonValue = (x:any):boolean => {\r\n  switch (typeOf(x)) {\r\n    case 'null': \r\n    case 'number': \r\n    case 'boolean': \r\n    case 'string': \r\n    case 'object': \r\n    case 'array': \r\n      return true\r\n    default: \r\n      return false\r\n  }\r\n}\r\n\r\n/**\r\n * Extracts common portion of paths.\r\n * \r\n * @example\r\n * ```\r\n * commonPath(\"/abc/def\", \"/abc/zzz\");  // => \"/abc\"\r\n * commonPath(\"/abc/def\", \"/abc/deX\");  // => \"/abc\"\r\n * commonPath(\"/abc\", \"/xxx\");  // => \"\"\r\n * commonPath(\"/abc/def/aaa\", \"/abc/def/bbb\");  // => \"/abc/def\"\r\n * ```\r\n * @category Entries\r\n */\r\nexport const commonPath = (path1:string, path2:string):string => {\r\n  const frags1 = path1.split('/')\r\n  const frags2 = path2.split('/')\r\n  const rv = []\r\n  for (let i = 0; i < frags1.length; i++) {\r\n    if (frags2.length <= i) break\r\n    if (frags1[i] != frags2[i]) break\r\n    rv.push(frags1[i])\r\n  }\r\n  return rv.join('/')\r\n}\r\n\r\n/**\r\n * Builds a query string from `obj'.\r\n * \r\n * @category Entries\r\n */\r\nexport const normalizeQuery = (obj:Record<string,string>, omitEmptyParam:boolean):Record<string,string> => {\r\n  const rv = /** @type {Record<string, string>} */ ({})\r\n  for (let p in obj) {\r\n    switch (typeOf(p)) {\r\n      case 'null': \r\n        if (!omitEmptyParam) rv[p] = ''\r\n        break\r\n      case 'boolean': \r\n        rv[p] = obj[p] ? 'true' : 'false'\r\n        break\r\n      case 'number': \r\n        rv[p] = \"\" + obj[p]\r\n        break\r\n      case 'string': \r\n        if (omitEmptyParam && obj[p] === \"\") break\r\n        rv[p] = obj[p]\r\n        break\r\n    }\r\n  }\r\n  return rv\r\n}","function _isPlaceholder(a) {\n  return a != null && typeof a === 'object' && a['@@functional/placeholder'] === true;\n}\n\nmodule.exports = _isPlaceholder;","var _isPlaceholder =\n/*#__PURE__*/\nrequire(\"./_isPlaceholder\");\n/**\n * Optimized internal one-arity curry function.\n *\n * @private\n * @category Function\n * @param {Function} fn The function to curry.\n * @return {Function} The curried function.\n */\n\n\nfunction _curry1(fn) {\n  return function f1(a) {\n    if (arguments.length === 0 || _isPlaceholder(a)) {\n      return f1;\n    } else {\n      return fn.apply(this, arguments);\n    }\n  };\n}\n\nmodule.exports = _curry1;","var _curry1 =\n/*#__PURE__*/\nrequire(\"./_curry1\");\n\nvar _isPlaceholder =\n/*#__PURE__*/\nrequire(\"./_isPlaceholder\");\n/**\n * Optimized internal two-arity curry function.\n *\n * @private\n * @category Function\n * @param {Function} fn The function to curry.\n * @return {Function} The curried function.\n */\n\n\nfunction _curry2(fn) {\n  return function f2(a, b) {\n    switch (arguments.length) {\n      case 0:\n        return f2;\n\n      case 1:\n        return _isPlaceholder(a) ? f2 : _curry1(function (_b) {\n          return fn(a, _b);\n        });\n\n      default:\n        return _isPlaceholder(a) && _isPlaceholder(b) ? f2 : _isPlaceholder(a) ? _curry1(function (_a) {\n          return fn(_a, b);\n        }) : _isPlaceholder(b) ? _curry1(function (_b) {\n          return fn(a, _b);\n        }) : fn(a, b);\n    }\n  };\n}\n\nmodule.exports = _curry2;","function _has(prop, obj) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\nmodule.exports = _has;","var _curry1 =\n/*#__PURE__*/\nrequire(\"./internal/_curry1\");\n/**\n * Checks if the input value is `null` or `undefined`.\n *\n * @func\n * @memberOf R\n * @since v0.9.0\n * @category Type\n * @sig * -> Boolean\n * @param {*} x The value to test.\n * @return {Boolean} `true` if `x` is `undefined` or `null`, otherwise `false`.\n * @example\n *\n *      R.isNil(null); //=> true\n *      R.isNil(undefined); //=> true\n *      R.isNil(0); //=> false\n *      R.isNil([]); //=> false\n */\n\n\nvar isNil =\n/*#__PURE__*/\n_curry1(function isNil(x) {\n  return x == null;\n});\n\nmodule.exports = isNil;","var _curry2 =\n/*#__PURE__*/\nrequire(\"./internal/_curry2\");\n\nvar _has =\n/*#__PURE__*/\nrequire(\"./internal/_has\");\n\nvar isNil =\n/*#__PURE__*/\nrequire(\"./isNil\");\n/**\n * Returns whether or not a path exists in an object. Only the object's\n * own properties are checked.\n *\n * @func\n * @memberOf R\n * @since v0.26.0\n * @category Object\n * @typedefn Idx = String | Int\n * @sig [Idx] -> {a} -> Boolean\n * @param {Array} path The path to use.\n * @param {Object} obj The object to check the path in.\n * @return {Boolean} Whether the path exists.\n * @see R.has\n * @example\n *\n *      R.hasPath(['a', 'b'], {a: {b: 2}});         // => true\n *      R.hasPath(['a', 'b'], {a: {b: undefined}}); // => true\n *      R.hasPath(['a', 'b'], {a: {c: 2}});         // => false\n *      R.hasPath(['a', 'b'], {});                  // => false\n */\n\n\nvar hasPath =\n/*#__PURE__*/\n_curry2(function hasPath(_path, obj) {\n  if (_path.length === 0 || isNil(obj)) {\n    return false;\n  }\n\n  var val = obj;\n  var idx = 0;\n\n  while (idx < _path.length) {\n    if (!isNil(val) && _has(_path[idx], val)) {\n      val = val[_path[idx]];\n      idx += 1;\n    } else {\n      return false;\n    }\n  }\n\n  return true;\n});\n\nmodule.exports = hasPath;","/**\n * Tests whether or not an object is an array.\n *\n * @private\n * @param {*} val The object to test.\n * @return {Boolean} `true` if `val` is an array, `false` otherwise.\n * @example\n *\n *      _isArray([]); //=> true\n *      _isArray(null); //=> false\n *      _isArray({}); //=> false\n */\nmodule.exports = Array.isArray || function _isArray(val) {\n  return val != null && val.length >= 0 && Object.prototype.toString.call(val) === '[object Array]';\n};","var _isArray =\n/*#__PURE__*/\nrequire(\"./_isArray\");\n/**\n * This checks whether a function has a [methodname] function. If it isn't an\n * array it will execute that function otherwise it will default to the ramda\n * implementation.\n *\n * @private\n * @param {Function} fn ramda implemtation\n * @param {String} methodname property to check for a custom implementation\n * @return {Object} Whatever the return value of the method is.\n */\n\n\nfunction _checkForMethod(methodname, fn) {\n  return function () {\n    var length = arguments.length;\n\n    if (length === 0) {\n      return fn();\n    }\n\n    var obj = arguments[length - 1];\n    return _isArray(obj) || typeof obj[methodname] !== 'function' ? fn.apply(this, arguments) : obj[methodname].apply(obj, Array.prototype.slice.call(arguments, 0, length - 1));\n  };\n}\n\nmodule.exports = _checkForMethod;","var _curry1 =\n/*#__PURE__*/\nrequire(\"./_curry1\");\n\nvar _curry2 =\n/*#__PURE__*/\nrequire(\"./_curry2\");\n\nvar _isPlaceholder =\n/*#__PURE__*/\nrequire(\"./_isPlaceholder\");\n/**\n * Optimized internal three-arity curry function.\n *\n * @private\n * @category Function\n * @param {Function} fn The function to curry.\n * @return {Function} The curried function.\n */\n\n\nfunction _curry3(fn) {\n  return function f3(a, b, c) {\n    switch (arguments.length) {\n      case 0:\n        return f3;\n\n      case 1:\n        return _isPlaceholder(a) ? f3 : _curry2(function (_b, _c) {\n          return fn(a, _b, _c);\n        });\n\n      case 2:\n        return _isPlaceholder(a) && _isPlaceholder(b) ? f3 : _isPlaceholder(a) ? _curry2(function (_a, _c) {\n          return fn(_a, b, _c);\n        }) : _isPlaceholder(b) ? _curry2(function (_b, _c) {\n          return fn(a, _b, _c);\n        }) : _curry1(function (_c) {\n          return fn(a, b, _c);\n        });\n\n      default:\n        return _isPlaceholder(a) && _isPlaceholder(b) && _isPlaceholder(c) ? f3 : _isPlaceholder(a) && _isPlaceholder(b) ? _curry2(function (_a, _b) {\n          return fn(_a, _b, c);\n        }) : _isPlaceholder(a) && _isPlaceholder(c) ? _curry2(function (_a, _c) {\n          return fn(_a, b, _c);\n        }) : _isPlaceholder(b) && _isPlaceholder(c) ? _curry2(function (_b, _c) {\n          return fn(a, _b, _c);\n        }) : _isPlaceholder(a) ? _curry1(function (_a) {\n          return fn(_a, b, c);\n        }) : _isPlaceholder(b) ? _curry1(function (_b) {\n          return fn(a, _b, c);\n        }) : _isPlaceholder(c) ? _curry1(function (_c) {\n          return fn(a, b, _c);\n        }) : fn(a, b, c);\n    }\n  };\n}\n\nmodule.exports = _curry3;","var _checkForMethod =\n/*#__PURE__*/\nrequire(\"./internal/_checkForMethod\");\n\nvar _curry3 =\n/*#__PURE__*/\nrequire(\"./internal/_curry3\");\n/**\n * Returns the elements of the given list or string (or object with a `slice`\n * method) from `fromIndex` (inclusive) to `toIndex` (exclusive).\n *\n * Dispatches to the `slice` method of the third argument, if present.\n *\n * @func\n * @memberOf R\n * @since v0.1.4\n * @category List\n * @sig Number -> Number -> [a] -> [a]\n * @sig Number -> Number -> String -> String\n * @param {Number} fromIndex The start index (inclusive).\n * @param {Number} toIndex The end index (exclusive).\n * @param {*} list\n * @return {*}\n * @example\n *\n *      R.slice(1, 3, ['a', 'b', 'c', 'd']);        //=> ['b', 'c']\n *      R.slice(1, Infinity, ['a', 'b', 'c', 'd']); //=> ['b', 'c', 'd']\n *      R.slice(0, -1, ['a', 'b', 'c', 'd']);       //=> ['a', 'b', 'c']\n *      R.slice(-3, -1, ['a', 'b', 'c', 'd']);      //=> ['b', 'c']\n *      R.slice(0, 3, 'ramda');                     //=> 'ram'\n */\n\n\nvar slice =\n/*#__PURE__*/\n_curry3(\n/*#__PURE__*/\n_checkForMethod('slice', function slice(fromIndex, toIndex, list) {\n  return Array.prototype.slice.call(list, fromIndex, toIndex);\n}));\n\nmodule.exports = slice;","var slice =\n/*#__PURE__*/\nrequire(\"./slice\");\n/**\n * Returns all but the last element of the given list or string.\n *\n * @func\n * @memberOf R\n * @since v0.9.0\n * @category List\n * @sig [a] -> [a]\n * @sig String -> String\n * @param {*} list\n * @return {*}\n * @see R.last, R.head, R.tail\n * @example\n *\n *      R.init([1, 2, 3]);  //=> [1, 2]\n *      R.init([1, 2]);     //=> [1]\n *      R.init([1]);        //=> []\n *      R.init([]);         //=> []\n *\n *      R.init('abc');  //=> 'ab'\n *      R.init('ab');   //=> 'a'\n *      R.init('a');    //=> ''\n *      R.init('');     //=> ''\n */\n\n\nvar init =\n/*#__PURE__*/\nslice(0, -1);\nmodule.exports = init;","/**\n * Determine if the passed argument is an integer.\n *\n * @private\n * @param {*} n\n * @category Type\n * @return {Boolean}\n */\nmodule.exports = Number.isInteger || function _isInteger(n) {\n  return n << 0 === n;\n};","function _isString(x) {\n  return Object.prototype.toString.call(x) === '[object String]';\n}\n\nmodule.exports = _isString;","var _curry2 =\n/*#__PURE__*/\nrequire(\"./internal/_curry2\");\n\nvar _isString =\n/*#__PURE__*/\nrequire(\"./internal/_isString\");\n/**\n * Returns the nth element of the given list or string. If n is negative the\n * element at index length + n is returned.\n *\n * @func\n * @memberOf R\n * @since v0.1.0\n * @category List\n * @sig Number -> [a] -> a | Undefined\n * @sig Number -> String -> String\n * @param {Number} offset\n * @param {*} list\n * @return {*}\n * @example\n *\n *      const list = ['foo', 'bar', 'baz', 'quux'];\n *      R.nth(1, list); //=> 'bar'\n *      R.nth(-1, list); //=> 'quux'\n *      R.nth(-99, list); //=> undefined\n *\n *      R.nth(2, 'abc'); //=> 'c'\n *      R.nth(3, 'abc'); //=> ''\n * @symb R.nth(-1, [a, b, c]) = c\n * @symb R.nth(0, [a, b, c]) = a\n * @symb R.nth(1, [a, b, c]) = b\n */\n\n\nvar nth =\n/*#__PURE__*/\n_curry2(function nth(offset, list) {\n  var idx = offset < 0 ? list.length + offset : offset;\n  return _isString(list) ? list.charAt(idx) : list[idx];\n});\n\nmodule.exports = nth;","var _curry2 =\n/*#__PURE__*/\nrequire(\"./internal/_curry2\");\n\nvar _isInteger =\n/*#__PURE__*/\nrequire(\"./internal/_isInteger\");\n\nvar nth =\n/*#__PURE__*/\nrequire(\"./nth\");\n/**\n * Retrieves the values at given paths of an object.\n *\n * @func\n * @memberOf R\n * @since v0.27.1\n * @category Object\n * @typedefn Idx = [String | Int]\n * @sig [Idx] -> {a} -> [a | Undefined]\n * @param {Array} pathsArray The array of paths to be fetched.\n * @param {Object} obj The object to retrieve the nested properties from.\n * @return {Array} A list consisting of values at paths specified by \"pathsArray\".\n * @see R.path\n * @example\n *\n *      R.paths([['a', 'b'], ['p', 0, 'q']], {a: {b: 2}, p: [{q: 3}]}); //=> [2, 3]\n *      R.paths([['a', 'b'], ['p', 'r']], {a: {b: 2}, p: [{q: 3}]}); //=> [2, undefined]\n */\n\n\nvar paths =\n/*#__PURE__*/\n_curry2(function paths(pathsArray, obj) {\n  return pathsArray.map(function (paths) {\n    var val = obj;\n    var idx = 0;\n    var p;\n\n    while (idx < paths.length) {\n      if (val == null) {\n        return;\n      }\n\n      p = paths[idx];\n      val = _isInteger(p) ? nth(p, val) : val[p];\n      idx += 1;\n    }\n\n    return val;\n  });\n});\n\nmodule.exports = paths;","var _curry2 =\n/*#__PURE__*/\nrequire(\"./internal/_curry2\");\n\nvar paths =\n/*#__PURE__*/\nrequire(\"./paths\");\n/**\n * Retrieve the value at a given path.\n *\n * @func\n * @memberOf R\n * @since v0.2.0\n * @category Object\n * @typedefn Idx = String | Int\n * @sig [Idx] -> {a} -> a | Undefined\n * @param {Array} path The path to use.\n * @param {Object} obj The object to retrieve the nested property from.\n * @return {*} The data at `path`.\n * @see R.prop, R.nth\n * @example\n *\n *      R.path(['a', 'b'], {a: {b: 2}}); //=> 2\n *      R.path(['a', 'b'], {c: {b: 2}}); //=> undefined\n *      R.path(['a', 'b', 0], {a: {b: [1, 2, 3]}}); //=> 1\n *      R.path(['a', 'b', -2], {a: {b: [1, 2, 3]}}); //=> 2\n */\n\n\nvar path =\n/*#__PURE__*/\n_curry2(function path(pathAr, obj) {\n  return paths([pathAr], obj)[0];\n});\n\nmodule.exports = path;","var _curry3 =\n/*#__PURE__*/\nrequire(\"./internal/_curry3\");\n/**\n * Makes a shallow clone of an object, setting or overriding the specified\n * property with the given value. Note that this copies and flattens prototype\n * properties onto the new object as well. All non-primitive properties are\n * copied by reference.\n *\n * @func\n * @memberOf R\n * @since v0.8.0\n * @category Object\n * @sig String -> a -> {k: v} -> {k: v}\n * @param {String} prop The property name to set\n * @param {*} val The new value\n * @param {Object} obj The object to clone\n * @return {Object} A new object equivalent to the original except for the changed property.\n * @see R.dissoc, R.pick\n * @example\n *\n *      R.assoc('c', 3, {a: 1, b: 2}); //=> {a: 1, b: 2, c: 3}\n */\n\n\nvar assoc =\n/*#__PURE__*/\n_curry3(function assoc(prop, val, obj) {\n  var result = {};\n\n  for (var p in obj) {\n    result[p] = obj[p];\n  }\n\n  result[prop] = val;\n  return result;\n});\n\nmodule.exports = assoc;","var _curry3 =\n/*#__PURE__*/\nrequire(\"./internal/_curry3\");\n\nvar _has =\n/*#__PURE__*/\nrequire(\"./internal/_has\");\n\nvar _isArray =\n/*#__PURE__*/\nrequire(\"./internal/_isArray\");\n\nvar _isInteger =\n/*#__PURE__*/\nrequire(\"./internal/_isInteger\");\n\nvar assoc =\n/*#__PURE__*/\nrequire(\"./assoc\");\n\nvar isNil =\n/*#__PURE__*/\nrequire(\"./isNil\");\n/**\n * Makes a shallow clone of an object, setting or overriding the nodes required\n * to create the given path, and placing the specific value at the tail end of\n * that path. Note that this copies and flattens prototype properties onto the\n * new object as well. All non-primitive properties are copied by reference.\n *\n * @func\n * @memberOf R\n * @since v0.8.0\n * @category Object\n * @typedefn Idx = String | Int\n * @sig [Idx] -> a -> {a} -> {a}\n * @param {Array} path the path to set\n * @param {*} val The new value\n * @param {Object} obj The object to clone\n * @return {Object} A new object equivalent to the original except along the specified path.\n * @see R.dissocPath\n * @example\n *\n *      R.assocPath(['a', 'b', 'c'], 42, {a: {b: {c: 0}}}); //=> {a: {b: {c: 42}}}\n *\n *      // Any missing or non-object keys in path will be overridden\n *      R.assocPath(['a', 'b', 'c'], 42, {a: 5}); //=> {a: {b: {c: 42}}}\n */\n\n\nvar assocPath =\n/*#__PURE__*/\n_curry3(function assocPath(path, val, obj) {\n  if (path.length === 0) {\n    return val;\n  }\n\n  var idx = path[0];\n\n  if (path.length > 1) {\n    var nextObj = !isNil(obj) && _has(idx, obj) ? obj[idx] : _isInteger(path[1]) ? [] : {};\n    val = assocPath(Array.prototype.slice.call(path, 1), val, nextObj);\n  }\n\n  if (_isInteger(idx) && _isArray(obj)) {\n    var arr = [].concat(obj);\n    arr[idx] = val;\n    return arr;\n  } else {\n    return assoc(idx, val, obj);\n  }\n});\n\nmodule.exports = assocPath;","var _curry3 =\n/*#__PURE__*/\nrequire(\"./internal/_curry3\");\n/**\n * Inserts the supplied element into the list, at the specified `index`. _Note that\n\n * this is not destructive_: it returns a copy of the list with the changes.\n * <small>No lists have been harmed in the application of this function.</small>\n *\n * @func\n * @memberOf R\n * @since v0.2.2\n * @category List\n * @sig Number -> a -> [a] -> [a]\n * @param {Number} index The position to insert the element\n * @param {*} elt The element to insert into the Array\n * @param {Array} list The list to insert into\n * @return {Array} A new Array with `elt` inserted at `index`.\n * @example\n *\n *      R.insert(2, 'x', [1,2,3,4]); //=> [1,2,'x',3,4]\n */\n\n\nvar insert =\n/*#__PURE__*/\n_curry3(function insert(idx, elt, list) {\n  idx = idx < list.length && idx >= 0 ? idx : list.length;\n  var result = Array.prototype.slice.call(list, 0);\n  result.splice(idx, 0, elt);\n  return result;\n});\n\nmodule.exports = insert;","var nth =\n/*#__PURE__*/\nrequire(\"./nth\");\n/**\n * Returns the last element of the given list or string.\n *\n * @func\n * @memberOf R\n * @since v0.1.4\n * @category List\n * @sig [a] -> a | Undefined\n * @sig String -> String\n * @param {*} list\n * @return {*}\n * @see R.init, R.head, R.tail\n * @example\n *\n *      R.last(['fi', 'fo', 'fum']); //=> 'fum'\n *      R.last([]); //=> undefined\n *\n *      R.last('abc'); //=> 'c'\n *      R.last(''); //=> ''\n */\n\n\nvar last =\n/*#__PURE__*/\nnth(-1);\nmodule.exports = last;","var _curry2 =\n/*#__PURE__*/\nrequire(\"./internal/_curry2\");\n/**\n * Returns a new object that does not contain a `prop` property.\n *\n * @func\n * @memberOf R\n * @since v0.10.0\n * @category Object\n * @sig String -> {k: v} -> {k: v}\n * @param {String} prop The name of the property to dissociate\n * @param {Object} obj The object to clone\n * @return {Object} A new object equivalent to the original but without the specified property\n * @see R.assoc, R.omit\n * @example\n *\n *      R.dissoc('b', {a: 1, b: 2, c: 3}); //=> {a: 1, c: 3}\n */\n\n\nvar dissoc =\n/*#__PURE__*/\n_curry2(function dissoc(prop, obj) {\n  var result = {};\n\n  for (var p in obj) {\n    result[p] = obj[p];\n  }\n\n  delete result[prop];\n  return result;\n});\n\nmodule.exports = dissoc;","var _curry3 =\n/*#__PURE__*/\nrequire(\"./internal/_curry3\");\n/**\n * Removes the sub-list of `list` starting at index `start` and containing\n * `count` elements. _Note that this is not destructive_: it returns a copy of\n * the list with the changes.\n * <small>No lists have been harmed in the application of this function.</small>\n *\n * @func\n * @memberOf R\n * @since v0.2.2\n * @category List\n * @sig Number -> Number -> [a] -> [a]\n * @param {Number} start The position to start removing elements\n * @param {Number} count The number of elements to remove\n * @param {Array} list The list to remove from\n * @return {Array} A new Array with `count` elements from `start` removed.\n * @see R.without\n * @example\n *\n *      R.remove(2, 3, [1,2,3,4,5,6,7,8]); //=> [1,2,6,7,8]\n */\n\n\nvar remove =\n/*#__PURE__*/\n_curry3(function remove(start, count, list) {\n  var result = Array.prototype.slice.call(list, 0);\n  result.splice(start, count);\n  return result;\n});\n\nmodule.exports = remove;","/**\n * Private `concat` function to merge two array-like objects.\n *\n * @private\n * @param {Array|Arguments} [set1=[]] An array-like object.\n * @param {Array|Arguments} [set2=[]] An array-like object.\n * @return {Array} A new, merged array.\n * @example\n *\n *      _concat([4, 5, 6], [1, 2, 3]); //=> [4, 5, 6, 1, 2, 3]\n */\nfunction _concat(set1, set2) {\n  set1 = set1 || [];\n  set2 = set2 || [];\n  var idx;\n  var len1 = set1.length;\n  var len2 = set2.length;\n  var result = [];\n  idx = 0;\n\n  while (idx < len1) {\n    result[result.length] = set1[idx];\n    idx += 1;\n  }\n\n  idx = 0;\n\n  while (idx < len2) {\n    result[result.length] = set2[idx];\n    idx += 1;\n  }\n\n  return result;\n}\n\nmodule.exports = _concat;","var _concat =\n/*#__PURE__*/\nrequire(\"./internal/_concat\");\n\nvar _curry3 =\n/*#__PURE__*/\nrequire(\"./internal/_curry3\");\n/**\n * Applies a function to the value at the given index of an array, returning a\n * new copy of the array with the element at the given index replaced with the\n * result of the function application.\n *\n * @func\n * @memberOf R\n * @since v0.14.0\n * @category List\n * @sig Number -> (a -> a) -> [a] -> [a]\n * @param {Number} idx The index.\n * @param {Function} fn The function to apply.\n * @param {Array|Arguments} list An array-like object whose value\n *        at the supplied index will be replaced.\n * @return {Array} A copy of the supplied array-like object with\n *         the element at index `idx` replaced with the value\n *         returned by applying `fn` to the existing element.\n * @see R.update\n * @example\n *\n *      R.adjust(1, R.toUpper, ['a', 'b', 'c', 'd']);      //=> ['a', 'B', 'c', 'd']\n *      R.adjust(-1, R.toUpper, ['a', 'b', 'c', 'd']);     //=> ['a', 'b', 'c', 'D']\n * @symb R.adjust(-1, f, [a, b]) = [a, f(b)]\n * @symb R.adjust(0, f, [a, b]) = [f(a), b]\n */\n\n\nvar adjust =\n/*#__PURE__*/\n_curry3(function adjust(idx, fn, list) {\n  if (idx >= list.length || idx < -list.length) {\n    return list;\n  }\n\n  var start = idx < 0 ? list.length : 0;\n\n  var _idx = start + idx;\n\n  var _list = _concat(list);\n\n  _list[_idx] = fn(list[_idx]);\n  return _list;\n});\n\nmodule.exports = adjust;","var _curry1 =\n/*#__PURE__*/\nrequire(\"./internal/_curry1\");\n/**\n * Returns a function that always returns the given value. Note that for\n * non-primitives the value returned is a reference to the original value.\n *\n * This function is known as `const`, `constant`, or `K` (for K combinator) in\n * other languages and libraries.\n *\n * @func\n * @memberOf R\n * @since v0.1.0\n * @category Function\n * @sig a -> (* -> a)\n * @param {*} val The value to wrap in a function\n * @return {Function} A Function :: * -> val.\n * @example\n *\n *      const t = R.always('Tee');\n *      t(); //=> 'Tee'\n */\n\n\nvar always =\n/*#__PURE__*/\n_curry1(function always(val) {\n  return function () {\n    return val;\n  };\n});\n\nmodule.exports = always;","var _curry3 =\n/*#__PURE__*/\nrequire(\"./internal/_curry3\");\n\nvar adjust =\n/*#__PURE__*/\nrequire(\"./adjust\");\n\nvar always =\n/*#__PURE__*/\nrequire(\"./always\");\n/**\n * Returns a new copy of the array with the element at the provided index\n * replaced with the given value.\n *\n * @func\n * @memberOf R\n * @since v0.14.0\n * @category List\n * @sig Number -> a -> [a] -> [a]\n * @param {Number} idx The index to update.\n * @param {*} x The value to exist at the given index of the returned array.\n * @param {Array|Arguments} list The source array-like object to be updated.\n * @return {Array} A copy of `list` with the value at index `idx` replaced with `x`.\n * @see R.adjust\n * @example\n *\n *      R.update(1, '_', ['a', 'b', 'c']);      //=> ['a', '_', 'c']\n *      R.update(-1, '_', ['a', 'b', 'c']);     //=> ['a', 'b', '_']\n * @symb R.update(-1, a, [b, c]) = [b, a]\n * @symb R.update(0, a, [b, c]) = [a, c]\n * @symb R.update(1, a, [b, c]) = [b, a]\n */\n\n\nvar update =\n/*#__PURE__*/\n_curry3(function update(idx, x, list) {\n  return adjust(idx, always(x), list);\n});\n\nmodule.exports = update;","/**\r\n * This is the core data store object in Unmagical, and it is an abstract data type.\r\n * @module core/env\r\n */\r\n\r\nimport {normalizePath, typeOf, isIntStr, normalizePathArray, appendPath, Index} from './utils'\r\nimport rhasPath from 'ramda/src/hasPath'\r\nimport init from 'ramda/src/init'\r\nimport rpath from 'ramda/src/path'\r\nimport assocPath from 'ramda/src/assocPath'\r\nimport insert from 'ramda/src/insert'\r\nimport last from 'ramda/src/last'\r\nimport dissoc from 'ramda/src/dissoc'\r\nimport rremove from 'ramda/src/remove'\r\nimport update from 'ramda/src/update'\r\nimport {Json, Schema, Slot, SchemaDb, Lookup, Validate} from './schema'\r\n\r\ntype MutateSlot = (slot:Slot, path:string) => Slot\r\ntype ReduceSlot<T> = (cur:T, slot:Slot, path:string) => T\r\n\r\n/**\r\n * Env is the abstract data type.\r\n * @ignore\r\n */\r\nexport type Env = {\r\n  tree: Json, \r\n  trackUpdate: boolean, \r\n  updatePoint: Index[], \r\n  schemaDb: SchemaDb, \r\n  validate: Validate, \r\n  extra: Record<string,any>, \r\n  ret?: any, \r\n  onPromiseThen?: any\r\n}\r\n\r\n\r\n/**\r\n * see: https://github.com/ramda/ramda/pull/2841\r\n * Anyway, here we fix the original behavior.\r\n * @function\r\n * @private\r\n * @param {string[]} path \r\n * @param {any} x \r\n * @return {boolean}\r\n */\r\nconst hasPath = (path:Index[], x:any):boolean => {\r\n  if (! path.length) return true\r\n  return rhasPath(path as string[], x)\r\n}\r\n\r\n/**\r\n * \r\n * @function\r\n * @private\r\n */\r\nconst init2 = <T>(list:T[]) => {\r\n  return init(init(list))\r\n}\r\n\r\n/**\r\n * \r\n * @function\r\n * @private\r\n * @param {Json} value \r\n * @return {Slot} \r\n */\r\nconst makeSlot = (value:Json):Slot => {\r\n  const rv:Slot = {value, invalid:false, error:null}\r\n  switch (typeOf(value)) {\r\n    case 'object': // FALLTHRU\r\n    case 'array': \r\n      break\r\n    case 'number': // FALLTHRU\r\n    case 'integer': \r\n      rv.input = '' + value\r\n      rv.touched = false\r\n      break\r\n    case 'boolean': \r\n      rv.input = (value) ? 'true' : 'false'\r\n      rv.touched = false\r\n      break\r\n    case 'null': \r\n      rv.input = ''\r\n      rv.touched = false\r\n      break\r\n    case 'string': \r\n      rv.input = value as string\r\n      rv.touched = false\r\n      break\r\n  }\r\n  return rv\r\n}\r\n\r\n/**\r\n * \r\n * @function\r\n * @private\r\n * @param {Json} data \r\n * @returns {Slot}\r\n */\r\nconst wrap = (data):Slot => {\r\n  /** @type {(data:Json) => Slot} */\r\n  const inner = (data:Json):Slot => {\r\n    switch (typeOf(data)) {\r\n      case 'array': \r\n        const es = []\r\n        for (let i = 0; i < (data as Json[]).length; i++) {\r\n          es[i] = inner(data[i])\r\n        }\r\n        return makeSlot(es)\r\n      case 'object': \r\n        const rec = {}\r\n        for (let p in (data as Object)) {\r\n          rec[p] = inner(data[p])\r\n        }\r\n        return makeSlot(rec)\r\n      default: \r\n        return makeSlot(data)\r\n    }\r\n  }\r\n  return inner(data)\r\n}\r\n\r\n/**\r\n * \r\n * @function\r\n * @private\r\n * @param {Json} tree \r\n * @returns {Json}\r\n */\r\nconst strip = (tree:Json):Json => {\r\n  const root = (tree as Slot).value\r\n  switch (typeOf(root)) {\r\n    case 'array': \r\n      const es = []\r\n      for (let i = 0; i < (root as Json[]).length; i++) {\r\n        es[i] = strip(root[i])\r\n      }\r\n      return es\r\n    case 'object': \r\n      const rec = {}\r\n      for (let p in (root as Object)) {\r\n        rec[p] = strip(root[p])\r\n      }\r\n      return rec\r\n    default: \r\n      return root\r\n  }\r\n}\r\n\r\n/**\r\n * @en Makes env.\r\n * @ja Env\r\n * @param data\r\n * - `en` initial data\r\n * - `ja` \r\n * @param schemaDb\r\n * - `en` schema database\r\n * - `ja` \r\n * @param validate\r\n * - `en` validation function\r\n * - `ja` \r\n * @param trackUpdate\r\n * - `en` if true, then env is created with update tracking in place.\r\n * - `ja` trueenv\r\n * @returns \r\n * - `en` newly created env\r\n * - `ja` env\r\n * \r\n * @category Entries\r\n */\r\nexport const makeEnv = (data:Json, schemaDb:SchemaDb, validate:Validate, trackUpdate:boolean):Env => {\r\n  const tree = wrap(data) as Json\r\n  return {\r\n    tree, \r\n    trackUpdate, \r\n    updatePoint: trackUpdate ? [] : null, \r\n    schemaDb, \r\n    validate, \r\n    extra: {}\r\n  }\r\n}\r\n\r\n/**\r\n * \r\n * @function\r\n * @param {Env} env0 \r\n * @param {Env} env1 \r\n * @returns {boolean}\r\n * \r\n * @category Entries\r\n */\r\nexport const isSame = (env0:Env, env1:Env):boolean => {\r\n  return (env0.tree === env1.tree && env0.extra === env1.extra)\r\n}\r\n\r\n/**\r\n * Internalizes a path\r\n * @function\r\n * @private\r\n * @param {string} path \r\n * @returns {(string|number)[]}\r\n */\r\nconst internPath = (path:string):Index[] => {\r\n  const frags = path.split('/')\r\n  const rv = []\r\n  for (let i = 1; i < frags.length; i++) {\r\n    rv.push('value')\r\n    rv.push(isIntStr(frags[i]) ? +frags[i] : frags[i])\r\n  }\r\n  return rv\r\n}\r\n\r\n/**\r\n * \r\n * @function\r\n * @private\r\n * @param {(string|number)[]} path \r\n * @returns {string}\r\n */\r\nconst externPath = (path:Index[]):string => {\r\n  let rv = \"\"\r\n  for (let i = 0; i < path.length; i += 2) {\r\n    rv += \"/\" + path[i + 1]\r\n  }\r\n  return rv\r\n}\r\n\r\n/**\r\n * \r\n * @function\r\n * @private\r\n * @param {((string|number)[])|null} path0 \r\n * @param {((string|number)[])|null} path1\r\n * @returns {((string|number)[])|null} \r\n */\r\nconst intersect = (path0:Index[]|null, path1:Index[]|null):Index[]|null => {\r\n  if (path0 === null) return path1\r\n  if (path1 === null) return path0\r\n\r\n  const rv = []\r\n  for (let i = 0; i < path0.length; i += 2) {\r\n    if (i >= path1.length) break\r\n    if (path0[i + 1] !== path1[i + 1]) break\r\n    rv.push(path0[i])\r\n    rv.push(path0[i + 1])\r\n  }\r\n  return rv\r\n}\r\n\r\n/**\r\n * \r\n * @function\r\n * @param {Env} env \r\n * @returns {Env}\r\n * \r\n * @category Entries\r\n */\r\nexport const beginUpdateTracking = (env:Env):Env => {\r\n  // Essentially, `updatePoint' should be set to null, but it can be omitted \r\n  // because the value when disabled is null.\r\n  return {...env, trackUpdate:true}\r\n}\r\n\r\n/**\r\n * \r\n * @function\r\n * @param {Env} env \r\n * @returns {[string|null, Env]}\r\n * \r\n * @category Entries\r\n */\r\nexport const endUpdateTracking = (env:Env):[string|null, Env] => {\r\n  const updatePoint = env.updatePoint ? externPath(env.updatePoint) : null\r\n  console.log('update occurred at ' + JSON.stringify(updatePoint))\r\n  return [\r\n    updatePoint, \r\n    {...env, trackUpdate:false, updatePoint:null}\r\n  ]\r\n}\r\n\r\n/**\r\n * \r\n * @function\r\n * @param {string} path \r\n * @param {Env} env \r\n * @returns {boolean}\r\n * \r\n * @category Entries\r\n */\r\nexport const test = (path:string, env:Env):boolean => {\r\n  return hasPath(/** @type {string[]} */ (internPath(path)), env.tree)\r\n}\r\n\r\n/**\r\n * Extracts a subtree of Env.\r\n * @function\r\n * @param {string} path\r\n * @param {Env} env\r\n * @returns {Json}\r\n * \r\n * @category Entries\r\n */\r\nexport const extract = (path:string, env:Env):Json => {\r\n  const epath = /** @type {string[]} */ (internPath(path))\r\n  const slot = rpath(epath, env.tree)\r\n  if (! slot) {\r\n    throw new Error('extract/1: not found: ' + path)\r\n  }\r\n  return strip(slot as Json)\r\n}\r\n\r\n/**\r\n * Low-level api.\r\n * @function\r\n * @param {string} path \r\n * @param {Env} env\r\n * @returns {Slot} \r\n * \r\n * @category Entries\r\n */\r\nexport const getSlot = (path:string, env:Env):Slot => {\r\n  const epath = /** @type {string[]} */ (internPath(path))\r\n  const slot = rpath(epath, env.tree)\r\n  if (! slot) {\r\n    throw new Error('getSlot/1: not found: ' + path)\r\n  }\r\n  return slot\r\n}\r\n\r\n/**\r\n * Low-level api. This function executes neither validation nor coercion.\r\n * @function\r\n * @param {string} path \r\n * @param {Slot} slot \r\n * @param {Env} env\r\n * @returns {Env} \r\n * \r\n * slot value must be a scalar.\r\n * \r\n * @category Entries\r\n */\r\nexport const setSlot = (path:string, slot:Slot, env:Env):Env => {\r\n  const epath = internPath(path)\r\n  const slot0 = rpath(epath, env.tree) as Slot\r\n  if (! slot0) {\r\n    throw new Error('setSlot/1: not found: ' + path)\r\n  }\r\n  switch (typeOf(slot0.value)) {\r\n    case 'null': \r\n    case 'boolean': \r\n    case 'number': \r\n    case 'string': \r\n    case 'undefined': \r\n      break\r\n    default: \r\n      throw new Error('setSlot/2: not a scalar: ' + path)\r\n  }\r\n  const tree = assocPath(epath, slot, env.tree)\r\n  const updatePoint = env.trackUpdate ? intersect(env.updatePoint, epath) : env.updatePoint\r\n  return {...env, tree, updatePoint}\r\n}\r\n\r\n/**\r\n * Adds value to env. `add' function of JSON patch.\r\n * @function\r\n * @param {string} path \r\n * @param {Json} value \r\n * @param {Env} env \r\n * @returns {Env}\r\n * \r\n * @category Entries\r\n */\r\nexport const add = (path:string, value:Json, env:Env):Env => {\r\n  const epath = internPath(path)\r\n  const location = init2(epath)\r\n  const name = last(epath)\r\n  const slot0 = rpath(location, env.tree) as Slot\r\n  const type0 = typeOf(slot0.value)\r\n  if (type0 != 'object' && type0 != 'array') {\r\n    throw new Error('add/1 neither an object nor an array: ' + path)\r\n  }\r\n  if (type0 == 'array') {\r\n    // insert into array\r\n    const index = (name === '-') ? (slot0.value as Json[]).length : name\r\n    if (typeof index != 'number' || index % 1 !== 0) {\r\n      throw new Error('add/2 invalid index: ' + path)\r\n    }\r\n    if (index < 0 || index > (slot0.value as Json[]).length) {\r\n      throw new Error('add/3 index out of range: ' + path)\r\n    }\r\n    const value1 = wrap(value) as Json\r\n    const lis = insert(index, value1, slot0.value as Json[])\r\n    const slot = makeSlot(lis)\r\n    const tree = assocPath(location, slot, env.tree)\r\n    // Insertion to a list is an update not to an item but to the list.\r\n    const updatePoint = env.trackUpdate ? intersect(env.updatePoint, location) : env.updatePoint\r\n    return {...env, tree, updatePoint}\r\n  } else {\r\n    // define or replace into object\r\n    if (typeof name != 'string') {\r\n      throw new Error('add/4 invalid name: ' + path)\r\n    }\r\n    const value1 = wrap(value)\r\n    const rec = {...(slot0.value as {[prop:string]:Json}), [name]:value1} as Json\r\n    const slot = makeSlot(rec)\r\n    const tree = assocPath(location, slot, env.tree)\r\n    // Adding a property is an update to an object, while replacing a property is an update to an property value.\r\n    const updatePoint = !env.trackUpdate ? env.updatePoint \r\n      : intersect(env.updatePoint, (name in (slot0.value as Object)) ? epath : location)\r\n    return {...env, tree, updatePoint}\r\n  }\r\n}\r\n\r\n/**\r\n * Removes a value specified by path from env. `remove' function of JSON patch.\r\n * @function\r\n * @param {string} path \r\n * @param {Env} env \r\n * @returns {Env}\r\n * @category Entries\r\n */\r\nexport const remove = (path:string, env:Env):Env => {\r\n  const epath = internPath(path)\r\n  const location = init2(epath)\r\n  const name = last(epath)\r\n  const slot0 = rpath(location, env.tree) as Slot\r\n  const type0 = typeOf(slot0.value)\r\n  if (type0 != 'object' && type0 != 'array') {\r\n    throw new Error('remove/1 neither an object nor an array: ' + path)\r\n  }\r\n  if (type0 == 'array') {\r\n    // removes from array\r\n    if (typeof name != 'number' || name % 1 !== 0) {\r\n      throw new Error('remove/2 invalid index: ' + path)\r\n    }\r\n    if (name < 0 || name >= (slot0.value as Json[]).length) {\r\n      throw new Error('remove/3 out of range: ' + path)\r\n    }\r\n    const lis = rremove(name, 1, slot0.value as Json[])\r\n    const slot = makeSlot(lis)\r\n    const tree = assocPath(location, slot, env.tree)\r\n    const updatePoint = env.trackUpdate ? intersect(env.updatePoint, location) : env.updatePoint\r\n    return {...env, tree, updatePoint}\r\n  } else {\r\n    // delete property from object\r\n    if (! slot0.value.hasOwnProperty(name)) {\r\n      throw new Error('remove/4: property not found: ' + path)\r\n    }\r\n    const rec = dissoc(name as never, slot0.value as object)\r\n    const slot = makeSlot(rec)\r\n    const tree = assocPath(location, slot, env.tree)\r\n    const updatePoint = env.trackUpdate ? intersect(env.updatePoint, location) : env.updatePoint\r\n    return {...env, tree, updatePoint}\r\n  }\r\n}\r\n\r\n/**\r\n * Replaces a value specified by path into value.  Implements replace function of JSON patch.\r\n * @function\r\n * @param {string} path \r\n * @param {Json} value \r\n * @param {Env} env \r\n * @returns {Env}\r\n * @category Entries\r\n */\r\nexport const replace = (path:string, value:Json, env:Env):Env => {\r\n  const epath = internPath(path)\r\n  if (epath.length == 0) {\r\n    // replace whole data\r\n    const tree = wrap(value) as Json\r\n    const updatePoint = env.trackUpdate ? [] : env.updatePoint\r\n    return {...env, tree, updatePoint}\r\n  }\r\n  const location = init2(epath)\r\n  const name = last(epath)\r\n  const slot0 = rpath(location, env.tree) as Slot\r\n  const type0 = typeOf(slot0.value)\r\n  if (type0 != 'object' && type0 != 'array') {\r\n    throw new Error('replace/1 neither an object nor an array: ' + path)\r\n  }\r\n  if (type0 == 'array') {\r\n    // replace an element in array\r\n    if (typeof name != 'number' || name % 1 !== 0) {\r\n      throw new Error('replace/2 invalid index: ' + path)\r\n    }\r\n    if (name < 0 || name >= (slot0.value as Json[]).length) {\r\n      throw new Error('replace/3 out of range: ' + path)\r\n    }\r\n    const value1 = wrap(value) as Json\r\n    const lis = update(name, value1, slot0.value as Json[])\r\n    const slot = makeSlot(lis)\r\n    const tree = assocPath(location, slot, env.tree)\r\n    const updatePoint = env.trackUpdate ? intersect(env.updatePoint, epath) : env.updatePoint\r\n    return {...env, tree, updatePoint}\r\n  } else {\r\n    // replace a property of object\r\n    if (typeof name != 'string') {\r\n      throw new Error('replace/4 invalid name: ' + path)\r\n    }\r\n    if (!(name in (slot0.value as {[prop:string]:Json}))) {\r\n      throw new Error('replace/5 undefined property: ' + path)\r\n    }\r\n    const value1 = wrap(value)\r\n    const rec = {...(slot0.value as {[prop:string]:Json}), [name]:value1} as {[prop:string]:Json}\r\n    const slot = makeSlot(rec)\r\n    const tree = assocPath(location, slot, env.tree)\r\n    const updatePoint = env.trackUpdate ? intersect(env.updatePoint, epath) : env.updatePoint\r\n    return {...env, tree, updatePoint}\r\n  }\r\n}\r\n\r\n/**\r\n * Moves a value located in from, to a location specified by path.  Implements move function of JSON patch.\r\n * @function\r\n * @param {string} from \r\n * @param {string} path \r\n * @param {Env} env\r\n * @returns {Env} \r\n * @category Entries\r\n */\r\nexport const move = (from:string, path:string, env:Env):Env => {\r\n  const value = extract(from, env)\r\n  env = remove(from, env)\r\n  env = add(path, value, env)\r\n  return env\r\n}\r\n\r\n/**\r\n * Copies a value located in from, to a location specified by path.  Impelementing copy function of JSON patch.\r\n * @function\r\n * @param {string} from \r\n * @param {string} path \r\n * @param {Env} env\r\n * @returns {Env} \r\n * @category Entries\r\n */\r\nexport const copy = (from:string, path:string, env:Env):Env => {\r\n  const value = extract(from, env)\r\n  env = add(path, value, env)\r\n  return env\r\n}\r\n\r\n/**\r\n * \r\n * @function\r\n * @param {string} path \r\n * @param {Env} env\r\n * @returns {Env} \r\n * @category Entries\r\n */\r\nexport const validate = (path:string, env:Env):Env => {\r\n  let basePath = null\r\n\r\n  /**\r\n   * \r\n   * @param {string} path \r\n   * @returns {Json}\r\n   */\r\n  const lookup = (path) => {\r\n    const pathToLookup = appendPath(basePath, path)\r\n    return extract(pathToLookup, env)\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param {Slot} slot0 \r\n   * @param {string} npath\r\n   * @param {string} path\r\n   * @returns {Slot} \r\n   */\r\n  const inner = (slot0:Slot, npath:string, path:string):Slot => {\r\n    const value0 = slot0.value\r\n    switch (typeOf(value0)) {\r\n      case 'array': \r\n        const lis = []\r\n        for (let i = 0; i < (value0 as Json[]).length; i++) {\r\n          lis[i] = inner(value0[i], npath + '/*', path + '/' + i)\r\n        }\r\n        basePath = path\r\n        return env.validate(lis, slot0, env.schemaDb[npath], lookup)\r\n      case 'object': \r\n        const rec = {}\r\n        for (let p in  (value0 as Record<string,Json>)) {\r\n          rec[p] = inner(value0[p], npath + '/' + p, path + '/' + p)\r\n        }\r\n        basePath = path\r\n        return env.validate(rec, slot0, env.schemaDb[npath], lookup)\r\n      default: \r\n        basePath = path\r\n        const slot = env.validate(value0, slot0, env.schemaDb[npath], lookup)\r\n        if (slot.value !== value0) {\r\n          throw new Error('validate/0: value changed: ' + path)\r\n        }\r\n        return slot\r\n    }\r\n  }\r\n\r\n  const epath = internPath(path)\r\n  const slot0 = rpath(epath, env.tree)\r\n  if (! slot0) {\r\n    throw new Error('validate/1: not found: ' + path)\r\n  }\r\n  const slot = inner(slot0, normalizePath(path), path)\r\n  const tree = assocPath(epath, slot, env.tree)\r\n  return {...env, tree}\r\n}\r\n\r\n/**\r\n * By f, maps every slot descending to a location specified by path.\r\n * @function\r\n * @param {MutateSlotFunc} f \r\n * @param {string} path \r\n * @param {Env} env \r\n * @returns {Env}\r\n * @category Entries\r\n */\r\nexport const mapDeep = (f:MutateSlot, path:string, env:Env):Env => {\r\n  const inner = (slot0:Slot, path:string):Slot => {\r\n    const value0 = slot0.value\r\n    switch (typeOf(value0)) {\r\n      case 'array': \r\n        const lis = []\r\n        for (let i = 0; i < (value0 as Json[]).length; i++) {\r\n          lis[i] = inner(value0[i], path + '/' + i)\r\n        }\r\n        return {...f(slot0, path), value:lis}\r\n      case 'object': \r\n        const rec = {}\r\n        for (let p in (value0 as Record<string,Json>)) {\r\n          rec[p] = inner(value0[p], path + '/' + p)\r\n        }\r\n        return {...f(slot0, path), value:rec}\r\n      default: \r\n        return {...f(slot0, path), value:value0}\r\n    }\r\n  }\r\n  const epath = internPath(path)\r\n  const slot0 = rpath(epath, env.tree)\r\n  if (! slot0) {\r\n    throw new Error('mapDeep/1: not found: ' + path)\r\n  }\r\n  const slot = inner(slot0, path)\r\n  const tree = assocPath(epath, slot, env.tree)\r\n  return {...env, tree}\r\n}\r\n\r\n/**\r\n * By f, deeply reduces a subtree of path.\r\n * @function\r\n * @template T\r\n * @param {ReduceSlotFunc<T>} f \r\n * @param {T} cur \r\n * @param {string} path \r\n * @param {Env} env \r\n * @returns {T}\r\n * @category Entries\r\n */\r\nexport const reduceDeep = <T>(f:ReduceSlot<T>, cur:T, path:string, env:Env):T => {\r\n  const inner = (cur:T, slot:Slot, path:string):T => {\r\n    const value0 = slot.value\r\n    switch (typeOf(value0)) {\r\n      case 'array': \r\n        for (let i = 0; i < (value0 as Json[]).length; i++) {\r\n          cur = inner(cur, value0[i], path + '/' + i)\r\n        }\r\n        return f(cur, slot, path)\r\n      case 'object': \r\n        for (let p in (value0 as Record<string,Json>)) {\r\n          cur = inner(cur, value0[p], path + '/' + p)\r\n        }\r\n        return f(cur, slot, path)\r\n      default: \r\n        return f(cur, slot, path)\r\n    }\r\n  }\r\n  const epath = internPath(path)\r\n  const slot = rpath(epath, env.tree)\r\n  if (! slot) {\r\n    throw new Error('reduceDeep/1: not found: ' + path)\r\n  }\r\n  return inner(cur, slot, path)\r\n}\r\n\r\n/**\r\n * \r\n * @param path \r\n * @param fromEnv \r\n * @param toEnv \r\n * @category Entries\r\n */\r\nexport const duplicate = (path:string, fromEnv:Env, toEnv:Env):Env => {\r\n  const epath = internPath(path)\r\n  if (epath.length == 0) {\r\n    // duplicate whole data\r\n    const tree = fromEnv.tree\r\n    const updatePoint = toEnv.trackUpdate ? [] : toEnv.updatePoint\r\n    return {...toEnv, tree, updatePoint}\r\n  }\r\n  const location = init2(epath)\r\n  const name = last(epath)\r\n  const slot0 = rpath(location, fromEnv.tree) as Slot\r\n  const type0 = typeOf(slot0.value)\r\n  if (type0 != 'object' && type0 != 'array') {\r\n    throw new Error('duplicate/1 neither an object nor an array: ' + path)\r\n  }\r\n  if (type0 == 'array') {\r\n    // duplicate an element in an array\r\n    if (typeof name != 'number' || name % 1 !== 0) {\r\n      throw new Error('duplicate/2 invalid index: ' + path)\r\n    }\r\n    if (name < 0 || name >= (slot0.value as Json[]).length) {\r\n      throw new Error('duplicate/3 out of range: ' + path)\r\n    }\r\n    const value1 = slot0.value[name]\r\n    const lis = update(name, value1, slot0.value as Json[])\r\n    const slot = makeSlot(lis)\r\n    const tree = assocPath(location, slot, toEnv.tree)\r\n    const updatePoint = toEnv.trackUpdate ? intersect(toEnv.updatePoint, epath) : toEnv.updatePoint\r\n    return {...toEnv, tree, updatePoint}\r\n  } else {\r\n    // duplicate a property of an object\r\n    if (typeof name != 'string') {\r\n      throw new Error('replace/4 invalid name: ' + path)\r\n    }\r\n    if (!(name in (slot0.value as Record<string,Json>))) {\r\n      throw new Error('replace/5 undefined property: ' + path)\r\n    }\r\n    const value1 = slot0.value[name]\r\n    const rec = {...(slot0.value as Record<string,Json>), [name]:value1}\r\n    const slot = makeSlot(rec)\r\n    const tree = assocPath(location, slot, toEnv.tree)\r\n    const updatePoint = toEnv.trackUpdate ? intersect(toEnv.updatePoint, epath) : toEnv.updatePoint\r\n    return {...toEnv, tree, updatePoint}\r\n  }\r\n}\r\n\r\n/**\r\n * \r\n * @function\r\n * @param {string} name \r\n * @param {Object|null} info \r\n * @param {Env} env\r\n * @returns {Env} \r\n * @category Entries\r\n */\r\nexport const setExtra = (name:string, info:Object|null, env:Env):Env => {\r\n  if (info === null) {\r\n    const {[name]:_unused, ...extra} = env.extra\r\n    return {...env, extra}\r\n  } else {\r\n    const extra = {...env.extra, [name]:info}\r\n    return {...env, extra}\r\n  }\r\n}\r\n\r\n/**\r\n * \r\n * @function\r\n * @param {string} name \r\n * @param {Env} env\r\n * @returns {Object|null} \r\n * @category Entries\r\n */\r\nexport const getExtra = (name:string, env:Env):Object|null => {\r\n  return env.extra[name] || null\r\n}\r\n\r\n/**\r\n * \r\n * @function\r\n * @param {any} ret \r\n * @param {any} onPromiseThen\r\n * @param {Env} env \r\n * @returns {Env}\r\n * @category Entries\r\n */\r\nexport const setPortal = (ret:any, onPromiseThen:any, env:Env):Env => {\r\n  if (ret) return {...env, ret, onPromiseThen}\r\n  const {ret:_unused, onPromiseThen:_unused2, ...env2} = env\r\n  return env2\r\n}\r\n\r\n/**\r\n * \r\n * @function\r\n * @param {Env} env\r\n * @returns {void} \r\n * @category Entries\r\n */\r\nexport const doReturn = (env:Env):void => {\r\n  if (env.ret) {\r\n    env.ret(env)\r\n  } else {\r\n    throw new Error('doReturn/0: no ret')\r\n  }\r\n}\r\n\r\n/**\r\n * \r\n * @function\r\n * @param {any} x\r\n * @returns {boolean} \r\n * @category Entries\r\n */\r\nexport const isEnv = (x:any):boolean => {\r\n  return (x != null \r\n    && typeof x == \"object\" \r\n    && \"tree\" in x)\r\n}","/**\r\n * Predefined valiation rules\r\n * \r\n * @module core/rules\r\n */\r\n\r\nimport {typeOf} from './utils'\r\nimport {Scalar} from './errors'\r\nimport {RuleFunc, Json, Schema, nullable, applyRules} from './schema'\r\n\r\n\r\ntype SwitchRequiredParam = {tagProperty:string, types:{[tag:string]:string[]}}\r\n\r\ntype IfParam = [string, Schema, Schema, Schema?]\r\n\r\n/**\r\n * Returns true if the value is in an specified type\r\n */\r\nconst testType = (value:Json, type:string):boolean => {\r\n  if (! type) return true\r\n  if (value === null) {\r\n    return nullable(type)\r\n  } else {\r\n    switch (type) {\r\n      case 'null': \r\n        return false\r\n      case 'number':  // FALLTHRU\r\n      case 'number?': \r\n        return typeof value == 'number'\r\n      case 'integer':  // FALLTHRU\r\n      case 'integer?': \r\n        return (typeof value == 'number' && value % 1 === 0)\r\n      case 'boolean':  // FALLTHRU\r\n      case 'boolean?': \r\n        return typeof value == 'boolean'\r\n      case 'string': \r\n        return typeof value == 'string'\r\n      case 'object':  // FALLTHRU\r\n      case 'object?': \r\n        return (typeof value == 'object' && value !== null)\r\n      case 'array':  // FALLTHRU\r\n      case 'array?': \r\n        return Array.isArray(value)\r\n      default: \r\n        throw new Error('unknown type: ' + type)\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Valid if a type of `value` is that specified by `param`.\r\n * @param param null|boolean|boolean?|integer|integer?|number|number?|string|object|object?|array|array?\r\n * @param value value to validate\r\n * @category Predefined Rules\r\n */\r\nexport const type:RuleFunc = (param, value) => {\r\n  if (typeof param != 'string') throw new Error('invalid type')\r\n  const result = testType(value, param)\r\n  if (! result) return {code:'type.'+param}\r\n  return true\r\n}\r\n\r\n/**\r\n * Valid if `value` is either of values in `param`. Comparison is executed with `===`.\r\n * @param param candidates\r\n * @param value value to validate\r\n * @category Predefined Rules\r\n */\r\nexport const $enum:RuleFunc = (param:Json[], value) => {\r\n  if (! Array.isArray(param)) throw new Error('invalid parameter')\r\n  for (let i = 0; i < param.length; i++) {\r\n    if (param[i] === value) return true\r\n  }\r\n  return {code:'rule.enum'}\r\n}\r\n\r\n/**\r\n * Valid if `value` is `===` to `param`.\r\n * @param param const\r\n * @param value value to validate\r\n * @category Predefined Rules\r\n */\r\nexport const $const:RuleFunc = (param, value) => {\r\n  if (param === value) return true\r\n  switch (typeOf(param)) {\r\n    case 'string': \r\n    case 'number': \r\n    case 'null': \r\n    case 'boolean': \r\n      return {code:'rule.const', hint:(param as Scalar)}\r\n    default: \r\n      return {code:'rule.const.nohint'}\r\n  }\r\n}\r\n\r\n/**\r\n * Valid if `value` is not a empty string.<br>\r\n * If `value` is not a string, then valid.\r\n * @param _param unused\r\n * @param value \r\n * @category Predefined Rules\r\n */\r\nexport const notEmpty:RuleFunc = (_param, value) => {\r\n  if (typeOf(value) != 'string') return true\r\n  if (value !== '') return true\r\n  return {code:'rule.notEmpty'}\r\n}\r\n\r\n/**\r\n * Valid if `value` of Object has all properties specifed by `param`.\r\n * If `value` is not an Object, then valid.\r\n * @param param a list of property names\r\n * @param value \r\n * @category Predefined Rules\r\n */\r\nexport const required:RuleFunc = (param, value) => {\r\n  if (! Array.isArray(param)) throw new Error('invalid parameter')\r\n  if (typeOf(value) != 'object') return true\r\n  for (let i = 0; i < param.length; i++) {\r\n    if (! value.hasOwnProperty(param[i] as string)) return {code:'rule.required', hint:param[i] as string}\r\n  }\r\n  return true\r\n}\r\n\r\n/**\r\n * Valid if `value` of Object is an instance of a tagged union specified by `param`\r\n * @example\r\n * ```javascript\r\n * param = {\r\n *   tagProperty: \"tag\", \r\n *   types: {\r\n *     leafOf: [\"value\"], \r\n *     nodeOf: [\"left\", \"right\"]\r\n *   }\r\n * }\r\n * switchRequired of `{tag:\"leafOf\", value:1}` evaludates valid.\r\n * switchRequired of `{tag:\"nodeOf\", left:otherNode}` evaluates invalid since `right` property is missing.\r\n * ```\r\n * @remark\r\n * We can use tagged unions by using the switchRequired rule.<br>\r\n * But notice, even if the property sets are different, if the property names \r\n * are the same, the schema will be the same.\r\n * @param param \r\n * @param value \r\n * @param lookup \r\n * @category Predefined Rules\r\n */\r\nexport const switchRequired:RuleFunc = (param, value, lookup) => {\r\n  if (typeOf(param) != 'object' || !('tagProperty' in (param as object))) throw new Error('invalid parameter')\r\n  if (typeOf(value) != 'object') return true\r\n  param = param as SwitchRequiredParam\r\n  const tag = lookup('0/' + param.tagProperty) as string\r\n  if (! tag) return {code:'rule.switchRequired.nohint', decription:'no tag'}\r\n  if (! param.types[tag]) return {code:'rule.switchRequired.nohint', detail:'no type'}\r\n  const required = param.types[tag]\r\n  if (! Array.isArray(required)) throw new Error('invalid parameter')\r\n  for (let i = 0; i < required.length; i++) {\r\n    if (! value.hasOwnProperty(required[i])) return {code:'rule.switchRequired', hint:required[i]}\r\n  }\r\n  return true\r\n}\r\n\r\n/**\r\n * Valid if `value` is strictly equals to a value located in a path specified by `param`.\r\n * @param param path to the value to be compared\r\n * @param value \r\n * @param lookup \r\n * @category Predefined Rules\r\n */\r\nexport const same:RuleFunc = (param, value, lookup) => {\r\n  if (typeof param != 'string') throw new Error('invalid parameter')\r\n  const target = lookup(param)\r\n  if (target !== value) {\r\n    switch (typeOf(target)) {\r\n      case 'string': \r\n      case 'number': \r\n      case 'null': \r\n      case 'boolean': \r\n        return {code:'rule.same', hint: target as Scalar}\r\n      default: \r\n        return {code:'rule.same.nohint'}\r\n    }\r\n  }\r\n  return true\r\n}\r\n\r\n/**\r\n * Valid if either of: \r\n * - {target} conforms the rules of {match}, and `value` conforms the rules of {then}.\r\n * - {target} doesn't conform the rules of {match}, and `value` conforms the rules of {else}.\r\n * Where `param` is an array of:\r\n * - {target} -- path to the target value\r\n * - {match} -- rules for target\r\n * - {then} -- rules of then clause\r\n * - {else} -- rules of else clause\r\n * @param param \r\n * @param value \r\n * @param lookup \r\n * @param rules \r\n * @category Predefined Rules\r\n */\r\nexport const $if:RuleFunc = (param, value, lookup, rules) => {\r\n  if (typeOf(param) != 'array') throw new Error('invalid parameter')\r\n  const param1 = param as IfParam\r\n  const [target, match, then, el = {}] = param1\r\n  if (! target || ! match || ! then) throw new Error('invalid parameter')\r\n  const targetValue = lookup(target)\r\n  const targetResult = applyRules(targetValue, match, lookup, rules)\r\n  if (targetResult === true) {\r\n    return applyRules(value, then, lookup, rules)\r\n  } else {\r\n    return applyRules(value, el, lookup, rules)\r\n  }\r\n}\r\n\r\n/**\r\n * Valid if `value`, where it is a number, is multiple of `param`.\r\n * @param param \r\n * @param value \r\n * @category Predefined Rules\r\n */\r\nexport const multipleOf:RuleFunc = (param, value) => {\r\n  if (typeof param != 'number') throw new Error('invalid parameter')\r\n  if (typeof value != 'number') return true\r\n  if (value % param === 0) return true\r\n  return {code:'rule.multipleOf', hint:param}\r\n}\r\n\r\n/**\r\n * \r\n * @param param \r\n * @param value \r\n * @category Predefined Rules\r\n */\r\nexport const maximum:RuleFunc = (param, value) => {\r\n  if (typeof value != 'number') return true\r\n  if (param >= value) return true\r\n  return {code:'rule.maximum', hint:param as Scalar}\r\n}\r\n\r\n/**\r\n * \r\n * @param param \r\n * @param value \r\n * @category Predefined Rules\r\n */\r\nexport const exclusiveMaximum:RuleFunc = (param, value) => {\r\n  if (typeof value != 'number') return true\r\n  if (param > value) return true\r\n  return {code:'rule.exclusiveMaximum', hint:param as Scalar}\r\n}\r\n\r\n/**\r\n * \r\n * @param param \r\n * @param value \r\n * @category Predefined Rules\r\n */\r\nexport const minimum:RuleFunc = (param, value) => {\r\n  if (typeof value != 'number') return true\r\n  if (param <= value) return true\r\n  return {code:'rule.minimum', hint:param as Scalar}\r\n}\r\n\r\n/**\r\n * \r\n * @param param \r\n * @param value \r\n * @category Predefined Rules\r\n */\r\nexport const exclusiveMinimum:RuleFunc = (param, value) => {\r\n  if (typeof value != 'number') return true\r\n  if (param < value) return true\r\n  return {code:'rule.exclusiveMinimum', hint:param as Scalar}\r\n}\r\n\r\n/**\r\n * \r\n * @param param \r\n * @param value \r\n * @category Predefined Rules\r\n */\r\nexport const maxLength:RuleFunc = (param, value) => {\r\n  if (typeof value != 'string') return true\r\n  if (value.length <= param) return true\r\n  return {code:'rule.maxLength', hint:param as Scalar}\r\n}\r\n\r\n/**\r\n * \r\n * @param param \r\n * @param value \r\n * @category Predefined Rules\r\n */\r\nexport const minLength:RuleFunc = (param, value) => {\r\n  if (typeof value != 'string') return true\r\n  if (value.length >= param) return true\r\n  return {code:'rule.minLength', hint:param as Scalar}\r\n}\r\n\r\n/**\r\n * \r\n * @param param \r\n * @param value \r\n * @category Predefined Rules\r\n */\r\nexport const pattern:RuleFunc = (param, value) => {\r\n  if (typeof param != 'string') throw new Error('invalid parameter')\r\n  if (typeof value != 'string') return true\r\n  if (new RegExp(param).test(value)) return true\r\n  return {code:'rule.pattern', hint: /** @type {string} */ (param)}\r\n}\r\n\r\n/**\r\n * \r\n * @param param \r\n * @param value \r\n * @category Predefined Rules\r\n */\r\nexport const maxItems:RuleFunc = (param, value) => {\r\n  if (typeof param != 'number') throw new Error('invalid parameter')\r\n  if (! Array.isArray(value)) return true\r\n  if (value.length <= param) return true\r\n  return {code:'rule.maxItems', hint: /** @type {number} */ (param)}\r\n}\r\n\r\n/**\r\n * \r\n * @param param \r\n * @param value \r\n * @category Predefined Rules\r\n */\r\nexport const minItems:RuleFunc = (param, value) => {\r\n  if (typeof param != 'number') throw new Error('invalid parameter')\r\n  if (! Array.isArray(value)) return true\r\n  if (value.length >= param) return true\r\n  return {code:'rule.minItems', hint: /** @type {number} */ (param)}\r\n}\r\n","/**\r\n * Data schema and validation\r\n * \r\n * @module core/schema\r\n */\r\n\r\nimport {typeOf, isJsonValue, appendPath} from './utils'\r\nimport {MgError, Scalar} from './errors'\r\nimport * as R from './rules'\r\n\r\n/**\r\n * Json array to silence tsc.\r\n * \r\n * @category Types\r\n */\r\nexport interface JsonArray extends Array<Json> {}\r\n\r\n/**\r\n * Json Object to silence tsc.\r\n * \r\n * @category Types\r\n */\r\nexport interface JsonObject extends Record<string,Json> {}\r\n\r\n/**\r\n * Simple Json type definition\r\n * \r\n * @category Types\r\n */\r\nexport type Json = null | number | string | boolean | JsonArray | JsonObject\r\n\r\n/**\r\n * Type of lookup function used in validation rules.\r\n * \r\n * @category Types\r\n */\r\nexport type Lookup = (path:string) => Json\r\n\r\n/**\r\n * Type of validation rule functions.<br>\r\n * They returns true if validation succeeded.<br>\r\n * Otherwise return MgError.\r\n * \r\n * @category Types\r\n */\r\nexport type RuleFunc = (param:Json, value:Json, lookup:Lookup, rules:Rules) => true|MgError\r\n\r\n/**\r\n * Named set of Rule functions.\r\n * \r\n * @category Types\r\n */\r\nexport type Rules = Record<string,RuleFunc>\r\n\r\n/**\r\n * The schema is modeled after JSON Schema.\r\n * \r\n * @category Types\r\n */\r\nexport type Schema = Record<string,Json>\r\n\r\n/**\r\n * Compiled schema.<br>\r\n * You can lookup a schema by a normalized path.\r\n * \r\n * @category Types\r\n */\r\nexport type SchemaDb = Record<string,Schema>\r\n\r\n/**\r\n * Slot is where metadata of each value of the model data comes. \r\n * \r\n * @category Types\r\n */\r\nexport type Slot = {\r\n  /**\r\n   * `true` if the value is invalid.\r\n   */\r\n  invalid?: boolean, \r\n  /**\r\n   * Non-null if the value has error.\r\n   */\r\n  error?: MgError, \r\n  /**\r\n   * `true` if the user changed this value.\r\n   */\r\n  touched?: boolean, \r\n  /**\r\n   * Raw string of user input.\r\n   */\r\n  input?: string, \r\n  /**\r\n   * the value itself of this value.\r\n   */\r\n  value?: Json\r\n}\r\n\r\n/**\r\n * Type of validation function.\r\n * \r\n * @category Types\r\n */\r\nexport type Validate = (value:any, slot0:Slot, schema:Schema, lookup:Lookup) => Slot\r\n\r\n\r\n/**\r\n * Returns true if type specification allows null.\r\n * \r\n * @category Entries\r\n */\r\nexport const nullable = (type:string):boolean => {\r\n  if (! type) return true\r\n  const lastChar = type.charAt(type.length - 1)\r\n  return type == 'null' || lastChar == '?'\r\n}\r\n\r\n/**\r\n * Builds a map from path to schema.\r\n * \r\n * @category Entries\r\n */\r\nexport const buildDb = (schema:Schema):SchemaDb => {\r\n  const db = /** @type SchemaDb */ ({})\r\n  const inner = (schema, path) => {\r\n    db[path] = schema\r\n    switch (schema.type) {\r\n      case 'object': \r\n      case 'object?': \r\n        for (let p in schema.properties) {\r\n          inner(schema.properties[p], path + '/' + p)\r\n        }\r\n        break\r\n      case 'array': \r\n      case 'array?': \r\n        inner(schema.items, path + '/*')\r\n        break\r\n      default: \r\n        break\r\n    }\r\n  }\r\n  inner(schema, \"\")\r\n  return db\r\n}\r\n\r\n/**\r\n * default validation rules.\r\n * Rules prefixed by '$' is registered by its true name. Use `defaultRules.if` instead of `defaultRules.$if`.\r\n * \r\n * @category Entries\r\n */\r\nexport const defaultRules:Rules = {\r\n  type:R.type, 'enum':R.$enum, 'const':R.$const, notEmpty:R.notEmpty, required:R.required, switchRequired:R.switchRequired, same:R.same, 'if':R.$if, \r\n  // TODO: allOf, eitherOf, not\r\n  multipleOf:R.multipleOf, maximum:R.maximum, exclusiveMaximum:R.exclusiveMaximum, minimum:R.minimum, exclusiveMinimum:R.exclusiveMinimum, maxLength:R.maxLength, minLength:R.minLength, pattern:R.pattern, maxItems:R.maxItems, minItems:R.minItems\r\n}\r\n\r\n/**\r\n * Validates a value with a schema. It is a shallow validation.\r\n * \r\n * @param rules set of validation rules, which means that you can add your own rules.\r\n * \r\n * @category Entries\r\n */\r\nexport const validate = (rules:Rules):Validate => (value, slot, schema, lookup) => {\r\n  if (! isJsonValue(value)) {\r\n    if (schema && schema.type) {\r\n      const error = {code:'type.'+schema.type, detail:'given value: '+value}\r\n      return {...slot, value, invalid:true, error}\r\n    } else {\r\n      const error = {code:'value', detail:'given value: '+value}\r\n      return {...slot, value, invalid:true, error}\r\n    }\r\n  }\r\n\r\n  if (schema) {\r\n    const result = applyRules(value, schema, lookup, rules)\r\n    if (result !== true) {\r\n      return {...slot, value, invalid:true, error:result}\r\n    }\r\n  }\r\n  return {...slot, value, invalid:false, error:null}\r\n}\r\n\r\n/**\r\n * \r\n * \r\n * \r\n * @category Entries\r\n */\r\nexport const applyRules = (value:any, schema:Schema, lookup:Lookup, rules:Rules):true|MgError => {\r\n  for (let p in schema) {\r\n    const f = rules[p]\r\n    if (! f) continue\r\n    const result = f(schema[p], value, lookup, rules)\r\n    if (result !== true) return result\r\n  }\r\n  return true\r\n}\r\n\r\n/**\r\n * Executes coercion. Coercion is a process that interpretes a user input of string into a value of schema-specified type.\r\n * \r\n * @category Entries\r\n */\r\nexport const coerce = (input:string, slot:Slot, schema:Schema):Slot => {\r\n  input = \"\" + input  // coerce to string\r\n  if (! schema) {\r\n    throw new Error('coerce/0: no schema')\r\n  }\r\n  if (! schema.type || typeof schema.type != 'string') {\r\n    throw new Error('coerce/1: type not specified')\r\n  }\r\n  const type = schema.type\r\n  if (['null', 'boolean', 'boolean?', 'integer', 'integer?', 'number', 'number?', 'string'].indexOf(type) == -1) {\r\n    throw new Error('coerce/2: not a coercion enabled type: ' + type)\r\n  }\r\n\r\n  switch (type) {\r\n    case 'null': \r\n      break\r\n    case 'number': \r\n    case 'number?': \r\n      const n = +input\r\n      if (\"\" + n === input) {\r\n        return {value:n, input, touched:slot.touched}\r\n      }\r\n      break\r\n    case 'integer': \r\n    case 'integer?': \r\n      const i = +input\r\n      if (\"\" + i === input && i % 1 === 0) {\r\n        return {value:i, input, touched:slot.touched}\r\n      }\r\n      break\r\n    case 'boolean': \r\n    case 'boolean?': \r\n      if (input === \"true\" || input === \"false\") {\r\n        return {value:input===\"true\", input, touched:slot.touched}\r\n      }\r\n      break\r\n    case 'string': \r\n      return {value:input, input, touched:slot.touched}\r\n  }\r\n  if (input == \"\" && nullable(type)) {\r\n    return {value:null, input, touched:slot.touched}\r\n  }\r\n  return {input, touched:slot.touched}\r\n}\r\n\r\n\r\n","/**\r\n * An error type and error messages.\r\n * \r\n * @module core/errors\r\n */\r\n\r\nimport showText from 'string-template'\r\n\r\n/**\r\n * Type of `MgError.hint`\r\n * \r\n * @category Types\r\n */\r\nexport type Scalar = string|number|boolean|null\r\n\r\n/**\r\n * Error type\r\n * \r\n * @category Types\r\n */\r\nexport type MgError = {\r\n  /**\r\n   * An error code. This is used to distinguish an error type from others.\r\n   */\r\n  code: string, \r\n\r\n  /**\r\n   * A detail description for developers.\r\n   */\r\n  detail?: string, \r\n\r\n  /**\r\n   * A hint data to build an error message.\r\n   */\r\n  hint?: Scalar, \r\n\r\n  /**\r\n   * An error message for users.<br>\r\n   * Usually this property is undefined, so someone should call normalizeError() to generate a message.\r\n   */\r\n  message?: string\r\n}\r\n\r\n/**\r\n * A type of normalizeError function.\r\n * \r\n * @category Types\r\n */\r\nexport type NormalizeError = (error:MgError) => MgError\r\n\r\n/**\r\n * Returns true if a given object is an instance of MgError\r\n * \r\n * @param x\r\n * \r\n * @category Entries\r\n */\r\nexport const isError = (x:any):boolean => {\r\n  return (typeof x == 'object' && x != null && 'code' in x)\r\n}\r\n\r\n/**\r\n * Extends a MgError for viewing, and returns its extended instance.<br>\r\n * Actually, this function adds `message` value to the error.\r\n * \r\n * @category Entries\r\n */\r\nexport const normalizeError = (catalog:Record<string,string>):NormalizeError => (error) => {\r\n  const template = catalog[error.code] || catalog['detail' in error ? '_fallback' : '_fallback.nodetail']\r\n  const message = showText(template, error)\r\n  return {...error, message}\r\n}\r\n\r\n/**\r\n * \r\n * @category Entries\r\n */\r\nexport enum defaultCatalog {\r\n  /**\r\n   * In fact, this is not an error code. This entry will be used when generating a message for an unknown code.\r\n   */\r\n  '_fallback' = 'Error code:{code}; detail:{detail}', \r\n  /**\r\n   * In fact, this is not an error code. This entry will be used when generating a message for an unknown code.\r\n   */\r\n  '_fallback.nodetail' = 'Error code:{code}', \r\n  \r\n  'value' = 'Invalid value', \r\n  /**\r\n   * @name \"type.null\"\r\n   */\r\n  'type.null' = 'Please input a null value', \r\n  /**\r\n   * @name \"type.boolean\"\r\n   */\r\n  'type.boolean' = 'Please input a boolean value', \r\n  /**\r\n   * @name \"type.boolean?\"\r\n   */\r\n  'type.boolean?' = 'Please input a boolean value or a null', \r\n  /**\r\n   * @name \"type.integer\"\r\n   */\r\n  'type.integer' = 'Please input an integer', \r\n  /**\r\n   * @name \"type.integer?\"\r\n   */\r\n  'type.integer?' = 'Please input an integer or a null', \r\n  /**\r\n   * @name \"type.number\"\r\n   */\r\n  'type.number' = 'Please input a number', \r\n  /**\r\n   * @name \"type.number?\"\r\n   */\r\n  'type.number?' = 'Please input a number or a null', \r\n  /**\r\n   * @name \"type.string\"\r\n   */\r\n  'type.string' = 'Please input a string', \r\n  /**\r\n   * @name \"type.object\"\r\n   */\r\n  'type.object' = 'Please input an object value', \r\n  /**\r\n   * @name \"type.object?\"\r\n   */\r\n  'type.object?' = 'Please input an object value or a null', \r\n  /**\r\n   * @name \"type.array\"\r\n   */\r\n  'type.array' = 'Please input an array value', \r\n  /**\r\n   * @name \"type.array?\"\r\n   */\r\n  'type.array?' = 'Please input an array value or a null', \r\n  /**\r\n   * @name \"rule.enum\"\r\n   */\r\n  'rule.enum' = 'Invalid input', \r\n  /**\r\n   * @name \"rule.const\"\r\n   */\r\n  'rule.const' = 'Input {hint}',  // param\r\n  /**\r\n   * @name \"rule.const.nohint\"\r\n   */\r\n  'rule.const.nohint' = 'Invalid input', \r\n  /**\r\n   * @name \"rule.notEmpty\"\r\n   */\r\n  'rule.notEmpty' = 'Please input', \r\n  /**\r\n   * @name \"rule.required\"\r\n   */\r\n  'rule.required' = 'Missing property \"{hint}\"',  // param[i]\r\n  /**\r\n   * @name \"rule.switchRequired\"\r\n   */\r\n  'rule.switchRequired' = 'Missing property \"{hint}\"',  // required[i]\r\n  /**\r\n   * @name \"rule.sqitchRequired.nohint\"\r\n   */\r\n  'rule.switchRequired.nohint' = 'Properties are missing', \r\n  /**\r\n   * @name \"rule.same\"\r\n   */\r\n  'rule.same' = 'Please input {hint}',  // target\r\n  /**\r\n   * @name \"rule.same.nohint\"\r\n   */\r\n  'rule.same.nohint' = 'Invalid input', \r\n  /**\r\n   * @name \"rule.multipleOf\"\r\n   */\r\n  'rule.multipleOf' = 'Please enter a multiple of {hint}',  // param\r\n  /**\r\n   * @name \"rule.maximum\"\r\n   */\r\n  'rule.maximum' = 'Please enter {hint} or less',  // param\r\n  /**\r\n   * @name \"rule.exclusiveMaximum\"\r\n   */\r\n  'rule.exclusiveMaximum' = 'Please enter less than {hint}',  // param\r\n  /**\r\n   * @name \"rule.minimum\"\r\n   */\r\n  'rule.minimum' = 'Please enter {hint} or more',  // param\r\n  /**\r\n   * @name \"rule.exclusiveMinimum\"\r\n   */\r\n  'rule.exclusiveMinimum' = 'Please enter more than {hint}',  // param\r\n  /**\r\n   * @name \"rule.maxLength\"\r\n   */\r\n  'rule.maxLength' = 'Please enter no more than {hint} characters',  // param\r\n  /**\r\n   * @name \"rule.minLength\"\r\n   */\r\n  'rule.minLength' = 'Please enter at least {hint} characters',  // param\r\n  /**\r\n   * @name \"rule.pattern\"\r\n   */\r\n  'rule.pattern' = 'Invalid format',  // param\r\n  /**\r\n   * @name \"rule.maxItems\"\r\n   */\r\n  'rule.maxItems' = 'Please make it {hint} or less',  // param\r\n  /**\r\n   * @name \"rule.minItems\"\r\n   */\r\n  'rule.minItems' = 'Please make it {hint} or more',  // param\r\n  /**\r\n   * @name \"http.400\"\r\n   */\r\n  'http.400' = 'HTTP error: {detail}', \r\n  /**\r\n   * @name \"http.401\"\r\n   */\r\n  'http:401' = 'HTTP error: {detail}', \r\n  /**\r\n   * @name \"http.403\"\r\n   */\r\n  'http:403' = 'HTTP error: {detail}', \r\n  /**\r\n   * @name \"http.404\"\r\n   */\r\n  'http.404' = 'HTTP error: {detail}', \r\n  /**\r\n   * @name \"http.405\"\r\n   */\r\n  'http.405' = 'HTTP error: {detail}', \r\n  /**\r\n   * @name \"http.406\"\r\n   */\r\n  'http.406' = 'HTTP error: {detail}', \r\n  /**\r\n   * @name \"http.407\"\r\n   */\r\n  'http.407' = 'HTTP error: {detail}', \r\n  /**\r\n   * @name \"http.408\"\r\n   */\r\n  'http.408' = 'HTTP error: {detail}', \r\n  /**\r\n   * @name \"http.409\"\r\n   */\r\n  'http.409' = 'HTTP error: {detail}', \r\n  /**\r\n   * @name \"http.410\"\r\n   */\r\n  'http.410' = 'HTTP error: {detail}', \r\n  /**\r\n   * @name \"http.500\"\r\n   */\r\n  'http.500' = 'HTTP error: {detail}', \r\n  /**\r\n   * @name \"http.501\"\r\n   */\r\n  'http.501' = 'HTTP error: {detail}', \r\n  /**\r\n   * @name \"http.502\"\r\n   */\r\n  'http.502' = 'HTTP error: {detail}', \r\n  /**\r\n   * @name \"http.503\"\r\n   */\r\n  'http.503' = 'HTTP error: {detail}', \r\n\r\n}","export function h(name, attributes) {\n  var rest = []\n  var children = []\n  var length = arguments.length\n\n  while (length-- > 2) rest.push(arguments[length])\n\n  while (rest.length) {\n    var node = rest.pop()\n    if (node && node.pop) {\n      for (length = node.length; length--; ) {\n        rest.push(node[length])\n      }\n    } else if (node != null && node !== true && node !== false) {\n      children.push(node)\n    }\n  }\n\n  return typeof name === \"function\"\n    ? name(attributes || {}, children)\n    : {\n        nodeName: name,\n        attributes: attributes || {},\n        children: children,\n        key: attributes && attributes.key\n      }\n}\n\nexport function app(state, actions, view, container) {\n  var map = [].map\n  var rootElement = (container && container.children[0]) || null\n  var oldNode = rootElement && recycleElement(rootElement)\n  var lifecycle = []\n  var skipRender\n  var isRecycling = true\n  var globalState = clone(state)\n  var wiredActions = wireStateToActions([], globalState, clone(actions))\n\n  scheduleRender()\n\n  return wiredActions\n\n  function recycleElement(element) {\n    return {\n      nodeName: element.nodeName.toLowerCase(),\n      attributes: {},\n      children: map.call(element.childNodes, function(element) {\n        return element.nodeType === 3 // Node.TEXT_NODE\n          ? element.nodeValue\n          : recycleElement(element)\n      })\n    }\n  }\n\n  function resolveNode(node) {\n    return typeof node === \"function\"\n      ? resolveNode(node(globalState, wiredActions))\n      : node != null\n        ? node\n        : \"\"\n  }\n\n  function render() {\n    skipRender = !skipRender\n\n    var node = resolveNode(view)\n\n    if (container && !skipRender) {\n      rootElement = patch(container, rootElement, oldNode, (oldNode = node))\n    }\n\n    isRecycling = false\n\n    while (lifecycle.length) lifecycle.pop()()\n  }\n\n  function scheduleRender() {\n    if (!skipRender) {\n      skipRender = true\n      setTimeout(render)\n    }\n  }\n\n  function clone(target, source) {\n    var out = {}\n\n    for (var i in target) out[i] = target[i]\n    for (var i in source) out[i] = source[i]\n\n    return out\n  }\n\n  function setPartialState(path, value, source) {\n    var target = {}\n    if (path.length) {\n      target[path[0]] =\n        path.length > 1\n          ? setPartialState(path.slice(1), value, source[path[0]])\n          : value\n      return clone(source, target)\n    }\n    return value\n  }\n\n  function getPartialState(path, source) {\n    var i = 0\n    while (i < path.length) {\n      source = source[path[i++]]\n    }\n    return source\n  }\n\n  function wireStateToActions(path, state, actions) {\n    for (var key in actions) {\n      typeof actions[key] === \"function\"\n        ? (function(key, action) {\n            actions[key] = function(data) {\n              var result = action(data)\n\n              if (typeof result === \"function\") {\n                result = result(getPartialState(path, globalState), actions)\n              }\n\n              if (\n                result &&\n                result !== (state = getPartialState(path, globalState)) &&\n                !result.then // !isPromise\n              ) {\n                scheduleRender(\n                  (globalState = setPartialState(\n                    path,\n                    clone(state, result),\n                    globalState\n                  ))\n                )\n              }\n\n              return result\n            }\n          })(key, actions[key])\n        : wireStateToActions(\n            path.concat(key),\n            (state[key] = clone(state[key])),\n            (actions[key] = clone(actions[key]))\n          )\n    }\n\n    return actions\n  }\n\n  function getKey(node) {\n    return node ? node.key : null\n  }\n\n  function eventListener(event) {\n    return event.currentTarget.events[event.type](event)\n  }\n\n  function updateAttribute(element, name, value, oldValue, isSvg) {\n    if (name === \"key\") {\n    } else if (name === \"style\") {\n      if (typeof value === \"string\") {\n        element.style.cssText = value\n      } else {\n        if (typeof oldValue === \"string\") oldValue = element.style.cssText = \"\"\n        for (var i in clone(oldValue, value)) {\n          var style = value == null || value[i] == null ? \"\" : value[i]\n          if (i[0] === \"-\") {\n            element.style.setProperty(i, style)\n          } else {\n            element.style[i] = style\n          }\n        }\n      }\n    } else {\n      if (name[0] === \"o\" && name[1] === \"n\") {\n        name = name.slice(2)\n\n        if (element.events) {\n          if (!oldValue) oldValue = element.events[name]\n        } else {\n          element.events = {}\n        }\n\n        element.events[name] = value\n\n        if (value) {\n          if (!oldValue) {\n            element.addEventListener(name, eventListener)\n          }\n        } else {\n          element.removeEventListener(name, eventListener)\n        }\n      } else if (\n        name in element &&\n        name !== \"list\" &&\n        name !== \"type\" &&\n        name !== \"draggable\" &&\n        name !== \"spellcheck\" &&\n        name !== \"translate\" &&\n        !isSvg\n      ) {\n        element[name] = value == null ? \"\" : value\n      } else if (value != null && value !== false) {\n        element.setAttribute(name, value)\n      }\n\n      if (value == null || value === false) {\n        element.removeAttribute(name)\n      }\n    }\n  }\n\n  function createElement(node, isSvg) {\n    var element =\n      typeof node === \"string\" || typeof node === \"number\"\n        ? document.createTextNode(node)\n        : (isSvg = isSvg || node.nodeName === \"svg\")\n          ? document.createElementNS(\n              \"http://www.w3.org/2000/svg\",\n              node.nodeName\n            )\n          : document.createElement(node.nodeName)\n\n    var attributes = node.attributes\n    if (attributes) {\n      if (attributes.oncreate) {\n        lifecycle.push(function() {\n          attributes.oncreate(element)\n        })\n      }\n\n      for (var i = 0; i < node.children.length; i++) {\n        element.appendChild(\n          createElement(\n            (node.children[i] = resolveNode(node.children[i])),\n            isSvg\n          )\n        )\n      }\n\n      for (var name in attributes) {\n        updateAttribute(element, name, attributes[name], null, isSvg)\n      }\n    }\n\n    return element\n  }\n\n  function updateElement(element, oldAttributes, attributes, isSvg) {\n    for (var name in clone(oldAttributes, attributes)) {\n      if (\n        attributes[name] !==\n        (name === \"value\" || name === \"checked\"\n          ? element[name]\n          : oldAttributes[name])\n      ) {\n        updateAttribute(\n          element,\n          name,\n          attributes[name],\n          oldAttributes[name],\n          isSvg\n        )\n      }\n    }\n\n    var cb = isRecycling ? attributes.oncreate : attributes.onupdate\n    if (cb) {\n      lifecycle.push(function() {\n        cb(element, oldAttributes)\n      })\n    }\n  }\n\n  function removeChildren(element, node) {\n    var attributes = node.attributes\n    if (attributes) {\n      for (var i = 0; i < node.children.length; i++) {\n        removeChildren(element.childNodes[i], node.children[i])\n      }\n\n      if (attributes.ondestroy) {\n        attributes.ondestroy(element)\n      }\n    }\n    return element\n  }\n\n  function removeElement(parent, element, node) {\n    function done() {\n      parent.removeChild(removeChildren(element, node))\n    }\n\n    var cb = node.attributes && node.attributes.onremove\n    if (cb) {\n      cb(element, done)\n    } else {\n      done()\n    }\n  }\n\n  function patch(parent, element, oldNode, node, isSvg) {\n    if (node === oldNode) {\n    } else if (oldNode == null || oldNode.nodeName !== node.nodeName) {\n      var newElement = createElement(node, isSvg)\n      parent.insertBefore(newElement, element)\n\n      if (oldNode != null) {\n        removeElement(parent, element, oldNode)\n      }\n\n      element = newElement\n    } else if (oldNode.nodeName == null) {\n      element.nodeValue = node\n    } else {\n      updateElement(\n        element,\n        oldNode.attributes,\n        node.attributes,\n        (isSvg = isSvg || node.nodeName === \"svg\")\n      )\n\n      var oldKeyed = {}\n      var newKeyed = {}\n      var oldElements = []\n      var oldChildren = oldNode.children\n      var children = node.children\n\n      for (var i = 0; i < oldChildren.length; i++) {\n        oldElements[i] = element.childNodes[i]\n\n        var oldKey = getKey(oldChildren[i])\n        if (oldKey != null) {\n          oldKeyed[oldKey] = [oldElements[i], oldChildren[i]]\n        }\n      }\n\n      var i = 0\n      var k = 0\n\n      while (k < children.length) {\n        var oldKey = getKey(oldChildren[i])\n        var newKey = getKey((children[k] = resolveNode(children[k])))\n\n        if (newKeyed[oldKey]) {\n          i++\n          continue\n        }\n\n        if (newKey != null && newKey === getKey(oldChildren[i + 1])) {\n          if (oldKey == null) {\n            removeElement(element, oldElements[i], oldChildren[i])\n          }\n          i++\n          continue\n        }\n\n        if (newKey == null || isRecycling) {\n          if (oldKey == null) {\n            patch(element, oldElements[i], oldChildren[i], children[k], isSvg)\n            k++\n          }\n          i++\n        } else {\n          var keyedNode = oldKeyed[newKey] || []\n\n          if (oldKey === newKey) {\n            patch(element, keyedNode[0], keyedNode[1], children[k], isSvg)\n            i++\n          } else if (keyedNode[0]) {\n            patch(\n              element,\n              element.insertBefore(keyedNode[0], oldElements[i]),\n              keyedNode[1],\n              children[k],\n              isSvg\n            )\n          } else {\n            patch(element, oldElements[i], null, children[k], isSvg)\n          }\n\n          newKeyed[newKey] = children[k]\n          k++\n        }\n      }\n\n      while (i < oldChildren.length) {\n        if (getKey(oldChildren[i]) == null) {\n          removeElement(element, oldElements[i], oldChildren[i])\n        }\n        i++\n      }\n\n      for (var i in oldKeyed) {\n        if (!newKeyed[i]) {\n          removeElement(element, oldKeyed[i][0], oldKeyed[i][1])\n        }\n      }\n    }\n    return element\n  }\n}\n","//@ts-check\r\n\r\nimport { normalizePath } from './utils'\r\nimport * as E from './env'\r\nimport * as S from './schema'\r\nimport * as X from './errors'\r\nimport { app, h as h0, VNode, ActionType, View as HaView } from 'hyperapp'\r\nimport {MgError, NormalizeError} from './errors'\r\nimport {Json, Schema, Slot, SchemaDb, Lookup, Rules} from './schema'\r\nimport {Env} from './env'\r\n\r\n/**\r\n * @category Types\r\n */\r\nexport type Validity = {invalid:boolean, error:MgError|null}\r\n\r\n/**\r\n * Developer-supplied evolve function.<br>\r\n * In this function, derived data are calculated.\r\n * \r\n * @param env an env before evolve\r\n * @param updatePointer a common path of currently updated data\r\n * @param prevEnv an env before current update\r\n * @returns evolved env\r\n * @category Types\r\n */\r\nexport type Evolve = (env:Env, updatePointer:string|null, prevEnv:Env|null) => Env\r\n\r\n/**\r\n * Developer-supplied view function.<br>\r\n * View function maps env to vdom.\r\n * \r\n * @param env current env\r\n * @returns VDOM\r\n * @category Types\r\n */\r\nexport type View = (env:Env) => VNode<{}>\r\n\r\n/**\r\n * Type of update function.\r\n * @param args one or more arguments; The last parameter will be Env.\r\n * @category Types\r\n */\r\nexport type Update = (...args:any[]) => Env|Promise<any>\r\n\r\ntype ThenHandler = (result:any) => any\r\ntype XThenHandler = (result:any, env:Env) => any\r\ntype DialogState = {\r\n  data: any, \r\n  fulfill: (result:any) => undefined, \r\n  reject: (result:any) => undefined\r\n}\r\ntype OnPromiseThenParam = {\r\n  result: any,\r\n  ret: (any:any) => void,\r\n  handler: XThenHandler\r\n}\r\n/*type OnUpdateByEvent<S, A> = ActionType<Event, S, A>\r\ntype OnUpdateByCall<S, A> = ActionType<{update:string, context:any[]}, S, A>\r\ntype OnUpdate<S, A> = OnUpdateByEvent<S, A>|OnUpdateByCall<S, A>*/\r\n\r\n/**\r\n * @hidden\r\n */\r\nexport type UnmagicalState = {\r\n  baseEnv: Env, \r\n  env: Env, \r\n  normalizeError: NormalizeError\r\n}\r\n\r\n/**\r\n * @hidden\r\n */\r\nexport type UnmagicalActions = {\r\n  onTextboxInput: UnmagicalAction<Event>, \r\n  onTextboxBlur: UnmagicalAction<Event>, \r\n  onSliderInput: UnmagicalAction<Event>, \r\n  onSliderChange: UnmagicalAction<Event>, \r\n  onListboxChange: UnmagicalAction<Event>, \r\n  onRadioChange: UnmagicalAction<Event>, \r\n  onCheckboxChange: UnmagicalAction<Event>, \r\n  onSmartControlChange: UnmagicalAction<{path:string,input:string}|[{path:string,input:string}]>, \r\n  onUpdate: UnmagicalAction<Event|{update:string,context:any[]}>, \r\n  onPromiseSettle: UnmagicalAction<Event|{name:string,result:any}>, \r\n  onPromiseThen: UnmagicalAction<OnPromiseThenParam>\r\n}\r\n\r\n/**\r\n * @hidden\r\n */\r\nexport type UnmagicalAction<T> = ActionType<T, UnmagicalState, UnmagicalActions>\r\n\r\n/**\r\n * @category start\r\n */\r\nexport type StartParameter = {\r\n  data: Json, \r\n  schema: Schema, \r\n  view: View, \r\n  containerEl: Element, \r\n  evolve?: Evolve, \r\n  updates?: Record<string,Update>\r\n  rules?: Rules, \r\n  catalog?: Record<string,string>\r\n}\r\n\r\n/**\r\n * @category start\r\n */\r\nexport type StartValue = {\r\n  onUpdate: UnmagicalAction<Event|{update:string,context:any[]}>\r\n}\r\n\r\n/**\r\n * @namespace\r\n */\r\nexport namespace API {\r\n  // re-export from env\r\n  export const test = E.test\r\n  export const extract = E.extract\r\n  export const getSlot = E.getSlot\r\n  export const add = E.add\r\n  export const remove = E.remove\r\n  export const replace = E.replace\r\n  export const move = E.move\r\n  export const copy = E.copy\r\n  export const duplicate = E.duplicate\r\n  export const validate = E.validate\r\n  export const mapDeep = E.mapDeep\r\n  export const reduceDeep = E.reduceDeep\r\n  export const getExtra = E.getExtra\r\n\r\n  /**\r\n   * \r\n   * @param {string} path \r\n   * @param {Env} env\r\n   * @returns {Env} \r\n   */\r\n  export const touchAll = (path:string, env:Env):Env => {\r\n    return E.mapDeep((slot, _path) => ({...slot, touched:true}), path, env)\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param {string} path \r\n   * @param {Env} env\r\n   * @returns {number} \r\n   */\r\n  export const countValidationErrors = (path:string, env:Env):number => {\r\n    return E.reduceDeep((cur, slot, _path) => {\r\n      const d = slot.touched && slot.invalid ? 1 : 0\r\n      return cur + d\r\n    }, 0, path, env)\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param {string} path \r\n   * @param {Env} env\r\n   * @returns {string[]} \r\n   */\r\n  export const validationErrors = (path:string, env:Env):string[] => {\r\n    const errors:string[] = []\r\n    E.reduceDeep((_cur, slot, path) => {\r\n      if (slot.touched && slot.invalid) {\r\n        errors.push(path)\r\n      }\r\n      return null\r\n    }, null, path, env)\r\n    return errors\r\n  }\r\n\r\n  /**\r\n   * @param {string} path\r\n   * @param {Env} env\r\n   * @returns {{invalid:boolean, error:MgError|null}}\r\n   */\r\n  export const foldValidity = (path:string, env:Env):Validity => {\r\n    return API.reduceDeep<Validity>((cur, slot, _path) => {\r\n      if (cur.invalid) return cur\r\n      if (slot.touched && slot.invalid) return {invalid:true, error:slot.error}\r\n      return cur\r\n    }, {invalid:false, error:null}, path, env)\r\n  }\r\n\r\n  /**\r\n   * @param {number} ms\r\n   * @param {Env} env\r\n   * @returns {[Promise, Env]}\r\n   */\r\n  export const sleep = (ms:number, env:Env):[Promise<null>, Env] => {\r\n    const p = new Promise<null>((fulfill, reject) => {\r\n      setTimeout(() => {\r\n        fulfill(null)\r\n      }, ms)\r\n    })\r\n    return [p, env]\r\n  }\r\n\r\n  /**\r\n   * @param {string} name\r\n   * @param {string} itemPath\r\n   * @param {string} group\r\n   * @param {Env} env\r\n   * @returns {[Promise, Env]}\r\n   */\r\n  export const startReordering = <T>(name:string, itemPath:string, group:string, env:Env):[Promise<T>, Env] => {\r\n    const p = new Promise<T>((fulfill, reject) => {\r\n      env = E.setExtra(name, {itemPath, group, fulfill, reject}, env)\r\n    })\r\n    return [p, env]\r\n  }\r\n\r\n  /**\r\n   * @param {string} name\r\n   * @param {Env} env\r\n   * @returns {Env}\r\n   */\r\n  export const endReordering = (name:string, env:Env):Env => {\r\n    const extra = E.getExtra(name, env)\r\n    if (! extra) return env\r\n    return E.setExtra(name, null, env)\r\n  }\r\n\r\n  /**\r\n   * @param {string} name\r\n   * @param {Env} env\r\n   * @returns {string|null}\r\n   */\r\n  export const getReordering = (name:string, env:Env):string|null => {\r\n    const extra = E.getExtra(name, env) as {itemPath:string}|null\r\n    if (! extra) return null\r\n    return extra.itemPath\r\n  }\r\n\r\n  /**\r\n   * @param {string} name\r\n   * @param {any} data\r\n   * @param {Env} env\r\n   * @returns {[Promise, Env]}\r\n   */\r\n  export const openDialog = (name:string, data:any, env:Env):[Promise<boolean>,Env] => {\r\n    const p = new Promise<boolean>((fulfill, reject) => {\r\n      env = E.setExtra(name, {data, fulfill, reject}, env)\r\n    })\r\n    return [p, env]\r\n  }\r\n\r\n  /**\r\n   * @param {string} name\r\n   * @param {Env} env\r\n   * @returns {Env}\r\n   */\r\n  export const closeDialog = (name:string, env:Env):Env => {\r\n    const extra = E.getExtra(name, env)\r\n    if (! extra) return env\r\n    return E.setExtra(name, null, env)\r\n  }\r\n\r\n  /**\r\n   * @param {string} name\r\n   * @param {Env} env\r\n   * @returns {any|null}\r\n   */\r\n  export const getDialog = (name:string, env:Env):any|null => {\r\n    const extra = E.getExtra(name, env) as DialogState|null\r\n    if (! extra) return null\r\n    return extra.data\r\n  }\r\n\r\n  /**\r\n   * @param {string} name\r\n   * @param {any} data\r\n   * @param {Env} env\r\n   * @returns {Env}\r\n   */\r\n  export const openFeedback = (name:string, data:any, env:Env):Env => {\r\n    return E.setExtra(name, data, env)\r\n  }\r\n\r\n  /**\r\n   * @param {string} name\r\n   * @param {Env} env\r\n   * @returns {Env}\r\n   */\r\n  export const closeFeedback = (name:string, env:Env):Env => {\r\n    const extra = E.getExtra(name, env)\r\n    if (! extra) return env\r\n    return E.setExtra(name, null, env)\r\n  }\r\n\r\n  /**\r\n   * @param {string} name\r\n   * @param {Env} env\r\n   * @returns {any|null}\r\n   */\r\n  export const getFeedback = (name:string, env:Env):any|null => {\r\n    return E.getExtra(name, env)\r\n  }\r\n\r\n  /**\r\n   * @param {string} name\r\n   * @param {number} current\r\n   * @param {Env} env\r\n   * @returns {Env}\r\n   */\r\n  export const setPage = (name:string, current:number, env:Env):Env => {\r\n    return E.setExtra(name, current, env)\r\n  }\r\n\r\n  /**\r\n   * @param {string} name\r\n   * @param {Env} env\r\n   * @returns {number}\r\n   */\r\n  export const getPage = (name:string, env:Env):number => {\r\n    const extra = E.getExtra(name, env) as number|null\r\n    return (extra !== null) ? extra : 0\r\n  }\r\n\r\n  /**\r\n   * @param {string} name\r\n   * @param {Env} env\r\n   * @returns {Env}\r\n   */\r\n  export const nextPage = (name:string, env:Env):Env => {\r\n    const extra = E.getExtra(name, env) as number|null\r\n    const current = (extra !== null) ? extra : 0\r\n    return E.setExtra(name, current + 1, env)\r\n  }\r\n\r\n  /**\r\n   * @param {string} name\r\n   * @param {Env} env\r\n   * @returns {Env}\r\n   */\r\n  export const prevPage = (name:string, env:Env):Env => {\r\n    const extra = E.getExtra(name, env) as number|null\r\n    const current = (extra !== null) ? extra : 0\r\n    return E.setExtra(name, current - 1, env)\r\n  }\r\n\r\n  /**\r\n   * @param {string} name\r\n   * @param {boolean} shown\r\n   * @param {Env} env\r\n   * @returns {Env}\r\n   */\r\n  export const setSwitch = (name:string, shown:boolean, env:Env):Env => {\r\n    return E.setExtra(name, shown, env)\r\n  }\r\n\r\n  /**\r\n   * @param {string} name\r\n   * @param {Env} env\r\n   * @returns {boolean}\r\n   */\r\n  export const getSwitch = (name:string, env:Env):boolean => {\r\n    const extra = E.getExtra(name, env) as boolean|null\r\n    return (extra !== null) ? extra : false\r\n  }\r\n\r\n  /**\r\n   * @param {string} name\r\n   * @param {Env} env\r\n   * @returns {Env}\r\n   */\r\n  export const toggleSwitch = (name:string, env:Env):Env => {\r\n    const extra = E.getExtra(name, env) as boolean|null\r\n    const current = (extra !== null) ? extra : false\r\n    return E.setExtra(name, !current, env)\r\n  }\r\n\r\n  /*\r\n   * TODO: progress bar, ReadStream, ...\r\n   */\r\n  /**\r\n   * @param {string} name\r\n   * @param {any} unknown\r\n   * @param {Env} env\r\n   * @returns {Env}\r\n   */\r\n  export const openProgress = (name:string, unknown:any, env:Env):Env => {\r\n    return E.setExtra(name, {current:-1}, env)\r\n  }\r\n\r\n  /**\r\n   * @param {string} name\r\n   * @param {Env} env\r\n   * @returns {Env}\r\n   */\r\n  export const closeProgress = (name:string, env:Env):Env => {\r\n    return E.setExtra(name, null, env)\r\n  }\r\n\r\n  /**\r\n   * @param {string} name\r\n   * @param {Env} env\r\n   * @returns {number|null}\r\n   */\r\n  export const getProgress = (name:string, env:Env):number|null => {\r\n    const extra = E.getExtra(name, env) as {current:number}|null\r\n    if (! extra) return null\r\n    return extra.current\r\n  }\r\n  \r\n  /**\r\n   * @param {string} name \r\n   * @param {string} fromPath \r\n   * @param {string} group\r\n   * @param {Env} env\r\n   * @returns {Env|Promise}\r\n   */\r\n  export const reorder = (name:string, fromPath:string, group:string, env:Env):Env|Promise<{path:string}> => {\r\n    const {enter, leave} = API.makePortal(env)\r\n    return leave(API.startReordering<{path:string}>(name, fromPath, group, env))\r\n    .then(enter(({path}, env) => {\r\n      env = API.endReordering(name, env)\r\n      return API.move(fromPath, path, env)\r\n    }))\r\n  }\r\n\r\n  /**\r\n   * @param {Env} env\r\n   */\r\n  export const makePortal = (env:Env) => {\r\n    return {\r\n      /**\r\n       * @param {(result:any, env:Env) => any} handler\r\n       * @returns {(result:any) => any}\r\n       */\r\n      enter: (handler:XThenHandler):ThenHandler => {  // Our customized handler :: [result, env] => ...\r\n        return (result) => {  // This is the actual, standard promise handler\r\n          let result1 = null  // We will get the result in this variable.\r\n          const ret = (res1) => {result1 = res1}\r\n          (env.onPromiseThen as UnmagicalAction<OnPromiseThenParam>)({result, handler, ret})  // enter into hyperapp. Its result is undefined.\r\n          return result1\r\n        }\r\n      }, \r\n      /**\r\n       * @param {[(Promise|Error), Env] | (Promise|Error)} x\r\n       * @param {Env} [y]\r\n       * @returns {Promise|Error}\r\n       */\r\n      leave: <T>(x:[T, Env]|T, y?:Env):T => {\r\n        const p = Array.isArray(x) ? x[0] : x\r\n        const env = Array.isArray(x) ? x[1] : y\r\n        if (! E.isEnv(env)) throw new Error('exit/1: env required')\r\n        E.doReturn(env)\r\n        return p\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nconst updateEnabledApis = {\r\n  openDialog: API.openDialog, \r\n  closeDialog: API.closeDialog, \r\n  openFeedback: API.openFeedback, \r\n  closeFeedback: API.closeFeedback, \r\n  openProgress: API.openProgress, \r\n  closeProgress: API.closeProgress, \r\n  setPage: API.setPage, \r\n  nextPage: API.nextPage, \r\n  prevPage: API.prevPage, \r\n  setSwitch: API.setSwitch, \r\n  toggleSwitch: API.toggleSwitch, \r\n  reorder: API.reorder\r\n}\r\n\r\n/**\r\n * Starts frontend application.\r\n * @category start\r\n */\r\nexport const start = (\r\n    {\r\n      data, \r\n      schema, \r\n      view, \r\n      containerEl, \r\n      evolve = null, \r\n      updates = {}, \r\n      rules = null, \r\n      catalog = null\r\n    }:StartParameter):StartValue => {\r\n  // complements reasonable defaults\r\n  if (! evolve) evolve = (env, _pointer, _prevEnv) => env\r\n  const validate = S.validate(rules || S.defaultRules)\r\n  const coerce = S.coerce\r\n  const normalizeError = X.normalizeError(catalog || X.defaultCatalog)\r\n\r\n  const schemaDb = S.buildDb(schema)\r\n\r\n  const actions0 = {\r\n    onTextboxInput: (ev:Event) => (state:UnmagicalState, actions:UnmagicalActions) => {\r\n      const path = (ev.currentTarget as HTMLElement).dataset.mgPath\r\n      const value = ev.currentTarget[(ev.currentTarget as HTMLElement).dataset.mgValueAttribute]\r\n      const slot0 = E.getSlot(path, state.baseEnv)\r\n      const slot = {...slot0, input:value}\r\n      const baseEnv = E.setSlot(path, slot, state.baseEnv)\r\n      // We don't call evolve() here, because oninput is not a check point of evolve().\r\n      // Thus we update not only baseEnv but also env.\r\n      const slotb0 = E.getSlot(path, state.env)\r\n      const slotb = {...slotb0, input:value}\r\n      const env = E.setSlot(path, slotb, state.env)\r\n      return {...state, baseEnv, env}\r\n    }, \r\n    onTextboxBlur: (ev:Event) => (state:UnmagicalState, actions:UnmagicalActions) => {\r\n      const path = (ev.currentTarget as HTMLElement).dataset.mgPath\r\n      const value = ev.currentTarget[(ev.currentTarget as HTMLElement).dataset.mgValueAttribute]\r\n      const npath = normalizePath(path)\r\n      const slot0 = {...E.getSlot(path, state.baseEnv), touched:true}\r\n      const slot = coerce(value, slot0, schemaDb[npath])\r\n      let updatePointer\r\n      let baseEnv = E.beginUpdateTracking(state.baseEnv)\r\n      baseEnv = E.setSlot(path, slot, baseEnv)\r\n      baseEnv = E.validate(\"\", baseEnv);\r\n      [updatePointer, baseEnv] = E.endUpdateTracking(baseEnv)\r\n      let env = evolve(baseEnv, updatePointer, baseEnv)\r\n      env = E.validate(\"\", env)\r\n      return {...state, baseEnv, env}\r\n    }, \r\n    onSliderInput: (ev:Event) => (state:UnmagicalState, actions:UnmagicalActions) => {\r\n      const path = (ev.currentTarget as HTMLElement).dataset.mgPath\r\n      const value = ev.currentTarget[(ev.currentTarget as HTMLElement).dataset.mgValueAttribute]\r\n      const slot0 = E.getSlot(path, state.baseEnv)\r\n      const slot = {...slot0, input:value}\r\n      const baseEnv = E.setSlot(path, slot, state.baseEnv)\r\n      // We don't call evolve() here, because oninput is not a check point of evolve().\r\n      // Thus we update not only baseEnv but also env.\r\n      const slotb0 = E.getSlot(path, state.env)\r\n      const slotb = {...slotb0, input:value}\r\n      const env = E.setSlot(path, slotb, state.env)\r\n      return {...state, baseEnv, env}\r\n    }, \r\n    onSliderChange: (ev:Event) => (state:UnmagicalState, actions:UnmagicalActions) => {\r\n      const path = (ev.currentTarget as HTMLElement).dataset.mgPath\r\n      const value = ev.currentTarget[(ev.currentTarget as HTMLElement).dataset.mgValueAttribute]\r\n      const npath = normalizePath(path)\r\n      const slot0 = {...E.getSlot(path, state.baseEnv), touched:true}\r\n      const slot = coerce(value, slot0, schemaDb[npath])\r\n      let updatePointer\r\n      let baseEnv = E.beginUpdateTracking(state.baseEnv)\r\n      baseEnv = E.setSlot(path, slot, baseEnv)\r\n      baseEnv = E.validate(\"\", baseEnv);\r\n      [updatePointer, baseEnv] = E.endUpdateTracking(baseEnv)\r\n      let env = evolve(baseEnv, updatePointer, state.env)\r\n      env = E.validate(\"\", env)\r\n      return {...state, baseEnv, env}\r\n    }, \r\n    onListboxChange: (ev:Event) => (state:UnmagicalState, actions:UnmagicalActions) => {\r\n      const path = (ev.currentTarget as HTMLElement).dataset.mgPath\r\n      const value = ev.currentTarget[(ev.currentTarget as HTMLElement).dataset.mgValueAttribute]\r\n      const npath = normalizePath(path)\r\n      const slot0 = {...E.getSlot(path, state.baseEnv), touched:true}\r\n      const slot = coerce(value, slot0, schemaDb[npath])\r\n      let updatePointer\r\n      let baseEnv = E.beginUpdateTracking(state.baseEnv)\r\n      baseEnv = E.setSlot(path, slot, baseEnv)\r\n      baseEnv = E.validate(\"\", baseEnv);\r\n      [updatePointer, baseEnv] = E.endUpdateTracking(baseEnv)\r\n      let env = evolve(baseEnv, updatePointer, state.env)\r\n      env = E.validate(\"\", env)\r\n      return {...state, baseEnv, env}\r\n    }, \r\n    onRadioChange: (ev:Event) => (state:UnmagicalState, actions:UnmagicalActions) => {\r\n      const path = (ev.currentTarget as HTMLElement).dataset.mgPath\r\n      const value = ev.currentTarget[(ev.currentTarget as HTMLElement).dataset.mgValueAttribute]\r\n      const npath = normalizePath(path)\r\n      const slot0 = {...E.getSlot(path, state.baseEnv), touched:true}\r\n      const slot = coerce(value, slot0, schemaDb[npath])\r\n      let updatePointer\r\n      let baseEnv = E.beginUpdateTracking(state.baseEnv)\r\n      baseEnv = E.setSlot(path, slot, baseEnv)\r\n      baseEnv = E.validate(\"\", baseEnv);\r\n      [updatePointer, baseEnv] = E.endUpdateTracking(baseEnv)\r\n      let env = evolve(baseEnv, updatePointer, state.env)\r\n      env = E.validate(\"\", env)\r\n      return {...state, baseEnv, env}\r\n    }, \r\n    onCheckboxChange: (ev:Event) => (state:UnmagicalState, actions:UnmagicalActions) => {\r\n      const path = (ev.currentTarget as HTMLElement).dataset.mgPath\r\n      const checked = ev.currentTarget[(ev.currentTarget as HTMLElement).dataset.mgCheckedAttribute]\r\n      const value = checked ? \"true\" : \"false\"\r\n      const npath = normalizePath(path)\r\n      const slot0 = {...E.getSlot(path, state.baseEnv), touched:true}\r\n      const slot = coerce(value, slot0, schemaDb[npath])\r\n      let updatePointer\r\n      let baseEnv = E.beginUpdateTracking(state.baseEnv)\r\n      baseEnv = E.setSlot(path, slot, baseEnv)\r\n      baseEnv = E.validate(\"\", baseEnv);\r\n      [updatePointer, baseEnv] = E.endUpdateTracking(baseEnv)\r\n      let env = evolve(baseEnv, updatePointer, state.env)\r\n      env = E.validate(\"\", env)\r\n      return {...state, baseEnv, env}\r\n    }, \r\n    onSmartControlChange: (pair:{path:string,input:string}|[{path:string,input:string}]) => (state:UnmagicalState, actions:UnmagicalActions) => {\r\n      const pairs = Array.isArray(pair) ? pair : [pair]\r\n      let updatePointer\r\n      let baseEnv = E.beginUpdateTracking(state.baseEnv)\r\n      for (let i = 0; i < pairs.length; i++) {\r\n        const {path, input} = pairs[i]\r\n        const slot0 = {...E.getSlot(path, baseEnv), touched:true}\r\n        const slot = coerce(input, slot0, schemaDb[normalizePath(path)])\r\n        baseEnv = E.setSlot(path, slot, baseEnv)\r\n      }\r\n      baseEnv = E.validate(\"\", baseEnv);\r\n      [updatePointer, baseEnv] = E.endUpdateTracking(baseEnv)\r\n      let env = evolve(baseEnv, updatePointer, state.env)\r\n      env = E.validate(\"\", env)\r\n      return {...state, baseEnv, env}\r\n    }, \r\n    onUpdate: (ev:Event|{update:string,context:any[]}) => (state:UnmagicalState, actions:UnmagicalActions) => {\r\n      const update = ('currentTarget' in ev) ? (ev.currentTarget as HTMLElement).dataset.mgUpdate : ev.update\r\n      const context = ('currentTarget' in ev) ? JSON.parse((ev.currentTarget as HTMLElement).dataset.mgContext || \"null\") : ev.context\r\n      let updatePointer:string\r\n      let baseEnv = E.beginUpdateTracking(state.baseEnv)\r\n      baseEnv = E.setPortal((env0) => {baseEnv = env0}, actions.onPromiseThen, baseEnv)\r\n      const func = updates[update] || updateEnabledApis[update]\r\n      if (! func) throw new Error('onUpdate/0: no update or unknown update')\r\n      if (! Array.isArray(context)) throw new Error('onUpdate/1: parameter must be an array')\r\n      if (context.length + 1 != func.length) throw new Error('onUpdate/2: bad number of parameters')\r\n      const res = func.apply(null, [...context, baseEnv])\r\n      baseEnv = E.setPortal(null, null, E.isEnv(res) ? res : baseEnv)\r\n      baseEnv = E.validate(\"\", baseEnv);\r\n      [updatePointer, baseEnv] = E.endUpdateTracking(baseEnv)\r\n      let env = state.env\r\n      if (! E.isSame(state.baseEnv, baseEnv)) {\r\n        env = evolve(baseEnv, updatePointer, env)\r\n        env = E.validate(\"\", env)\r\n      }\r\n      return {...state, baseEnv, env}\r\n    }, \r\n    onPromiseSettle: (ev:Event|{name:string,result:any}) => (state:UnmagicalState, actions:UnmagicalActions) => {\r\n      const name = ('currentTarget' in ev) ? (ev.currentTarget as HTMLElement).dataset.mgName : ev.name\r\n      const result = ('currentTarget' in ev) ? JSON.parse((ev.currentTarget as HTMLElement).dataset.mgResult || \"null\") : ev.result\r\n      const extra = E.getExtra(name, state.baseEnv) as DialogState\r\n      if (! extra || ! extra.fulfill) throw new Error('onPromiseSettle/0: no callback or unknown callback')\r\n      // Calling fulfill() will cause the process to re-enter the hyperapp, \r\n      // so we call fulfill() not now but in a different opportunity.\r\n      setTimeout(() => {\r\n        extra.fulfill(result)\r\n      }, 0)\r\n      return null  // indicating no update.\r\n    }, \r\n    onPromiseThen: (context:OnPromiseThenParam) => (state:UnmagicalState, actions:UnmagicalActions) => {\r\n      let updatePointer:string\r\n      let baseEnv = E.beginUpdateTracking(state.baseEnv)\r\n      baseEnv = E.setPortal((env0) => {baseEnv = env0}, actions.onPromiseThen, baseEnv)\r\n      const res = context.handler(context.result, baseEnv)\r\n      baseEnv = E.setPortal(null, null, E.isEnv(res) ? res : baseEnv)\r\n      baseEnv = E.validate(\"\", baseEnv);\r\n      [updatePointer, baseEnv] = E.endUpdateTracking(baseEnv)\r\n      let env = state.env\r\n      if (! E.isSame(state.baseEnv, baseEnv)) {\r\n        env = evolve(baseEnv, updatePointer, env)\r\n        env = E.validate(\"\", env)\r\n      }\r\n      if (! E.isEnv(res)) {\r\n        context.ret(res)\r\n      }\r\n      return {...state, baseEnv, env}\r\n    }\r\n  }\r\n\r\n  let updatePointer:string\r\n  let baseEnv = E.makeEnv(data, schemaDb, validate, true)\r\n  baseEnv = E.validate(\"\", baseEnv);\r\n  [updatePointer, baseEnv] = E.endUpdateTracking(baseEnv)\r\n  let env = evolve(baseEnv, updatePointer, null)\r\n  env = E.validate(\"\", env)\r\n  const state:UnmagicalState = {\r\n    baseEnv, \r\n    env, \r\n    normalizeError\r\n  }\r\n  const view1:HaView<UnmagicalState, UnmagicalActions> = (state, actions) => view(state.env)\r\n  const actions = app(state, actions0, view1, containerEl)\r\n  return {\r\n    onUpdate: actions.onUpdate, \r\n  }\r\n}\r\n\r\n/**\r\n * @category once\r\n */\r\nexport type OnceParameter = {\r\n  data: Json, \r\n  schema: Schema, \r\n  evolve?: Evolve, \r\n  rules?: Rules\r\n}\r\n\r\n/**\r\n * Runs headless Unmagical once. Thus you can obtain the evolved env from data.\r\n * @category once\r\n */\r\nexport const once = (\r\n    {\r\n      data, \r\n      schema, \r\n      evolve = null, \r\n      rules = null\r\n    }:OnceParameter):Env => {\r\n  // complements reasonable defaults\r\n  if (! evolve) evolve = (env, _pointer, _prevEnv) => env\r\n  const validate = S.validate(rules || S.defaultRules)\r\n\r\n  const schemaDb = S.buildDb(schema)\r\n  \r\n  let updatePointer\r\n  let baseEnv = E.makeEnv(data, schemaDb, validate, true)\r\n  baseEnv = E.validate(\"\", baseEnv);\r\n  [updatePointer, baseEnv] = E.endUpdateTracking(baseEnv)\r\n  let env = evolve(baseEnv, updatePointer, null)\r\n  env = E.validate(\"\", env)\r\n  return env\r\n}\r\n\r\n/**\r\n * \r\n * @category Entries\r\n */\r\nexport const h = h0\r\n","\r\nimport { API, h, UnmagicalState, UnmagicalActions, UnmagicalAction } from './framework'\r\nexport { API, h, UnmagicalState, UnmagicalActions, UnmagicalAction } from './framework'\r\nimport * as X from './errors'\r\nimport {VNode, Component, Children} from 'hyperapp'\r\nimport { Json } from './schema'\r\n\r\ntype DoneFunc = () => void\r\ntype OnCreateFunc = (el:Element) => void\r\ntype OnRemoveFunc = (el:Element, done:DoneFunc) => void\r\ntype OnDestroyFunc = (el:Element) => void\r\n\r\n/**\r\n * @category Types\r\n */\r\nexport type UnmagicalComponent<Attributes> = Component<Attributes,UnmagicalState,UnmagicalActions>\r\n\r\n/**\r\n * @category Types\r\n */\r\nexport type NodeName<A> = UnmagicalComponent<A> | string\r\n\r\n/**\r\n * @category Types\r\n */\r\nexport type Hoc<A> = (c:NodeName<A>) => UnmagicalComponent<A>\r\n\r\n/**\r\n * @category Types\r\n */\r\nexport {VNode} from 'hyperapp'\r\n\r\n\r\n/**\r\n * @category Entries\r\n */\r\nexport const suspendRoot = () => {\r\n  const rootEl = document.documentElement\r\n  const c = +rootEl.dataset.mgSuspendCount\r\n  if (!c || c < 1) {\r\n    rootEl.dataset.mgSuspendCount = \"\" + 1\r\n    rootEl.style.overflow = \"hidden\"\r\n  } else {\r\n    rootEl.dataset.mgSuspendCount = \"\" + (c - 1)\r\n  }\r\n}\r\n\r\n/**\r\n * @category Entries\r\n */\r\nexport const resumeRoot = () => {\r\n  const rootEl = document.documentElement\r\n  const c = +rootEl.dataset.mgSuspendCount\r\n  if (c <= 1) {\r\n    delete rootEl.dataset.mgSuspendCount\r\n    rootEl.style.overflow = null\r\n  } else {\r\n    rootEl.dataset.mgSuspendCount = \"\" + (c + 1)\r\n  }\r\n}\r\n\r\n/**\r\n * @category Entries\r\n */\r\nexport const prepareToDestroy = (el:Element, anim:Animation, done:DoneFunc) => {\r\n  const tid = setTimeout(() => {\r\n    done()\r\n    anim.onfinish = null\r\n  }, 800)\r\n  anim.onfinish = () => {\r\n    done()\r\n    clearTimeout(tid)\r\n  }\r\n}\r\n\r\n/**\r\n * @category Entries\r\n */\r\nexport const compose = <Attrs>(p1:Hoc<Attrs>, p2:Hoc<Attrs>):Hoc<Attrs> => (C) => {\r\n  return (props, children) => (state, actions) => {\r\n    const more = (props, children) => {\r\n      const i = p1(C)(props, children)\r\n      return (typeof i == 'function') ? i(state, actions) : i\r\n    }\r\n    const i = p2(more)(props, children)\r\n    const x = (typeof i == 'function') ? i(state, actions) : i\r\n    if (x) return x\r\n    const i2 = p1(C)(props, children)\r\n    return (typeof i == 'function') ? i(state, actions) : i\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n/*\r\nThe following code is left as it may be used in the future.\r\n\r\nexport const playSmartControl = (C, map = {}) => {\r\n  map = {...defaultAttributeMap.smartControl, ...map}\r\n  return (props, children) => (state, actions) => {\r\n    const {...attributes} = props\r\n    const path = props['mg-path']\r\n    const slot = API.getSlot(path, state.env)\r\n    if (! slot) return null\r\n    attributes[map.onchange] = actions.onSmartControlChange\r\n    addAttr(attributes, map.value, slot.input)\r\n    addClass(attributes, map.class, map.fixedClass)\r\n    return h(C, attributes, ...children)\r\n  }\r\n}\r\n*/\r\n\r\n\r\n/**\r\n * Properties users provide to Textbox component.\r\n * @category Textbox\r\n */\r\nexport type TextboxExtraProps = {\r\n  /**\r\n   * Json path to the value, which bound to a Textbox.\r\n   */\r\n  path: string\r\n}\r\n\r\n/**\r\n * Properties an implementor of Textbox get.\r\n * @category Textbox\r\n */\r\nexport type TextboxAutoProps = {\r\n  /**\r\n   * Unmagical will use this property. Please render as is.\r\n   */\r\n  'data-mg-path' :string, \r\n  /**\r\n   * Unmagical will use this property. Please render as is.\r\n   */\r\n  'data-mg-value-attribute' :string, \r\n  /**\r\n   * Unmagical will use this property. Please render as is.\r\n   */\r\n  oninput :UnmagicalAction<Event>, \r\n  /**\r\n   * Unmagical will use this property. Please render as is.\r\n   */\r\n  onblur :UnmagicalAction<Event>, \r\n  /**\r\n   * Unmagical will use this property. Please render as is.\r\n   */\r\n  value :string, \r\n  /**\r\n   * True if the validation of an input string failed.\r\n   */ \r\n  invalid :boolean, \r\n  /**\r\n   * An error message of the validation. An empty string if the validation succeeded.\r\n   */\r\n  message :string\r\n}\r\n\r\n/**\r\n * Assigns Textbox role to a node.\r\n * \r\n * @param C A component or tagName to which you give the Textbox role\r\n * @returns A component, which plays the Textbox\r\n * @category Textbox\r\n */\r\nexport const playTextbox = <OtherAttrs extends {}>(C:NodeName<TextboxAutoProps & OtherAttrs>):UnmagicalComponent<TextboxExtraProps & OtherAttrs> => {\r\n  return (props, children:Children[]) => (state:UnmagicalState, actions:UnmagicalActions) => {\r\n    const {path, ...attributes} = props\r\n    const slot = API.getSlot(path, state.env)\r\n    if (! slot) return null\r\n    const invalid = ((slot.touched || false) && (slot.invalid || false))\r\n    const attrs:TextboxAutoProps = {\r\n      ...attributes, \r\n      'data-mg-path': path, \r\n      'data-mg-value-attribute': 'value', \r\n      oninput: actions.onTextboxInput, \r\n      onblur: actions.onTextboxBlur, \r\n      value: slot.input, \r\n      invalid, \r\n      message: slot.error ? state.normalizeError(slot.error).message : ''\r\n    } \r\n    return h(C, attrs, ...children)\r\n  }\r\n}\r\n\r\n/**\r\n * @category Slider\r\n */\r\nexport type SliderExtraProps = {\r\n  path: string\r\n}\r\n\r\n/**\r\n * @category Slider\r\n */\r\nexport type SliderAutoProps = {\r\n  'data-mg-path': string, \r\n  'data-mg-value-attribute': string, \r\n  oninput: UnmagicalAction<Event>, \r\n  onchange: UnmagicalAction<Event>, \r\n  value: string, \r\n  invalid: boolean, \r\n  message: string\r\n}\r\n\r\nexport const playSlider = <OtherAttrs extends {}>(C:NodeName<SliderAutoProps & OtherAttrs>):UnmagicalComponent<SliderExtraProps & OtherAttrs> => {\r\n  return (props, children) => (state, actions) => {\r\n    const {path, ...attributes} = props\r\n    const slot = API.getSlot(path, state.env)\r\n    if (! slot) return null\r\n    const invalid = ((slot.touched || false) && (slot.invalid || false))\r\n    const attrs:SliderAutoProps = {\r\n      ...attributes, \r\n      'data-mg-path': path, \r\n      'data-mg-value-attribute': 'value', \r\n      oninput: actions.onSliderInput, \r\n      onchange: actions.onSliderChange, \r\n      value: slot.input, \r\n      invalid, \r\n      message: slot.error ? state.normalizeError(slot.error).message : ''\r\n    } \r\n    return h(C, attrs, ...children)\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * @category Listbox\r\n */\r\nexport type ListboxExtraProps = {\r\n  path: string\r\n}\r\n\r\n/**\r\n * @category Listbox\r\n */\r\nexport type ListboxAutoProps = {\r\n  'data-mg-path': string, \r\n  'data-mg-value-attribute': string, \r\n  onchange: UnmagicalAction<Event>, \r\n  invalid: boolean, \r\n  message: string, \r\n  value: string\r\n}\r\n\r\n/**\r\n * \r\n * @param C \r\n * @category Listbox\r\n */\r\nexport const playListbox = <OtherAttrs extends {}>(C:NodeName<ListboxAutoProps & OtherAttrs>):UnmagicalComponent<ListboxExtraProps & OtherAttrs> => {\r\n  return (props, children) => (state, actions) => {\r\n    const {path, ...attributes} = props\r\n    const slot = API.getSlot(path, state.env)\r\n    if (! slot) return null\r\n    const invalid = ((slot.touched || false) && (slot.invalid || false))\r\n    const attrs:ListboxAutoProps = {\r\n      ...attributes, \r\n      'data-mg-path': path, \r\n      'data-mg-value-attribute': 'value', \r\n      onchange: actions.onListboxChange, \r\n      invalid, \r\n      message: slot.error ? state.normalizeError(slot.error).message : '', \r\n      value: slot.input\r\n    }\r\n    return h(C, attrs, ...children)\r\n  }\r\n}\r\n\r\n/**\r\n * @category Radio\r\n */\r\nexport type RadioExtraProps = {\r\n  path: string, \r\n  value: string\r\n}\r\n\r\n/**\r\n * @category Radio\r\n */\r\nexport type RadioAutoProps = {\r\n  'data-mg-path': string, \r\n  'data-mg-value-attribute': string, \r\n  onchange: UnmagicalAction<Event>, \r\n  checked: boolean, \r\n  invalid: boolean, \r\n  message: string, \r\n  value: string\r\n}\r\n\r\n/**\r\n * @category Radio\r\n * @param C \r\n */\r\nexport const playRadio = <OtherAttrs extends {}>(C:NodeName<RadioAutoProps & OtherAttrs>):UnmagicalComponent<RadioExtraProps & OtherAttrs> => {\r\n  return (props, children:Children[]) => (state, actions) => {\r\n    const {path, value, ...attributes} = props\r\n    const slot = API.getSlot(path, state.env)\r\n    if (! slot) return null\r\n    const invalid = ((slot.touched || false) && (slot.invalid || false))\r\n    const attrs:RadioAutoProps = {\r\n      ...attributes, \r\n      'data-mg-path': path, \r\n      'data-mg-value-attribute': 'value', \r\n      onchange: actions.onRadioChange, \r\n      checked: value == slot.value, \r\n      invalid, \r\n      message: slot.error ? state.normalizeError(slot.error).message : '', \r\n      value\r\n    }\r\n    return h(C, attrs, ...children)\r\n  }\r\n}\r\n\r\n/**\r\n * @category Checkbox\r\n */\r\nexport type CheckboxExtraProps = {\r\n  path: string\r\n}\r\n\r\n/**\r\n * @category Checkbox\r\n */\r\nexport type CheckboxAutoProps = {\r\n  'data-mg-path': string, \r\n  'data-mg-checked-attribute': string, \r\n  onchange: UnmagicalAction<Event>, \r\n  checked: boolean, \r\n  invalid: boolean, \r\n  message: string\r\n}\r\n\r\n/**\r\n * @category Checkbox\r\n * @param C \r\n */\r\nexport const playCheckbox = <OtherAttrs extends {}>(C:NodeName<CheckboxAutoProps & OtherAttrs>):UnmagicalComponent<CheckboxExtraProps & OtherAttrs> => {\r\n  return (props, children:Children[]) => (state, actions) => {\r\n    const {path, ...attributes} = props\r\n    const slot = API.getSlot(path, state.env)\r\n    if (! slot) return null\r\n    const invalid = ((slot.touched || false) && (slot.invalid || false))\r\n    const attrs:CheckboxAutoProps = {\r\n      ...attributes, \r\n      'data-mg-path': path, \r\n      'data-mg-checked-attribute': 'checked', \r\n      onchange: actions.onCheckboxChange, \r\n      checked: slot.value as boolean, \r\n      invalid, \r\n      message: slot.error ? state.normalizeError(slot.error).message : ''\r\n    }\r\n    return h(C, attrs, ...children)\r\n  }\r\n}\r\n\r\n/**\r\n * @category UpdateButton\r\n */\r\nexport type UpdateButtonExtraProps = {\r\n  update: string, \r\n  context: Json\r\n}\r\n\r\n/**\r\n * @category UpdateButton\r\n */\r\nexport type UpdateButtonAutoProps = {\r\n  'data-mg-update': string, \r\n  'data-mg-context': string, \r\n  onclick: UnmagicalAction<Event>\r\n}\r\n\r\n/**\r\n * @category UpdateButton\r\n */\r\nexport const playUpdateButton = <OtherAttrs extends {}>(C:NodeName<UpdateButtonAutoProps & OtherAttrs>):UnmagicalComponent<UpdateButtonExtraProps & OtherAttrs> => {\r\n  return (props, children) => (state, actions) => {\r\n    const {update, context, ...attributes} = props\r\n    const attrs:UpdateButtonAutoProps = {\r\n      ...attributes, \r\n      'data-mg-update': update, \r\n      'data-mg-context': JSON.stringify(typeof context == \"undefined\" ? null : context), \r\n      onclick: actions.onUpdate\r\n    }\r\n    return h(C, attrs, ...children)\r\n  }\r\n}\r\n\r\n/**\r\n * @category SettleButton\r\n */\r\nexport type SettleButtonExtraProps = {\r\n  name: string, \r\n  result: Json\r\n}\r\n\r\n/**\r\n * @category SettleButton\r\n */\r\nexport type SettleButtonAutoProps = {\r\n  'data-mg-name': string, \r\n  'data-mg-result': string, \r\n  onclick: UnmagicalAction<Event>\r\n}\r\n\r\n/**\r\n * @category SettleButton\r\n */\r\nexport const playSettleButton = <OtherAttrs extends {}>(C:NodeName<SettleButtonAutoProps & OtherAttrs>):UnmagicalComponent<SettleButtonExtraProps & OtherAttrs> => {\r\n  return (props, children) => (state, actions) => {\r\n    const {name, result, ...attributes} = props\r\n    const attrs:SettleButtonAutoProps = {\r\n      ...attributes, \r\n      'data-mg-name': name, \r\n      'data-mg-result': JSON.stringify(typeof result == \"undefined\" ? null : result), \r\n      onclick: actions.onPromiseSettle\r\n    }\r\n    return h(C, attrs, ...children)\r\n  }\r\n}\r\n\r\n/**\r\n * @category Field\r\n */\r\nexport type FieldExtraProps = {\r\n  path: string, \r\n  foldValidity?: boolean\r\n}\r\n\r\n/**\r\n * @category Field\r\n */\r\nexport type FieldAutoProps = {\r\n  invalid: boolean, \r\n  message: string\r\n}\r\n\r\n/**\r\n * \r\n * @param C \r\n * @category Field\r\n */\r\nexport const playField = <OtherAttrs extends {}>(C:NodeName<FieldAutoProps & OtherAttrs>):UnmagicalComponent<FieldExtraProps & OtherAttrs> => {\r\n  return (props, children) => (state, actions) => {\r\n    const {path, foldValidity = false, ...attributes} = props\r\n    if (! API.test(path, state.env)) return null\r\n    const slot = API.getSlot(path, state.env)\r\n    const {invalid, error} = foldValidity ? API.foldValidity(path, state.env) : {invalid:slot.invalid && slot.touched, error:slot.error}\r\n    const attrs:FieldAutoProps = {\r\n      ...attributes, \r\n      invalid, \r\n      message: error ? state.normalizeError(error).message : ''\r\n    }\r\n    return h(C, attrs, ...children)\r\n  }\r\n}\r\n\r\nconst dialogOnCreate:Record<string,OnCreateFunc> = {\r\n  fade: (el:Element):void => {\r\n    suspendRoot()\r\n    el.animate([\r\n      {opacity: 0}, \r\n      {opacity: 1}\r\n    ], 200)\r\n  }, \r\n  scale: (el:Element):void => {\r\n    suspendRoot()\r\n    el.animate([\r\n      {transform: 'scale(0.8)'}, \r\n      {transform: 'scale(1)'}\r\n    ])\r\n  }\r\n}\r\n\r\nconst dialogOnRemove:Record<string,OnRemoveFunc> = {\r\n  fade: (el:Element, done:DoneFunc):void => {\r\n    resumeRoot()\r\n    const anim = el.animate([\r\n      {opacity: 1}, \r\n      {opacity: 0}\r\n    ], 200)\r\n    prepareToDestroy(el, anim, done)\r\n  }, \r\n  scale: (el:Element, done:DoneFunc):void => {\r\n    resumeRoot()\r\n    const anim = el.animate([\r\n      {transform: 'scale(1)'}, \r\n      {transform: 'scale(0.8)'}\r\n    ], 200)\r\n    prepareToDestroy(el, anim, done)\r\n  }\r\n}\r\n\r\n/**\r\n * @category Dialog\r\n */\r\nexport type DialogExtraProps = {\r\n  name: string\r\n}\r\n\r\n/**\r\n * @category Dialog\r\n */\r\nexport type DialogAutoProps = {\r\n  name: string, \r\n  data: any, \r\n  oncreate: OnCreateFunc, \r\n  onremove: OnRemoveFunc, \r\n  shown: boolean\r\n}\r\n\r\n/**\r\n * @category Dialog\r\n */\r\nexport const playDialog = (transition:\"fade\"|\"scale\", nullIfHidden:boolean) => <OtherAttrs extends {}>(C:NodeName<DialogAutoProps & OtherAttrs>):UnmagicalComponent<DialogExtraProps & OtherAttrs> => {\r\n  return (props, children) => (state, actions) => {\r\n    const attributes = props\r\n    const name = attributes.name\r\n    const data = API.getDialog(name, state.env)\r\n    if (nullIfHidden && data === null) return null\r\n    const attrs:DialogAutoProps = {\r\n      ...attributes, \r\n      data, \r\n      oncreate: dialogOnCreate[transition], \r\n      onremove: dialogOnRemove[transition], \r\n      shown: (data !== null)\r\n    }\r\n    return h(C, attrs, ...children)\r\n  }\r\n}\r\n\r\nconst feedbackOnCreate:Record<string,OnCreateFunc> = {\r\n  fade: (el) => {\r\n    el.animate([\r\n      {opacity: 0}, \r\n      {opacity: 1}\r\n    ], 200)\r\n    el.scrollIntoView()\r\n  }, \r\n  zoom: (el) => {\r\n    el.animate([\r\n      {transform: 'scale(0.8)'}, \r\n      {transform: 'scale(1)'}\r\n    ], 200)\r\n    el.scrollIntoView()\r\n  }, \r\n  slide: (el) => {\r\n    const r = el.getBoundingClientRect()\r\n    el.animate([\r\n      {offset:0, maxHeight: 0}, \r\n      {offset:0.999, maxHeight: ((r.height * 1.2) + 30) + 'px'}, \r\n      {offset:1, maxHeight:'none'}\r\n    ], 200)\r\n    el.scrollIntoView()\r\n  }\r\n}\r\nconst feedbackOnRemove:Record<string,OnRemoveFunc> = {\r\n  fade: (el, done) => {\r\n    const anim = el.animate([\r\n      {opacity: 1}, \r\n      {opacity: 0}\r\n    ], 200)\r\n    prepareToDestroy(el, anim, done)\r\n  }, \r\n  zoom: (el, done) => {\r\n    const anim = el.animate([\r\n      {transform: 'scale(1)'}, \r\n      {transform: 'scale(0.8)'}\r\n    ], 200)\r\n    prepareToDestroy(el, anim, done)\r\n  }, \r\n  slide: (el, done) => {\r\n    const r = el.getBoundingClientRect()\r\n    const anim = el.animate([\r\n      {maxHeight: ((r.height * 1.2) + 30) + 'px'}, \r\n      {maxHeight: 0}\r\n    ], 200)\r\n    prepareToDestroy(el, anim, done)\r\n  }\r\n}\r\n\r\n/**\r\n * @category Feedback\r\n */\r\nexport type FeedbackExtraProps = {\r\n  name: string, \r\n  duration?: number\r\n}\r\n\r\n/**\r\n * @category Feedback\r\n */\r\nexport type FeedbackAutoProps = {\r\n  name: string, \r\n  data: any, \r\n  shown: boolean, \r\n  oncreate: OnCreateFunc, \r\n  onremove: OnRemoveFunc\r\n}\r\n\r\n/**\r\n * @category Feedback\r\n */\r\nexport const playFeedback = (transition:\"fade\"|\"zoom\"|\"slide\", nullIfHidden:boolean) => <OtherAttrs extends {}>(C:NodeName<FeedbackAutoProps & OtherAttrs>):UnmagicalComponent<FeedbackExtraProps & OtherAttrs> => {\r\n  return (props, children) => (state, actions) => {\r\n    const {duration = 0, ...attributes} = props\r\n    const name = attributes.name\r\n    const data = API.getFeedback(name, state.env)\r\n    if (nullIfHidden && data === null) return null\r\n    const attrs:FeedbackAutoProps = {\r\n      ...attributes, \r\n      data: ('code' in data) ? state.normalizeError(data) : data, \r\n      shown: data !== null, \r\n      oncreate: feedbackOnCreate[transition], \r\n      onremove: feedbackOnRemove[transition]\r\n    }\r\n    if (duration > 0) {\r\n      let timeoutId = null\r\n      const oncreate = attrs.oncreate\r\n      attrs.oncreate = (el) => {\r\n        timeoutId = setTimeout(() => actions.onUpdate({update:\"closeFeedback\", context:[name]}), duration)\r\n        if (oncreate) oncreate(el)\r\n      }\r\n      const onremove = attrs.onremove\r\n      attrs.onremove = (el, done) => {\r\n        if (timeoutId) {\r\n          clearTimeout(timeoutId)\r\n        }\r\n        if (onremove) onremove(el, done)\r\n      }\r\n    }\r\n    return h(C, attrs, ...children)\r\n  }\r\n}\r\n\r\n/**\r\n * @category Modal\r\n */\r\nexport type ModalExtraProps = {\r\n  shown: boolean\r\n}\r\n\r\n/**\r\n * @category Modal\r\n */\r\nexport type ModalAutoProps = {\r\n  shown: boolean, \r\n  oncreate: OnCreateFunc, \r\n  onremove: OnRemoveFunc\r\n}\r\n\r\n/**\r\n * @category Modal\r\n */\r\nexport const playModal = (transition:\"fade\"|\"scale\", nullIfHidden:boolean) => <OtherAttrs extends {}>(C:NodeName<ModalAutoProps & OtherAttrs>):UnmagicalComponent<ModalExtraProps & OtherAttrs> => {\r\n  return (props, children) => (state, actions) => {\r\n    const attributes = props\r\n    if (! attributes.shown && nullIfHidden) return null\r\n    const attrs:ModalAutoProps = {\r\n      ...attributes, \r\n      oncreate: dialogOnCreate[transition], \r\n      onremove: dialogOnRemove[transition]\r\n    }\r\n    return h(C, attrs, ...children)\r\n  }\r\n}\r\n\r\n/**\r\n * @category Progress\r\n */\r\nexport type ProgressExtraProps = {\r\n  name: string\r\n}\r\n\r\n/**\r\n * @category Progress\r\n */\r\nexport type ProgressAutoProps = {\r\n  name: string, \r\n  shown: boolean, \r\n  current: number|undefined\r\n}\r\n\r\n/**\r\n * @category Progress\r\n */\r\nexport const playProgress = (nullIfHidden:boolean) => <OtherAttrs extends {}>(C:NodeName<ProgressAutoProps & OtherAttrs>):UnmagicalComponent<ProgressExtraProps & OtherAttrs> => {\r\n  return (props, children) => (state, actions) => {\r\n    const attributes = props\r\n    const name = attributes.name\r\n    const current = API.getProgress(name, state.env)\r\n    if (current === null && nullIfHidden) return null\r\n    const attrs = {\r\n      ...attributes, \r\n      shown: current !== null, \r\n      current: (current === null) ? undefined : current\r\n    }\r\n    return h(C, attrs, ...children)\r\n  }\r\n}\r\n\r\n/**\r\n * @category Page\r\n */\r\nexport type PageExtraProps = {\r\n  index: number, \r\n  name: string\r\n}\r\n\r\n/**\r\n * @category Page\r\n */\r\nexport type PageAutoProps = {\r\n  index: number, \r\n  name: string, \r\n  shown: boolean\r\n}\r\n\r\n/**\r\n * @category Page\r\n */\r\nexport const playPage = (nullIfHidden:boolean) => <OtherAttrs extends {}>(C:NodeName<PageAutoProps & OtherAttrs>):UnmagicalComponent<PageExtraProps & OtherAttrs> => {\r\n  return (props, children) => (state, actions) => {\r\n    const attributes = props\r\n    const index = attributes.index\r\n    const name = attributes.name\r\n    const current = API.getPage(name, state.env)\r\n    const shown = (index == current)\r\n    if (! shown && nullIfHidden) return null\r\n    const attrs:PageAutoProps = {\r\n      ...attributes, \r\n      shown\r\n    }\r\n    return h(C, attrs, ...children)\r\n  }\r\n}\r\n\r\nconst listItemOnCreate:Record<string,OnCreateFunc> = {\r\n  fade: (el) => {\r\n    el.animate([\r\n      {opacity: 0}, \r\n      {opacity: 1}\r\n    ], 200)\r\n    el.scrollIntoView()\r\n  }, \r\n  slide: (el) => {\r\n    const r = el.getBoundingClientRect()\r\n    el.animate([\r\n      {offset:0, maxHeight: 0}, \r\n      {offset:0.999, maxHeight: ((r.height * 1.2) + 30) + 'px'}, \r\n      {offset:1, maxHeight:'none'}\r\n    ], 200)\r\n    el.scrollIntoView()\r\n  }\r\n}\r\nconst listItemOnRemove:Record<string,OnRemoveFunc> = {\r\n  fade: (el, done) => {\r\n    const anim = el.animate([\r\n      {opacity: 1}, \r\n      {opacity: 0}\r\n    ], 200)\r\n    prepareToDestroy(el, anim, done)\r\n  }, \r\n  slide: (el, done) => {\r\n    const r = el.getBoundingClientRect()\r\n    const anim = el.animate([\r\n      {maxHeight: ((r.height * 1.2) + 30) + 'px'}, \r\n      {maxHeight: 0}\r\n    ], 200)\r\n    prepareToDestroy(el, anim, done)\r\n  }\r\n}\r\n\r\n/**\r\n * @category Switch\r\n */\r\nexport type SwitchExtraProps = {\r\n  name: string\r\n}\r\n\r\n/**\r\n * @category Switch\r\n */\r\nexport type SwitchAutoProps = {\r\n  name: string, \r\n  shown: boolean\r\n}\r\n\r\n/**\r\n * @category Switch\r\n */\r\nexport const playSwitch = (nullIfHidden:boolean) => <OtherAttrs extends {}>(C:NodeName<SwitchAutoProps & OtherAttrs>):UnmagicalComponent<SwitchExtraProps & OtherAttrs> => {\r\n  return (props, children) => (state, actions) => {\r\n    const attributes = props\r\n    const name = attributes.name\r\n    const shown = API.getSwitch(name, state.env)\r\n    if (! shown && nullIfHidden) return null\r\n    const attrs = {\r\n      ...attributes, \r\n      shown\r\n    }\r\n    return h(C, attrs, ...children)\r\n  }\r\n}\r\n\r\n/**\r\n * @category ListItem\r\n */\r\nexport type ListItemExtraProps = {}\r\n\r\n/**\r\n * @category ListItem\r\n */\r\nexport type ListItemAutoProps = {\r\n  oncreate: OnCreateFunc, \r\n  onremove: OnRemoveFunc\r\n}\r\n\r\n/**\r\n * @category ListItem\r\n */\r\nexport const playListItem = (transition:\"fade\"|\"slide\") => <OtherAttrs extends {}>(C:NodeName<ListItemAutoProps & OtherAttrs>):UnmagicalComponent<ListItemExtraProps & OtherAttrs> => {\r\n  return (props, children) => (state, actions) => {\r\n    const attributes = props\r\n    const attrs:ListItemAutoProps = {\r\n      ...attributes, \r\n      oncreate: listItemOnCreate[transition], \r\n      onremove: listItemOnRemove[transition]\r\n    }\r\n    return h(C, attrs, ...children)\r\n  }\r\n}\r\n\r\nconst getSiblings = (pageNo:number, width:number, firstPageNo:number, lastPageNo:number):number[] => {\r\n  const rv = []\r\n  for (let i = pageNo - width; i <= pageNo + width; i++) {\r\n    if (i < firstPageNo) continue\r\n    if (i > lastPageNo) continue\r\n    rv.push(i)\r\n  }\r\n  return rv\r\n}\r\n\r\n/**\r\n * @category Pagination\r\n */\r\nexport type PaginationExtraProps = {\r\n  listPath: string, \r\n  width?: number, \r\n  pageProperty?: string, \r\n  limitProperty?: string\r\n}\r\n\r\n/**\r\n * @category Pagination\r\n */\r\nexport type PaginationAutoProps = {\r\n  listPath: string, \r\n  current: number|null, \r\n  prev: number|null, \r\n  next: number|null, \r\n  first: number|null, \r\n  last: number|null, \r\n  siblings: number[]\r\n}\r\n\r\n/**\r\n * @category Pagination\r\n */\r\nexport const playPagination = <OtherAttrs extends {}>(C:NodeName<PaginationAutoProps & OtherAttrs>):UnmagicalComponent<PaginationExtraProps & OtherAttrs> => {\r\n  return (props, children) => (state, actions) => {\r\n    const {listPath, width = 2, pageProperty = 'page', limitProperty = 'limit', ...attributes} = props\r\n    const query = API.extract(listPath + '/query', state.env)\r\n    const totalCount = +API.extract(listPath + '/totalCount', state.env)\r\n    const page = query[pageProperty]\r\n    if (totalCount > 0) {\r\n      const first = 1\r\n      const last = Math.ceil(totalCount / query[limitProperty])\r\n      const siblings = getSiblings(page, width, first, last)\r\n      const attrs:PaginationAutoProps = {\r\n        ...attributes, \r\n        listPath, \r\n        current: page, \r\n        prev: first < page ? page - 1 : null, \r\n        next: page < last ? page + 1 : null, \r\n        first: first < page - width ? first : null, \r\n        last: page + width < last ? last : null, \r\n        siblings\r\n      }\r\n      return h(C, attrs, ...children)\r\n    } else {\r\n      const attrs:PaginationAutoProps = {\r\n        ...attributes, \r\n        listPath, \r\n        current: null, \r\n        prev: null, \r\n        next: null, \r\n        first: null, \r\n        last: null, \r\n        siblings: []\r\n      }\r\n      return h(C, attrs, ...children)\r\n    }\r\n  }\r\n}\r\n\r\nconst instantiateFlatpickr = (path:string, onchange:UnmagicalAction<{path:string,input:string}|[{path:string,input:string}]>, defaultValue:string, clearerId:string, config:object):{oncreate:OnCreateFunc,ondestroy:OnDestroyFunc} => {\r\n  let instance = null\r\n  return {\r\n    oncreate: (el) => {\r\n      const cfg = {\r\n        ...config, \r\n        defaultDate: defaultValue || null\r\n      }\r\n      // @ts-ignore\r\n      instance = flatpickr(el, cfg)\r\n      instance.config.onChange.push((selectedDates, dateStr:string) => {\r\n        onchange({path, input:dateStr})\r\n      })\r\n      if (clearerId) {\r\n        const clearer = document.getElementById(clearerId)\r\n        if (clearer) {\r\n          clearer.onclick = instance.clear\r\n        }\r\n      }\r\n    }, \r\n    ondestroy: (el) => {\r\n      if (instance) {\r\n        instance.destroy()\r\n        instance = null\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * @category Flatpickr\r\n */\r\nexport type FlatpickrExtraProps = {\r\n  path: string, \r\n  clearerId: string|null, \r\n  config: object\r\n}\r\n\r\n/**\r\n * @category Flatpickr\r\n */\r\nexport type FlatpickrAutoProps = {\r\n  invalid: boolean, \r\n  message: string, \r\n  oncreate: OnCreateFunc, \r\n  ondestroy: OnDestroyFunc\r\n}\r\n\r\n/**\r\n * @category Flatpickr\r\n */\r\nexport const playFlatpickr = <OtherAttrs extends {}>(C:NodeName<FlatpickrAutoProps & OtherAttrs>):UnmagicalComponent<FlatpickrExtraProps & OtherAttrs> => {\r\n  return (props, children) => (state, actions) => {\r\n    const {path, clearerId = null, config = {}, ...attributes} = props\r\n    const slot = API.getSlot(path, state.env)\r\n    if (! slot) return null\r\n    const {oncreate, ondestroy} = instantiateFlatpickr(path, actions.onSmartControlChange, slot.input, clearerId, config)\r\n    const invalid = ((slot.touched || false) && (slot.invalid || false))\r\n    const attrs:FlatpickrAutoProps = {\r\n      ...attributes, \r\n      invalid, \r\n      message: slot.error ? state.normalizeError(slot.error).message : '', \r\n      oncreate, \r\n      ondestroy\r\n    }\r\n    return h(C, attrs, ...children)\r\n  }\r\n}\r\n\r\nconst instantiatePickr = (path:string, onchange:UnmagicalAction<{path:string,input:string}|[{path:string,input:string}]>, defaultValue:string, clearerId:string, options:object):{oncreate:OnCreateFunc, ondestroy:OnDestroyFunc} => {\r\n  let instance = null\r\n  return {\r\n    oncreate: (el) => {\r\n      const opts = {\r\n        ...options, \r\n        useAsButton: true, \r\n        default: defaultValue || null, \r\n        el\r\n      }\r\n      // @ts-ignore\r\n      instance = Pickr.create(opts)\r\n      instance.on('clear', () => {\r\n        onchange({path, input:''})\r\n      }).on('save', (color) => {\r\n        const input = color ? color.toHEXA().toString() : null\r\n        instance.hide()\r\n        onchange({path, input})\r\n      })\r\n      if (clearerId) {\r\n        const clearer = document.getElementById(clearerId)\r\n        if (clearer) {\r\n          clearer.onclick = (ev) => {\r\n            instance.setColor(null)\r\n          }\r\n        }\r\n      }\r\n    }, \r\n    ondestroy: (el) => {\r\n      if (instance) {\r\n        instance.destroy()\r\n        instance = null\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * @category Pickr\r\n */\r\nexport type PickrExtraProps = {\r\n  path: string, \r\n  clearerId: string, \r\n  options: object\r\n}\r\n\r\n/**\r\n * @category Pickr\r\n */\r\nexport type PickrAutoProps = {\r\n  value: string, \r\n  invalid: boolean, \r\n  message: string, \r\n  oncreate: OnCreateFunc, \r\n  ondestroy: OnDestroyFunc\r\n}\r\n\r\n/**\r\n * @category Pickr\r\n */\r\nexport const playPickr = <OtherAttrs extends {}>(C:NodeName<PickrAutoProps & OtherAttrs>):UnmagicalComponent<PickrExtraProps & OtherAttrs> => {\r\n  return (props, children) => (state, actions) => {\r\n    const {path, clearerId = null, options = {}, ...attributes} = props\r\n    const slot = API.getSlot(path, state.env)\r\n    if (! slot) return null\r\n    const {oncreate, ondestroy} = instantiatePickr(path, actions.onSmartControlChange, slot.input, clearerId, options)\r\n    const invalid = ((slot.touched || false) && (slot.invalid || false))\r\n    const attrs:PickrAutoProps = {\r\n      ...attributes, \r\n      value: slot.input, \r\n      invalid, \r\n      message: slot.error ? state.normalizeError(slot.error).message : '', \r\n      oncreate, \r\n      ondestroy\r\n    }\r\n    return h(C, attrs, ...children)\r\n  }\r\n}\r\ninterface SortableEvent {\r\n  from: HTMLElement, \r\n  to: HTMLElement, \r\n  item: HTMLElement, \r\n  oldIndex: number, \r\n  newIndex: number\r\n}\r\n\r\nconst instantiateSortable = (name:string, onStart:UnmagicalAction<{update:string,context:any[]}>, onEnd:UnmagicalAction<{name:string,result:any}>, options:object):{oncreate:OnCreateFunc, ondestroy:OnDestroyFunc} => {\r\n  var instance = null;\r\n  var marker = null;\r\n  var group = null;\r\n  const effectiveOptions = {\r\n    ...options, \r\n    onStart: (ev:SortableEvent) => {\r\n      const fromPath = ev.from.dataset.mgPath\r\n      marker = ev.item.nextElementSibling\r\n      onStart({\r\n        update: 'reorder', \r\n        context: [name, fromPath + '/' + ev.oldIndex, group]\r\n      })\r\n    }, \r\n    onEnd: (ev:SortableEvent) => {\r\n      setTimeout(function() {\r\n        ev.from.insertBefore(ev.item, marker)\r\n        marker = null\r\n      }, 0)\r\n      const toPath = ev.to.dataset.mgPath\r\n      onEnd({\r\n        name, \r\n        result: {\r\n          path: toPath + '/' + ev.newIndex\r\n        }\r\n      })\r\n    }\r\n  }\r\n  return {\r\n    oncreate: (el) => {\r\n      // @ts-ignore\r\n      instance = Sortable.create(el, effectiveOptions)\r\n      group = instance.option('group').name\r\n    }, \r\n    ondestroy: () => {\r\n      if (instance) {\r\n        instance.destroy()\r\n        instance = null\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * @category Sortable\r\n */\r\nexport type SortableExtraProps = {\r\n  name: string, \r\n  path: string, \r\n  options: object\r\n}\r\n\r\n/**\r\n * @category Sortable\r\n */\r\nexport type SortableAutoProps = {\r\n  'data-mg-path': string, \r\n  active: boolean, \r\n  itemPath: string, \r\n  group: string, \r\n  oncreate: OnCreateFunc, \r\n  ondestroy: OnDestroyFunc\r\n}\r\n\r\n/**\r\n * @category Sortable\r\n */\r\nexport const playSortable = <OtherAttrs extends {}>(C:NodeName<SortableAutoProps & OtherAttrs>):UnmagicalComponent<SortableExtraProps & OtherAttrs> => {\r\n  return (props, children) => (state, actions) => {\r\n    const {name, path, options = {}, ...attributes} = props\r\n    const extra = API.getExtra(name, state.env) as {itemPath:string, group:string}\r\n    const active = !!extra\r\n    const {oncreate, ondestroy} = instantiateSortable(name, actions.onUpdate, actions.onPromiseSettle, options)\r\n    const attrs:SortableAutoProps = {\r\n      ...attributes, \r\n      'data-mg-path': path, \r\n      active, \r\n      itemPath: extra ? extra.itemPath : \"\", \r\n      group: extra ? extra.group : \"\", \r\n      oncreate, \r\n      ondestroy\r\n    }\r\n    return h(C, attrs, ...children)\r\n  }\r\n}\r\n\r\n\r\n\r\n","\r\nimport template from 'string-template'\r\nimport {VNode} from 'hyperapp'\r\nimport * as C from '../core/components'\r\nimport {h} from '../core/framework'\r\nexport {API, start, h} from '../core/framework'\r\n\r\nexport type AnyAttrs = {\r\n  [key:string]:any \r\n}\r\n\r\n\r\nexport const Input = C.playTextbox<AnyAttrs>(({invalid, message, class:clazz = '', ...props}) => {\r\n  clazz += \" input\"\r\n  if (invalid) clazz += \" is-danger\"\r\n  return (\r\n    <input {...props} class={clazz} />\r\n  )\r\n})\r\n\r\nexport const Textarea = C.playTextbox<AnyAttrs>(({invalid, message, class:clazz = '', ...props}) => {\r\n  clazz += \" textarea\"\r\n  if (invalid) clazz += \" is-danger\"\r\n  return (\r\n    <textarea {...props} class={clazz}></textarea>\r\n  )\r\n})\r\n\r\n// bulma has no range-sliders\r\n\r\nconst setValueToChildren = (value:string, cs:Array<VNode|string>):Array<VNode|string> => {\r\n  return cs.map(o => {\r\n    if (typeof o != 'object') return o\r\n    const children = (o.children && o.children.length) ? setValueToChildren(value, o.children) : o.children\r\n    if ('value' in o.attributes) {\r\n      return {...o, selected: (o as VNode<{value:string}>).attributes.value == value, children}\r\n    } else {\r\n      return {...o, children}\r\n    }\r\n  })\r\n}\r\n\r\nexport const Select = C.playListbox<{inputProps?: object, disabled?: boolean} & AnyAttrs>(({onchange, 'data-mg-path':dataMgPath, 'data-mg-value-attribute':dataMgValueAttribute, invalid, message, value, disabled = false, class:clazz = '', inputProps = {}, ...props}, children) => {\r\n  clazz += \" select\"\r\n  if (invalid) clazz += \" is-danger\"\r\n  return (\r\n    <div {...props} class={clazz}>\r\n      <select {...inputProps} onchange={onchange} data-mg-path={dataMgPath} data-mg-value-attribute={dataMgValueAttribute} disabled={disabled}>\r\n        {setValueToChildren(value, children)}\r\n      </select>\r\n    </div>\r\n  )\r\n})\r\n\r\nexport const Radio = C.playRadio<{inputProps?: object, name?: string, disabled?: boolean} & AnyAttrs>(({checked, onchange, 'data-mg-path':dataMgPath, 'data-mg-value-attribute':dataMgValueAttribute, invalid, message, value, disabled = false, name = null, inputProps = {}, class:clazz = '', ...props}, children) => {\r\n  clazz += ' radio'\r\n  if (name === null) name = dataMgPath\r\n  return (\r\n    <label {...props} disabled={disabled} class={clazz}>\r\n      <input {...inputProps} type=\"radio\" onchange={onchange} data-mg-path={dataMgPath} data-mg-value-attribute={dataMgValueAttribute} name={name} disabled={disabled} checked={checked} value={value} />\r\n      {children}\r\n    </label>\r\n  )\r\n})\r\n\r\nexport const Checkbox = C.playCheckbox<{disabled?: boolean, inputProps?: object} & AnyAttrs>(({checked, onchange, 'data-mg-path':dataMgPath, 'data-mg-checked-attribute':dataMgCheckedAttribute, invalid, message, disabled = false, inputProps = {}, class:clazz = '', ...props}, children) => {\r\n  clazz += ' checkbox'\r\n  return (\r\n    <label {...props} disabled={disabled} class={clazz}>\r\n      <input {...inputProps} type=\"checkbox\" onchange={onchange} data-mg-path={dataMgPath} data-mg-checked-attribute={dataMgCheckedAttribute} disabled={disabled} checked={checked} />\r\n      {children}\r\n    </label>\r\n  )\r\n})\r\n\r\nexport const Field = C.playField<{label?: string} & AnyAttrs>(({invalid, message, label = '', class:clazz = '', ...props}, children) => {\r\n  clazz += ' field'\r\n  return (\r\n    <div {...props} class={clazz}>\r\n      {label ? (<label class=\"label\">{label}</label>) : null}\r\n      {children}\r\n      {invalid && message ? (\r\n        <p class=\"help is-danger\">{message}</p>\r\n      ) : null}\r\n    </div>\r\n  )\r\n})\r\n\r\nexport const UpdateButton = C.compose<AnyAttrs>(C.playUpdateButton, C.playProgress(false))(({shown, class:clazz = '', ...props}, children) => {\r\n  clazz += ' button'\r\n  if (shown) clazz += ' is-loading'\r\n  return (\r\n    <button {...props} class={clazz}>{children}</button>\r\n  )\r\n})\r\n\r\nexport const DeleteButton = C.playUpdateButton<AnyAttrs>(({class:clazz = '', ...props}, children) => {\r\n  clazz += ' delete'\r\n  return (\r\n    <button {...props} class={clazz}>{children}</button>\r\n  )\r\n})\r\n\r\nexport const Clickable = C.playUpdateButton<AnyAttrs>(\"a\")\r\n\r\nexport const SettleButton = C.playSettleButton<AnyAttrs>(({class:clazz = '', ...props}, children) => {\r\n  clazz += ' button'\r\n  return (\r\n    <button {...props} class={clazz}>{children}</button>\r\n  )\r\n})\r\n\r\nexport const Dialog = C.playDialog(\"fade\", true)<{title: string, message: string, hideCancelButton?: boolean, okLabel?: string, cancelLabel?: string} & AnyAttrs>(({data, name, shown, title, message, hideCancelButton = false, okLabel = 'OK', cancelLabel = 'Cancel', class:clazz = '', ...props}) => {\r\n  const effectiveMessage = template(message, data)\r\n  clazz += ' modal is-active'\r\n  console.log('Dialog', name, props)\r\n  return (\r\n    <div {...props} key={name} class={clazz}>\r\n      <div class=\"modal-background\"></div>\r\n      <div class=\"modal-card\">\r\n        <header class=\"modal-card-head\">\r\n          <p class=\"modal-card-title\">{title}</p>\r\n        </header>\r\n        <section class=\"modal-card-body\">\r\n          <p>{effectiveMessage}</p>\r\n        </section>\r\n        <footer class=\"modal-card-foot\">\r\n          <SettleButton class=\"button is-success\" name={name} result={true}>{okLabel}</SettleButton>\r\n          {! hideCancelButton ? (<SettleButton class=\"button\" name={name} result={false}>{cancelLabel}</SettleButton>) : null}\r\n        </footer>\r\n      </div>\r\n    </div>\r\n  )\r\n})\r\n\r\nexport const Notification = C.playFeedback(\"slide\", true)<{message: string} & AnyAttrs>(({name, data, shown, message, class:clazz = '', ...props}) => {\r\n  const effectiveMessage = template(message, data)\r\n  clazz += ' notification'\r\n  return (\r\n    <div {...props} key={name} class={clazz}>\r\n      <DeleteButton update=\"closeFeedback\" context={[name]}></DeleteButton>\r\n      <p>{effectiveMessage}</p>\r\n    </div>\r\n  )\r\n})\r\n\r\nexport const Progress = C.playProgress(true)<AnyAttrs>(({current, name, shown, class:clazz = '', ...props}) => {\r\n  clazz += ' pregress'\r\n  return (\r\n    <progress {...props} class={clazz} value={current}>indeterminated</progress>\r\n  )\r\n})\r\n\r\nexport const Modal = C.playModal(\"fade\", true)<AnyAttrs>(({class:clazz = '', ...props}, children) => {\r\n  clazz += ' modal is-active'\r\n  return (\r\n    <div {...props} class={clazz}>\r\n      <div class=\"modal-background\"></div>\r\n      {children}\r\n    </div>\r\n  )\r\n})\r\n\r\nexport const Pagination = C.playPagination<{prevLabel?: string, nextLabel?: string, loadItemsOptions?: object} & AnyAttrs>(({current, prev, next, first, last, siblings, listPath, prevLabel = 'Previous', nextLabel = 'Next', loadItemsOptions = {}, ...props}) => {\r\n  return (\r\n    <nav {...props} class=\"pagination\" role=\"navigation\" aria-label=\"pagination\">\r\n      <Clickable class=\"pagination-previous\" update=\"loadItems\" context={[listPath, {...loadItemsOptions, page:prev}]} disabled={! prev}>{prevLabel}</Clickable>\r\n      <Clickable class=\"pagination-next\" update=\"loadItems\" context={[listPath, {...loadItemsOptions, page:next}]} disabled={! next}>{nextLabel}</Clickable>\r\n      <ul class=\"pagination-list\">\r\n        {first ? (<li><Clickable class=\"pagination-link\" update=\"loadItems\" context={[listPath, {...loadItemsOptions, page:first}]}>{first}</Clickable></li>) : null}\r\n        {first ? (<li><span class=\"pagination-ellipsis\">&hellip;</span></li>) : null}\r\n        {siblings.map(pno => (<li><Clickable class={`pagination-link ${pno == current ? 'is-current' : ''}`} update=\"loadItems\" context={[listPath, {...loadItemsOptions, page:pno}]}>{pno}</Clickable></li>))}\r\n        {last ? (<li><span class=\"pagination-ellipsis\">&hellip;</span></li>) : null}\r\n        {last ? (<li><Clickable class=\"pagination-link\" update=\"loadItems\" context={[listPath, {...loadItemsOptions, page:last}]}>{last}</Clickable></li>) : null}\r\n      </ul>\r\n    </nav>\r\n  )\r\n})\r\n\r\nexport const DatePicker = C.playFlatpickr<AnyAttrs>(({invalid, message, class:clazz = '', ...props}) => {\r\n  clazz += ' input'\r\n  if (invalid) clazz += ' is-danger'\r\n  return (\r\n    <input {...props} type=\"text\" class={clazz} />\r\n  )\r\n})\r\n\r\nexport const ColorPicker = C.playPickr<{iconClass?: string, iconText?: string} & AnyAttrs>(({invalid, message, value, iconClass = 'material-icons', iconText = 'palette', class:clazz = '', ...props}) => {\r\n  clazz += ' button'\r\n  return (\r\n    <button {...props} type=\"button\" class={clazz}>\r\n      <span class=\"icon\"><i class={iconClass} style={{color:value}}>{iconText}</i></span>\r\n    </button>\r\n  )\r\n})\r\n\r\nexport type ShowItemFunc = (item:any, index:number, itemPath:string, group:string) => VNode<any>\r\n\r\nexport const ReorderableMenuList = C.playSortable<{showItem?: ShowItemFunc, items?: any[]} & AnyAttrs>(({active, itemPath, group, showItem = null, items = null, ...props}, children) => {\r\n  console.log('ReorderableMenuList', showItem, items)\r\n  return (\r\n    <ul {...props}>\r\n      {(showItem && items) ? (\r\n        items.map((item, index) => showItem(item, index, itemPath, group))\r\n      ) : (\r\n        children\r\n      )}\r\n    </ul>\r\n  )\r\n})","/**\r\n * REST client of Repository implmentation\r\n * \r\n * @module core/rest\r\n */\r\n\r\nimport {normalizeQuery} from './utils'\r\nimport {Repository} from './updates'\r\n\r\n/**\r\n * \r\n * @function\r\n * @private\r\n * @param {Response} response \r\n * @returns {Error}\r\n */\r\nconst responseToError = (response:Response):Error => {\r\n  const message = response.status + ' ' + response.statusText\r\n  const error = new Error(message)\r\n  error.name = 'http.' + response.status\r\n  return error\r\n}\r\n\r\nexport type CreateRestRepositoryOptions = {\r\n  idProperty?: string, \r\n  omitEmptyQueryParam?:boolean, \r\n  totalCountHeader?:string, \r\n  headers?:Record<string,string>, \r\n  optionsForSearch?:CreateRestRepositoryOptions, \r\n  optionsForAdd?:CreateRestRepositoryOptions, \r\n  optionsForUpdate?:CreateRestRepositoryOptions, \r\n  optionsForRemove?:CreateRestRepositoryOptions\r\n}\r\n\r\n/**\r\n * \r\n * @function\r\n * @param {string} baseUrl\r\n * @param {Object} options\r\n * @param {string} options.idProperty\r\n * @param {boolean} options.omitEmptyQueryParam\r\n * @param {string} options.totalCountHeader\r\n * @param {Object} options.optionsForSearch\r\n * @param {Object} options.optionsForAdd\r\n * @param {Object} options.optionsForUpdate\r\n * @param {Object} options.optionsForRemove\r\n * @returns {Repository}\r\n */\r\nexport const createRestRepository = (baseUrl:string, options:CreateRestRepositoryOptions = {}):Repository => {\r\n  const opts:CreateRestRepositoryOptions = {\r\n    idProperty: 'id', \r\n    omitEmptyQueryParam: true, \r\n    totalCountHeader: 'X-Total-Count', \r\n    optionsForSearch: {}, \r\n    optionsForAdd: {}, \r\n    optionsForUpdate: {}, \r\n    optionsForRemove: {}, \r\n    ...options\r\n  }\r\n  return {\r\n    search: (query) => {\r\n      const fetchOptions = {\r\n        method: 'GET', \r\n        mode: 'cors', \r\n        ...opts.optionsForSearch, \r\n        headers: {\r\n          'Content-Type': 'application/json', \r\n          ...(opts.optionsForSearch.headers || {})\r\n        }\r\n      }\r\n      const qs = new URLSearchParams(normalizeQuery(query, opts.omitEmptyQueryParam))\r\n      const url = baseUrl + '?' + qs.toString()\r\n      return fetch(url, fetchOptions as RequestInit)\r\n      .then(( /** @type {Response} */ response) => {\r\n        if (! response.ok) throw responseToError(response)\r\n        return response.json()\r\n        .then((entities) => {\r\n          const totalCount = +(response.headers.get(opts.totalCountHeader))\r\n          return {entities, totalCount}\r\n        })\r\n      })\r\n    }, \r\n    add: (entity) => {\r\n      const fetchOptions = {\r\n        method: 'POST', \r\n        mode: 'cors', \r\n        ...opts.optionsForAdd, \r\n        headers: {\r\n          'Content-Type': 'application/json', \r\n          ...(opts.optionsForAdd.headers || {})\r\n        }, \r\n        body: JSON.stringify(entity)\r\n      }\r\n      const url = baseUrl\r\n      return fetch(url, fetchOptions as RequestInit)\r\n      .then((/** @type {Response} */ response) => {\r\n        if (! response.ok) throw responseToError(response)\r\n        return response.json()\r\n      })\r\n    }, \r\n    replace: (entity) => {\r\n      const fetchOptions = {\r\n        method: 'PUT', \r\n        mode: 'cors', \r\n        ...opts.optionsForUpdate, \r\n        headers: {\r\n          'Content-Type': 'application/json', \r\n          ...(opts.optionsForUpdate.headers || {})\r\n        }, \r\n        body: JSON.stringify(entity)\r\n      }\r\n      const url = baseUrl + '/' + entity[opts.idProperty]\r\n      return fetch(url, fetchOptions as RequestInit)\r\n      .then((/** @type {Response} */ response) => {\r\n        if (! response.ok) throw responseToError(response)\r\n        return response.json()\r\n      })\r\n    }, \r\n    remove: (entity) => {\r\n      const fetchOptions = {\r\n        method: 'DELETE', \r\n        mode: 'cors', \r\n        ...opts.optionsForRemove, \r\n        headers: {\r\n          'Content-Type': 'application/json', \r\n          ...(opts.optionsForRemove.headers || {})\r\n        }\r\n      }\r\n      const url = baseUrl + '/' + entity[opts.idProperty]\r\n      return fetch(url, fetchOptions as RequestInit)\r\n      .then((/** @type {Response} */ response) => {\r\n        if (! response.ok) throw responseToError(response)\r\n      })\r\n    }\r\n  }\r\n}\r\n","//@ts-check\r\n/** @module core/updates */\r\n\r\nimport { API, Update } from './framework'\r\nimport { Env } from './env'\r\nimport { Json } from './schema'\r\nimport { MgError } from './errors'\r\n\r\n\r\n\r\n/**\r\n * @category Types\r\n */\r\nexport type Repository = {\r\n  search: (query:Record<string,any>) => Promise<{entities:Json[], totalCount:number}>, \r\n  add: (entity:Json) => Promise<Json>, \r\n  replace: (entity:Json) => Promise<Json>, \r\n  remove: (entity:Json) => Promise<void>\r\n}\r\n\r\n\r\n/**\r\n * @category For Entity List\r\n */\r\nexport const editItem = (itemPath:string, formPath:string, env:Env):Env => {\r\n  const form = {\r\n    method: \"replace\", \r\n    data: API.extract(itemPath, env)\r\n  }\r\n  return API.add(formPath, form, env)\r\n}\r\n\r\n/**\r\n * @category For Entity List\r\n */\r\nexport const createItem = (data:Json, formPath:string, env:Env):Env => {\r\n  const form = {\r\n    method: \"add\", \r\n    data\r\n  }\r\n  return API.add(formPath, form, env)\r\n}\r\n\r\n/**\r\n * @category For Entity List\r\n */\r\nexport type CommitItemOptions = {\r\n  errorSelector?: string, \r\n  loadingName?: string, \r\n  successName?: string, \r\n  failureName?: string\r\n}\r\n\r\n/**\r\n * @category For Entity List\r\n */\r\nexport const commitItem = (repository:Repository) => (formPath:string, listPath:string, options:CommitItemOptions, env:Env):Env|Promise<any> => {\r\n  const {enter, leave} = API.makePortal(env)\r\n  const opts:CommitItemOptions = {\r\n    errorSelector: null, \r\n    loadingName: 'loading', \r\n    successName: 'success', \r\n    failureName: 'failure', \r\n    ...options\r\n  }\r\n  const methodPath = formPath + '/method'\r\n  const dataPath = formPath + '/data'\r\n  const queryPath = listPath + '/query'\r\n  const itemsPath = listPath + '/items'\r\n  const totalCountPath = listPath + '/totalCount'\r\n  env = API.touchAll(dataPath, env)\r\n  env = API.validate(dataPath, env)\r\n  const numErrors = API.countValidationErrors(dataPath, env)\r\n  if (numErrors) {\r\n    if (opts.errorSelector) {\r\n      window.setTimeout(() => {\r\n        const targetEl = document.querySelector(opts.errorSelector)\r\n        if (targetEl) targetEl.scrollIntoView()\r\n      }, 100)\r\n    }\r\n    return env\r\n  } else {\r\n    env = API.openProgress(opts.loadingName, null, env)\r\n    const data = API.extract(dataPath, env)\r\n    const action = (API.extract(methodPath, env)) as \"add\"|\"replace\"\r\n    return leave(repository[action](data), env)\r\n    .then(enter((_item, env) => {\r\n      const query = API.extract(queryPath, env) as Record<string,any>\r\n      return leave(repository.search(query), env)\r\n    }))\r\n    .then(enter(({entities, totalCount}, env) => {\r\n      env = API.replace(itemsPath, entities, env)\r\n      env = API.replace(formPath, null, env)\r\n      env = API.replace(totalCountPath, totalCount, env)\r\n      env = API.closeProgress(opts.loadingName, env)\r\n      return leave(API.sleep(500, env))\r\n    }))\r\n    .then(enter((_unused, env) => {\r\n      return API.openFeedback(opts.successName, {}, env)\r\n    }))\r\n    .catch(enter((error, env) => {\r\n      env = API.closeProgress(opts.loadingName, env)\r\n      console.error('commision failed', error)\r\n      const mgerror:MgError = {code:error.name, detail:error.message}\r\n      return API.openFeedback(opts.failureName, mgerror, env)\r\n    }))\r\n  }\r\n}\r\n\r\n/**\r\n * @category For Entity List\r\n */\r\nexport const discardItem = (formPath:string, env:Env):Env => {\r\n  env = API.replace(formPath, null, env)\r\n  return env\r\n}\r\n\r\n/**\r\n * @category For Entity List\r\n */\r\nexport type DeleteItemOptions = {\r\n  confirmName?: string, \r\n  loadingName?: string, \r\n  successName?: string, \r\n  failureName?: string\r\n}\r\n\r\n/**\r\n * @category For Entity List\r\n */\r\nexport const deleteItem = (repository:Repository) => (itemPath:string, listPath:string, options:DeleteItemOptions, env:Env):Env|Promise<any> => {\r\n  const {enter, leave} = API.makePortal(env)\r\n  const opts:DeleteItemOptions = {\r\n    confirmName: 'confirm', \r\n    loadingName: 'loading', \r\n    successName: 'success', \r\n    failureName: 'failure', \r\n    ...options\r\n  }\r\n  const queryPath = listPath + '/query'\r\n  const itemsPath = listPath + '/items'\r\n  const totalCountPath = listPath + '/totalCount'\r\n  return leave(API.openDialog(opts.confirmName, {}, env))\r\n  .then(enter((ok, env) => {\r\n    const data = API.extract(itemPath, env)\r\n    env = API.closeDialog(opts.confirmName, env)\r\n    if (! ok) return env\r\n    env = API.openProgress(opts.loadingName, null, env)\r\n    return leave(repository.remove(data), env)\r\n    .then(enter((_unused, env) => {\r\n      const query = API.extract(queryPath, env) as Record<string,any>\r\n      return leave(repository.search(query), env)\r\n    }))\r\n    .then(enter(({entities, totalCount}, env) => {\r\n      env = API.closeProgress(opts.loadingName, env)\r\n      env = API.replace(itemsPath, entities, env)\r\n      env = API.replace(totalCountPath, totalCount, env)\r\n      return leave(API.sleep(500, env))\r\n    }))\r\n    .then(enter((_unused, env) => {\r\n      return API.openFeedback(opts.successName, {}, env)\r\n    }))\r\n    .catch(enter((error, env) => {\r\n      env = API.closeProgress(opts.loadingName, env)\r\n      console.error('deletion failed', error)\r\n      const mgerror:MgError = {code:error.name, detail:error.message}\r\n      return API.openFeedback(opts.failureName, mgerror, env)\r\n    }))\r\n  }))\r\n}\r\n\r\n/**\r\n * @category For Entity List\r\n */\r\nexport type LoadItemsOptions = {\r\n  loadingName?: string, \r\n  failureName?: string, \r\n  page?: number, \r\n  pageProperty?: string\r\n}\r\n\r\n/**\r\n * @category For Entity List\r\n */\r\nexport const loadItems = (repository:Repository) => (listPath:string, options:LoadItemsOptions, env:Env):Env|Promise<any> => {\r\n  const {enter, leave} = API.makePortal(env)\r\n  const opts:LoadItemsOptions = {\r\n    loadingName: 'loading', \r\n    failureName: 'failure', \r\n    page: null, \r\n    pageProperty: null, \r\n    ...options\r\n  }\r\n  const queryPath = listPath + '/query'\r\n  const itemsPath = listPath + '/items'\r\n  const totalCountPath = listPath + '/totalCount'\r\n  env = API.openProgress(opts.loadingName, null, env)\r\n  const query = API.extract(queryPath, env) as Record<string,any>\r\n  if (opts.page !== null && opts.pageProperty) {\r\n    query[opts.pageProperty] = opts.page\r\n  }\r\n  return leave(repository.search(query), env)\r\n  .then(enter(({entities, totalCount}, env) => {\r\n    env = API.closeProgress(opts.loadingName, env)\r\n    if (opts.page !== null && opts.pageProperty) {\r\n      env = API.replace(queryPath + '/' + opts.pageProperty, opts.page, env)\r\n    }\r\n    env = API.replace(itemsPath, entities, env)\r\n    env = API.replace(totalCountPath, totalCount, env)\r\n    return env\r\n  }))\r\n  .catch(enter((error, env) => {\r\n    env = API.closeProgress(opts.loadingName, env)\r\n    console.error('loading failed', error)\r\n    const mgerror:MgError = {code:error.name, detail:error.message}\r\n    return API.openFeedback(opts.failureName, mgerror, env)\r\n  }))\r\n}\r\n\r\n/**\r\n * @category For Entity List\r\n */\r\nexport type SearchItemsOptions = {\r\n  errorSelector?: string, \r\n  loadingName?: string, \r\n  failureName?: string\r\n}\r\n\r\n/**\r\n * @category For Entity List\r\n */\r\nexport const searchItems = (repository:Repository) => (formPath:string, listPath:string, options:SearchItemsOptions, env:Env):Env|Promise<any> => {\r\n  let errorSelector = null\r\n  if (\"errorSelector\" in options) {\r\n    errorSelector = options.errorSelector\r\n    delete options.errorSelector\r\n  }    \r\n  env = API.touchAll(formPath, env)\r\n  env = API.validate(formPath, env)\r\n  const numErrors = API.countValidationErrors(formPath, env)\r\n  if (numErrors) {\r\n    if (errorSelector) {\r\n      window.setTimeout(() => {\r\n        const targetEl = document.querySelector(errorSelector)\r\n        if (targetEl) targetEl.scrollIntoView()\r\n      }, 100)\r\n    }\r\n    return env\r\n  }\r\n\r\n  const {enter, leave} = API.makePortal(env)\r\n  const opts = {\r\n    loadingName: 'loading', \r\n    failureName: 'failure', \r\n    ...options\r\n  }\r\n  const queryPath = listPath + '/query'\r\n  const itemsPath = listPath + '/items'\r\n  const totalCountPath = listPath + '/totalCount'\r\n  env = API.openProgress(opts.loadingName, null, env)\r\n  const query = API.extract(formPath, env) as Record<string,any>\r\n  return leave(repository.search(query), env)\r\n  .then(enter(({entities, totalCount}, env) => {\r\n    env = API.closeProgress(opts.loadingName, env)\r\n    env = API.replace(queryPath, query, env)\r\n    env = API.replace(itemsPath, entities, env)\r\n    env = API.replace(totalCountPath, totalCount, env)\r\n    return env\r\n  }))\r\n  .catch(enter((error, env) => {\r\n    env = API.closeProgress(opts.loadingName, env)\r\n    console.error('search failed', error)\r\n    const mgerror:MgError = {code:error.name, detail:error.message}\r\n    return API.openFeedback(opts.failureName, mgerror, env)\r\n  }))\r\n}\r\n\r\n/**\r\n * Helper function. Builds a neat update collection for entity list app.\r\n * @category For Entity List\r\n */\r\nexport const makeEntityListUpdates = (repository:Repository):Record<string,Update> => {\r\n  return {\r\n    editItem, \r\n    createItem, \r\n    commitItem: commitItem(repository), \r\n    discardItem, \r\n    deleteItem: deleteItem(repository), \r\n    loadItems: loadItems(repository), \r\n    searchItems: searchItems(repository)\r\n  }\r\n}\r\n\r\n/**\r\n * @category For Single Entity\r\n */\r\nexport type SubmitOptions = {\r\n  path?: string, \r\n  errorSelector?: string, \r\n  loadingName?: string, \r\n  successName?: string, \r\n  failureName?: string\r\n}\r\n\r\n/**\r\n * @category For Single Entity\r\n */\r\nexport const submit = (repository:Repository) => (method:\"add\"|\"replace\", options:SubmitOptions, env:Env):Env|Promise<any> => {\r\n  const {enter, leave} = API.makePortal(env)\r\n  const opts:SubmitOptions = {\r\n    path: '', \r\n    errorSelector: null, \r\n    loadingName: 'loading', \r\n    successName: 'success', \r\n    failureName: 'failure', \r\n    ...options\r\n  }\r\n  env = API.touchAll(opts.path, env)\r\n  env = API.validate(opts.path, env)\r\n  const numErrors = API.countValidationErrors(opts.path, env)\r\n  if (numErrors) {\r\n    if (opts.errorSelector) {\r\n      window.setTimeout(() => {\r\n        const targetEl = document.querySelector(opts.errorSelector)\r\n        if (targetEl) targetEl.scrollIntoView()\r\n      }, 100)\r\n    }\r\n    return env\r\n  } else {\r\n    const data = API.extract(opts.path, env)\r\n    env = API.openProgress(opts.loadingName, null, env)\r\n    return leave(repository[method](data), env)\r\n    .then(enter((data, env) => {\r\n      env = API.closeProgress(opts.loadingName, env)\r\n      return leave(API.sleep(500, env))\r\n      .then(enter((_unused, env) => {\r\n        return API.openFeedback(opts.successName, {data}, env)\r\n      }))\r\n    }))\r\n    .catch(enter((error, env) => {\r\n      env = API.closeProgress(opts.loadingName, env)\r\n      console.error('loading failed', error)\r\n      const mgerror:MgError = {code:error.name, detail:error.message}\r\n      return API.openFeedback(opts.failureName, mgerror, env)\r\n    }))\r\n  }\r\n}\r\n\r\n/**\r\n * @category For Single Entity\r\n */\r\nexport type ResetOptions = {\r\n  confirmName?: string\r\n}\r\n\r\n/**\r\n * @category For Single Entity\r\n */\r\nexport const reset = (data:Json, options:ResetOptions, env:Env):Env|Promise<any> => {\r\n  const {enter, leave} = API.makePortal(env)\r\n  const opts:ResetOptions = {\r\n    confirmName: 'confirm', \r\n    ...options\r\n  }\r\n  return leave(API.openDialog(opts.confirmName, {}, env))\r\n  .then(enter((ok, env) => {\r\n    env = API.closeDialog(opts.confirmName, env)\r\n    if (ok) {\r\n      return API.replace(\"\", data, env)\r\n    } else {\r\n      return env\r\n    }\r\n  }))\r\n}\r\n\r\n/**\r\n * @category For Single Entity\r\n */\r\nexport const editPart = (partPath:string, formPath:string, env:Env):Env => {\r\n  const form = {\r\n    method: 'replace', \r\n    action: partPath, \r\n    data: API.extract(partPath, env)\r\n  }\r\n  env = API.replace(formPath, form, env)\r\n  return env\r\n}\r\n\r\n/**\r\n * @category For Single Entity\r\n */\r\nexport const createPart = (pathToAdd:string, data:Json, formPath:string, env:Env):Env => {\r\n  const form = {\r\n    method: 'add', \r\n    action: pathToAdd, \r\n    data\r\n  }\r\n  env = API.replace(formPath, form, env)\r\n  return env\r\n}\r\n\r\n/**\r\n * @category For Single Entity\r\n */\r\nexport type CommitPartOptions = {\r\n  errorSelector?: string, \r\n  idProperty?: string\r\n}\r\n\r\n/**\r\n * @category For Single Entity\r\n */\r\nexport const commitPart = (formPath:string, nextIdPath:string, options:CommitPartOptions, env:Env):Env => {\r\n  const opts:CommitPartOptions = {\r\n    errorSelector: null, \r\n    idProperty: 'id', \r\n    ...options\r\n  }\r\n  const actionPath = formPath + '/action'\r\n  const methodPath = formPath + '/method'\r\n  const dataPath = formPath + '/data'\r\n  env = API.touchAll(dataPath, env)\r\n  env = API.validate(dataPath, env)\r\n  const numErrors = API.countValidationErrors(dataPath, env)\r\n  if (numErrors) {\r\n    if (opts.errorSelector) {\r\n      window.setTimeout(() => {\r\n        const targetEl = document.querySelector(opts.errorSelector)\r\n        if (targetEl) targetEl.scrollIntoView()\r\n      }, 100)\r\n    }\r\n    return env\r\n  } else {\r\n    const method = API.extract(methodPath, env) as \"add\"|\"replace\"\r\n    const path = API.extract(actionPath, env) as string\r\n    const data = API.extract(dataPath, env)\r\n    if (method == \"add\") {\r\n      if (opts.idProperty && nextIdPath) {\r\n        const nextId = API.extract(nextIdPath, env) as number\r\n        env = API.replace(nextIdPath, nextId + 1, env)\r\n        data[opts.idProperty] = nextId\r\n      }\r\n      env = API.add(path, data, env)\r\n    } else {\r\n      env = API.replace(path, data, env)\r\n    }\r\n    env = API.replace(formPath, null, env)\r\n    return env\r\n  }\r\n}\r\n\r\n/**\r\n * @category For Single Entity\r\n */\r\nexport const discardPart = (formPath:string, env:Env):Env => {\r\n  env = API.replace(formPath, null, env)\r\n  return env\r\n}\r\n\r\n/**\r\n * @category For Single Entity\r\n */\r\nexport type RemovePartOptions = {\r\n  confirmName?: string\r\n}\r\n\r\n/**\r\n * @category For Single Entity\r\n */\r\nexport const removePart = (partPath:string, options:RemovePartOptions, env:Env):Env|Promise<any> => {\r\n  const {enter, leave} = API.makePortal(env)\r\n  const opts:RemovePartOptions = {\r\n    confirmName: 'confirm', \r\n    ...options\r\n  }\r\n  return leave(API.openDialog(opts.confirmName, {}, env))\r\n  .then(enter((ok, env) => {\r\n    env = API.closeDialog(opts.confirmName, env)\r\n    if (ok) {\r\n      env = API.remove(partPath, env)\r\n      return env\r\n    } else {\r\n      return env\r\n    }\r\n  }))\r\n}\r\n\r\n/**\r\n * @category For Single Entity\r\n */\r\nexport type CopyPartOptions = {\r\n  pathToAdd?: string, \r\n  idProperty?: string\r\n}\r\n\r\n/**\r\n * @category For Single Entity\r\n */\r\nexport const copyPart = (partPath:string, nextIdPath:string, options:CopyPartOptions, env:Env):Env => {\r\n  const opts:CopyPartOptions = {\r\n    pathToAdd: '', \r\n    idProperty: 'id', \r\n    ...options\r\n  }\r\n  const data = API.extract(partPath, env)\r\n  if (opts.idProperty && nextIdPath) {\r\n    const nextId = API.extract(nextIdPath, env) as number\r\n    data[opts.idProperty] = nextId\r\n    env = API.add(nextIdPath, nextId + 1, env)\r\n  }\r\n  const pathToAdd = opts.pathToAdd || partPath\r\n  env = API.add(pathToAdd, data, env)\r\n  return env\r\n}\r\n\r\n/**\r\n * Helper function. Builds a neat update collection for single entity app.\r\n * @category For Single Entity\r\n */\r\nexport const makeEntityUpdates = (repository:Repository):Record<string,Update> => {\r\n  return {\r\n    submit: submit(repository), \r\n    reset, \r\n    editPart, \r\n    createPart, \r\n    commitPart, \r\n    discardPart, \r\n    removePart, \r\n    copyPart\r\n  }\r\n}","\r\nimport {h, API, start, Input, Select, Radio, Checkbox, UpdateButton, SettleButton, Field, Dialog, Notification, Progress} from '../../src/bindings/bulma'\r\nimport {createRestRepository} from '../../src/core/rest'\r\nimport {makeEntityUpdates} from '../../src/core/updates'\r\nimport {StartParameter} from '../../src/core/framework'\r\nimport {Env} from '../../src/core/env'\r\n\r\nconst master = {\r\n  frame: [\r\n    {name:'SC130-T', price:32000}\r\n  ], \r\n  os: [\r\n    {name:'Home', price:8000}, \r\n    {name:'Pro', price:13000}\r\n  ], \r\n  cpu: [\r\n    {name:'i7', price:24000}, \r\n    {name:'i5', price:16000}, \r\n    {name:'i3', price:10000}\r\n  ], \r\n  memory: [\r\n    {name:'4G', price:10000}, \r\n    {name:'8G', price:20000}, \r\n    {name:'16G', price:40000}, \r\n    {name:'32G', price:80000}\r\n  ], \r\n  accessory: [\r\n    {name:'Keyboard', price:2000}, \r\n    {name:'Mouse', price:2000}, \r\n    {name:'Touch Pad', price:2000}, \r\n    {name:'Monitor', price:20000}\r\n  ], \r\n  bonus: [\r\n    {name:'Mobile Wi-Fi Adaptor', price:0}, \r\n    {name:'Touchauth Component', price:0}\r\n  ]\r\n}\r\n\r\nconst schema = {\r\n  type: 'object', \r\n  properties: {\r\n    detail: {\r\n      type: 'object', \r\n      properties: {\r\n        frame: {type:'string', notEmpty:true}, \r\n        os: {type:'string', notEmpty:true}, \r\n        cpu: {type:'string', notEmpty:true}, \r\n        memory: {type:'string', notEmpty:true}, \r\n        accessories: {\r\n          type: 'object', \r\n          properties: master.accessory.reduce((cur, a, i) => {\r\n            return {...cur, [`a${i}`]:{type:'boolean'}}\r\n          }, {})\r\n        }, \r\n        bonus: {type:'string', notEmpty:true}\r\n      }\r\n    }, \r\n    flags: {\r\n      type: 'object', \r\n      properties: {\r\n        isPro: {type:'boolean'}, \r\n        bigDeal: {type:'boolean'}\r\n      }\r\n    }, \r\n    quotation: {\r\n      type: 'object', \r\n      properties: {\r\n        lines: {\r\n          type: 'array', \r\n          items: {\r\n            type: 'object', \r\n            properties: {\r\n              category: {type:'string'}, \r\n              description: {type:'string'}, \r\n              unitPrice: {type:'integer'}, \r\n              quantity: {type:'integer'}, \r\n              amount: {type:'integer'}\r\n            }\r\n          }\r\n        }, \r\n        subtotal: {type:'integer'}, \r\n        tax: {type:'integer'}, \r\n        total: {type:'integer'}\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\ntype Data = {\r\n  detail: {\r\n    frame: string, \r\n    os: string, \r\n    cpu: string, \r\n    memory: string, \r\n    accessories: Record<string,boolean>, \r\n    bonus: string\r\n  }, \r\n  flags: {\r\n    isPro: boolean, \r\n    bigDeal: boolean\r\n  }, \r\n  quotation: {\r\n    lines: Array<{\r\n      category: string, \r\n      description: string, \r\n      unitPrice: number, \r\n      quantity: number, \r\n      amount: number\r\n    }>, \r\n    subtotal: number, \r\n    tax: number, \r\n    total: number\r\n  }\r\n}\r\n\r\nconst data = {\r\n  detail: {\r\n    frame: master.frame[0].name, \r\n    os: '', \r\n    cpu: '', \r\n    memory: '', \r\n    accessories: master.accessory.reduce((cur, a, i) => {\r\n      return {...cur, [`a${i}`]:false}\r\n    }, {}), \r\n    bonus: ''\r\n  }, \r\n  flags: {\r\n    isPro: false, \r\n    bigDeal: false\r\n  }, \r\n  quotation: {\r\n    lines: [], \r\n    subtotal: 0, \r\n    tax: 0, \r\n    total: 0\r\n  }\r\n}\r\n\r\nconst updates = {\r\n  ...makeEntityUpdates(createRestRepository('http://localhost:3000/btopcs', {}))\r\n}\r\n\r\nconst view = (env:Env) => {\r\n  const flags = API.extract('/flags', env) as Data[\"flags\"]\r\n  const quotation = API.extract('/quotation', env) as Data[\"quotation\"]\r\n  return (\r\n    <div id=\"rootMarker\" class=\"container\">\r\n      <Notification name=\"success\" message=\"\" duration={5000} />\r\n      <Notification name=\"failure\" title=\"\" message=\"{message}\" />\r\n      <Field path=\"/detail/os\" label=\"OS\">\r\n        <div class=\"control\">\r\n          {master.os.map(x => <Radio path=\"/detail/os\" name=\"os\" value={x.name}>{`${x.name} ${x.price}`}</Radio>)}\r\n        </div>\r\n      </Field>\r\n      <Field path=\"/detail/cpu\" label=\"CPU\">\r\n        <div class=\"control\">\r\n          {master.cpu.map(x => <Radio path=\"/detail/cpu\" name=\"cpu\" value={x.name}>{`${x.name} ${x.price}`}</Radio>)}\r\n        </div>\r\n      </Field>\r\n      <Field path=\"/detail/memory\" label=\"\">\r\n        <div class=\"control\">\r\n          {master.memory.map(x => <Radio path=\"/detail/memory\" name=\"memory\" value={x.name} disabled={x.name == '32G' && !flags.isPro}>{`${x.name} ${x.price}`}</Radio>)}\r\n        </div>\r\n      </Field>\r\n      <Field path=\"/detail/accessories\" label=\"\">\r\n        <div class=\"control\">\r\n          {master.accessory.map((x,i) => <Checkbox path={`/detail/accessories/a${i}`}>{`${x.name} ${x.price}`}</Checkbox>)}\r\n        </div>\r\n      </Field>\r\n      <Field path=\"/detail/bonus\" label=\"\">\r\n        <div class=\"control\">\r\n          {master.bonus.map(x => <Radio path=\"/detail/bonus\" name=\"bonus\" value={x.name}>{x.name}</Radio>)}\r\n        </div>\r\n      </Field>\r\n      <hr />\r\n      <table class=\"table is-striped\">\r\n        <thead>\r\n          <th></th>\r\n          <th></th>\r\n          <th></th>\r\n          <th></th>\r\n          <th></th>\r\n        </thead>\r\n        <tbody>\r\n          {quotation.lines.map(line => (\r\n            <tr key={`${line.category}-${line.description}-${line.unitPrice}-${line.quantity}`}>\r\n              <td>{line.category}</td>\r\n              <td>{line.description}</td>\r\n              <td>{line.unitPrice}</td>\r\n              <td>{line.quantity}</td>\r\n              <td>{line.amount}</td>\r\n            </tr>\r\n          ))}\r\n        </tbody>\r\n      </table>\r\n      <table class=\"table\">\r\n        <tr>\r\n          <th></th>\r\n          <td>{quotation.subtotal}</td>\r\n        </tr>\r\n        <tr>\r\n          <th></th>\r\n          <td>{quotation.tax}</td>\r\n        </tr>\r\n        <tr>\r\n          <th></th>\r\n          <td>{quotation.total}</td>\r\n        </tr>\r\n      </table>\r\n      <hr />\r\n      <UpdateButton type=\"button\" class=\"is-primary\" name=\"loading\" update=\"submit\" context={[\"add\", {path:\"/detail\", errorSelector:\".is-danger\", method:\"POST\"}]}></UpdateButton>\r\n    </div>\r\n  )\r\n}\r\n\r\nconst findByProp = <V, T>(name:string, value:V, lis:T[]):T|undefined => {\r\n  for (let i = 0; i < lis.length; i++) {\r\n    if (lis[i][name] == value) return lis[i]\r\n  }\r\n  return undefined\r\n}\r\nconst evolve = (env:Env, path:string, prevEnv:Env):Env => {\r\n  const addLine = (category:string, x:{name:string,price:number}, env:Env):Env => {\r\n    const line = {category, description:x.name, unitPrice:x.price, quantity:1, amount:x.price}\r\n    return API.add('/quotation/lines/-', line, env)\r\n  }\r\n  let subtotal = 0\r\n  let isPro = false\r\n  let detail = API.extract('/detail', env) as Data[\"detail\"]\r\n  if (detail.frame) {\r\n    const frame = findByProp('name', detail.frame, master.frame)\r\n    env = addLine('', frame, env)\r\n    subtotal += frame.price\r\n  }\r\n  if (detail.os) {\r\n    const os = findByProp('name', detail.os, master.os)\r\n    env = addLine('OS', os, env)\r\n    subtotal += os.price\r\n    if (os.name == 'Pro') isPro = true\r\n  }\r\n  if (detail.cpu) {\r\n    const cpu = findByProp('name', detail.cpu, master.cpu)\r\n    env = addLine('CPU', cpu, env)\r\n    subtotal += cpu.price\r\n  }\r\n  env = API.add('/flags/isPro', isPro, env)\r\n  if (! isPro && detail.memory && detail.memory == '32G') {\r\n    env = API.add('/detail/memory', '', env)\r\n    detail = API.extract('/detail', env) as Data[\"detail\"]  // we modified `/detail' so load again.\r\n  }\r\n  if (detail.memory) {\r\n    const memory = findByProp('name', detail.memory, master.memory)\r\n    env = addLine('', memory, env)\r\n    subtotal += memory.price\r\n  }\r\n  master.accessory.forEach((a, i) => {\r\n    if (detail.accessories[`a${i}`]) {\r\n      env = addLine('', a, env)\r\n      subtotal += a.price\r\n    }\r\n  })\r\n  const bigDeal = subtotal >= 70000\r\n  env = API.add('/flags/bigDeal', bigDeal, env)\r\n  if (! bigDeal) {\r\n    env = API.remove('/detail/bonus', env)\r\n    detail = API.extract('/detail', env) as Data[\"detail\"]  // we modified `/detail' so load again.\r\n  }\r\n  if (detail.bonus) {\r\n    const bonus = findByProp('name', detail.bonus, master.bonus)\r\n    env = addLine('', bonus, env)\r\n    subtotal += bonus.price\r\n  }\r\n  env = API.add('/quotation/subtotal', subtotal, env)\r\n  env = API.add('/quotation/tax', subtotal / 10, env)\r\n  env = API.add('/quotation/total', subtotal + subtotal / 10, env)\r\n  return env\r\n}\r\n\r\nconst containerEl = document.getElementById('app')\r\n\r\nstart({data, schema, view:view as StartParameter[\"view\"], containerEl, updates, evolve})\r\n\r\n"]}